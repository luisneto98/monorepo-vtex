# Story 3.4: Detalhes e Perfis

## Status
Draft

## Story
**As a** visitante,
**I want** ver informações detalhadas,
**so that** possa conhecer melhor palestras e palestrantes.

## Acceptance Criteria
1. Tela de detalhe da palestra com todas informações
2. Perfil do palestrante com bio e foto
3. Lista de outras palestras do mesmo speaker
4. Links para redes sociais (abrir browser)
5. Compartilhar palestra via share nativo
6. Navegação entre speakers de uma mesma palestra

## Tasks / Subtasks
- [ ] Implementar SessionDetailsScreen (AC: 1)
  - [ ] Criar tela SessionDetailsScreen em `src/screens/SessionDetails/`
  - [ ] Implementar layout com ScrollView para conteúdo extenso
  - [ ] Criar header com título e botão de share
  - [ ] Exibir informações temporais (data, hora início/fim, duração)
  - [ ] Mostrar stage/palco com badge destacado
  - [ ] Implementar seção de descrição multilíngue
  - [ ] Exibir nível técnico e idioma da palestra
  - [ ] Adicionar seção de materiais/recursos se disponível
  - [ ] Mostrar capacidade e vagas disponíveis quando aplicável
  - [ ] Implementar LazyImage para fotos dos speakers com fallback

- [ ] Implementar SpeakerProfileScreen (AC: 2)
  - [ ] Criar tela SpeakerProfileScreen em `src/screens/SpeakerProfile/`
  - [ ] Implementar header com foto grande usando LazyImage existente
  - [ ] Exibir nome, empresa e cargo com destaque
  - [ ] Criar seção de biografia expansível/collapsível
  - [ ] Adicionar suporte multilíngue para bio e position
  - [ ] Implementar indicador de palestrante destacado se aplicável
  - [ ] Configurar navegação de volta para sessão origem
  - [ ] Adicionar analytics tracking para visualizações de perfil

- [ ] Desenvolver lista de outras palestras do speaker (AC: 3)
  - [ ] Criar componente SpeakerSessionsList
  - [ ] Implementar chamada API: `GET /sessions?speakerId={id}`
  - [ ] Reutilizar SessionCard da Story 3.3 para consistência
  - [ ] Adicionar indicador "Palestra atual" quando aplicável
  - [ ] Implementar navegação para detalhes de outras sessões
  - [ ] Configurar loading state com SkeletonCard
  - [ ] Adicionar empty state "Sem outras palestras"
  - [ ] Implementar cache local de 10 minutos para lista

- [ ] Implementar social links com browser externo (AC: 4)
  - [ ] Criar componente SocialLinksBar
  - [ ] Implementar ícones para LinkedIn, Twitter, GitHub, Website
  - [ ] Usar Linking.openURL para abrir links no browser
  - [ ] Adicionar confirmação antes de sair do app
  - [ ] Configurar fallback para links inválidos
  - [ ] Implementar analytics para clicks em social links
  - [ ] Adicionar acessibilidade com labels apropriados
  - [ ] Testar em iOS Safari e Android Chrome

- [ ] Implementar share nativo (AC: 5)
  - [ ] Integrar React Native Share API
  - [ ] Criar função formatShareMessage com dados da sessão
  - [ ] Incluir título, speakers, data/hora no compartilhamento
  - [ ] Adicionar deep link `vtexevents://session/{id}` ao share
  - [ ] Implementar share button no header e floating action button
  - [ ] Adicionar analytics para tracking de shares
  - [ ] Testar share em WhatsApp, Twitter, email
  - [ ] Configurar fallback para web com clipboard copy

- [ ] Configurar navegação entre speakers (AC: 6)
  - [ ] Criar SpeakersCarousel component para múltiplos speakers
  - [ ] Implementar swipe horizontal entre speakers
  - [ ] Adicionar indicadores de página (dots) para navegação
  - [ ] Configurar tap para navegar ao perfil do speaker
  - [ ] Manter contexto da sessão ao navegar entre speakers
  - [ ] Implementar back navigation para retornar à sessão
  - [ ] Adicionar transições suaves entre telas
  - [ ] Configurar deep linking para speakers individuais

- [ ] Integração com APIs e dados
  - [ ] Criar SessionDetailsService com cache
  - [ ] Implementar `getSessionById(id)` usando endpoint existente
  - [ ] Criar SpeakerService para perfis
  - [ ] Implementar `getSpeakerById(id)` com endpoint existente
  - [ ] Adicionar `getSpeakerSessions(speakerId)` com filtro
  - [ ] Configurar populate de speakers e sponsors nos detalhes
  - [ ] Implementar error handling específico por endpoint
  - [ ] Adicionar retry automático com exponential backoff

- [ ] Estados de loading e erro
  - [ ] Criar SkeletonSessionDetails para loading inicial
  - [ ] Implementar SkeletonSpeakerProfile para perfil
  - [ ] Adaptar ErrorState existente para telas de detalhe
  - [ ] Adicionar estados específicos para "Sessão não encontrada"
  - [ ] Implementar "Speaker não encontrado" com navegação fallback
  - [ ] Configurar pull-to-refresh em ambas as telas
  - [ ] Adicionar timeout de 10s para requests

- [ ] Navegação e deep linking
  - [ ] Adicionar rotas no AppNavigator para detalhes
  - [ ] Configurar stack navigation para SessionDetails
  - [ ] Adicionar stack para SpeakerProfile
  - [ ] Implementar deep links: `vtexevents://session/{id}`
  - [ ] Adicionar deep links: `vtexevents://speaker/{id}`
  - [ ] Configurar navigation params typing com TypeScript
  - [ ] Implementar back handler para Android
  - [ ] Testar navegação circular entre telas

- [ ] Testes e validação
  - [ ] Criar testes para SessionDetailsService
  - [ ] Testar SpeakerService com mocks
  - [ ] Validar componentes SessionDetailsScreen
  - [ ] Testar SpeakerProfileScreen rendering
  - [ ] Validar share functionality em diferentes plataformas
  - [ ] Testar social links opening
  - [ ] Verificar navegação entre speakers
  - [ ] Testar deep linking em iOS e Android
  - [ ] Garantir cobertura de testes mínima de 60%

## Dev Notes

### Dependências das Stories Anteriores

#### Story 3.1 - Navegação e Infraestrutura
- React Navigation configurado com stack navigation pronto
- Deep linking setup com `vtexevents://` scheme
- API service layer com error handling
- Zustand store para estado global
[Source: docs/stories/3.1.story.md#dev-agent-record]

#### Story 3.2 - Componentes Reutilizáveis
- LazyImage component para fotos com progressive loading
- ErrorState e ErrorBoundary para tratamento de erros
- SkeletonCard e SkeletonLoader para loading states
- Debounce utility para ações do usuário
- Cache strategy de 5 minutos implementada
[Source: docs/stories/3.2.story.md#file-list]

#### Story 3.3 - Cards e Listas
- SessionCard component que pode ser reutilizado
- FilterModal e busca patterns estabelecidos
- Infinite scroll com usePagination hook
- Performance optimizations para listas grandes
[Source: docs/stories/3.3.story.md#dev-notes]

### Estruturas de Dados Detalhadas

#### Session Detail Structure
```typescript
interface ISession extends Omit<BaseEntity, '_id'> {
  _id: string;
  title: { 'pt-BR': string; en: string; };
  description: { 'pt-BR': string; en: string; };
  type?: 'keynote' | 'talk' | 'panel' | 'workshop' | 'networking' | 'break';
  startTime: Date;
  endTime: Date;
  stage: string;
  speakerIds: Speaker[]; // Populated com dados completos
  sponsorIds?: Sponsor[]; // Populated quando disponível
  tags: string[];
  capacity?: number;
  registeredCount?: number;
  technicalLevel?: 'beginner' | 'intermediate' | 'advanced';
  language?: 'pt-BR' | 'en' | 'es';
  streamUrl?: string;
  materials?: Array<{
    title: string;
    url: string;
    type: 'pdf' | 'video' | 'link';
  }>;
}
```
[Source: packages/shared/src/types/session.types.ts]

#### Speaker Profile Structure
```typescript
interface SpeakerSocialLinks {
  linkedin?: string;
  twitter?: string;
  github?: string;
  website?: string;
}

interface Speaker extends BaseEntity {
  name: string;
  bio: { 'pt-BR': string; en: string; };
  photoUrl: string;
  company: string;
  position: { 'pt-BR': string; en: string; };
  socialLinks: SpeakerSocialLinks;
  priority: number;
  isHighlight: boolean;
  isVisible: boolean;
}
```
[Source: packages/shared/src/types/speaker.types.ts]

### APIs Disponíveis para Detalhes

#### Session Detail Endpoint
```
GET /sessions/:id
```
- **Public endpoint** (sem autenticação)
- **Populated fields**: speakers (name, photoUrl, company, bio, position)
- **Populated fields**: sponsors (name, logoUrl, tier, description, website)
- **Returns**: Session completa com todos os dados relacionados
[Source: apps/api/src/modules/sessions/sessions.controller.ts#226-258]

#### Speaker Detail Endpoint
```
GET /speakers/:id
```
- **Public endpoint** (sem autenticação)
- **Returns**: Speaker completo com social links e bio
[Source: apps/api/src/modules/speakers/speakers.controller.ts#167-195]

#### Speaker Sessions Endpoint (Workaround)
```
GET /sessions?speakerId={speakerId}
```
- **Filtro disponível** no endpoint de sessions existente
- **Returns**: PaginatedResponse<Session> com sessões do speaker
- **Nota**: Considerar adicionar endpoint dedicado `/speakers/:id/sessions` no futuro
[Source: apps/api/src/modules/sessions/sessions.service.ts#81-83]

### React Native Share Implementation

#### Share API Pattern
```typescript
import { Share } from 'react-native';

const shareSession = async (session: ISession) => {
  const speakers = session.speakerIds.map(s => s.name).join(', ');
  const message = `${session.title['pt-BR']}\n` +
                 `Palestrantes: ${speakers}\n` +
                 `${formatDate(session.startTime)}\n` +
                 `vtexevents://session/${session._id}`;

  try {
    await Share.share({
      message,
      title: session.title['pt-BR'],
      url: `vtexevents://session/${session._id}` // iOS only
    });
  } catch (error) {
    console.error('Share failed:', error);
  }
};
```

### Social Links Implementation

#### Linking API Pattern
```typescript
import { Linking, Alert } from 'react-native';

const openSocialLink = async (url: string, platform: string) => {
  const supported = await Linking.canOpenURL(url);

  if (!supported) {
    Alert.alert('Link inválido', `Não foi possível abrir ${platform}`);
    return;
  }

  Alert.alert(
    'Abrir link externo',
    `Você será redirecionado para ${platform}`,
    [
      { text: 'Cancelar', style: 'cancel' },
      { text: 'Abrir', onPress: () => Linking.openURL(url) }
    ]
  );
};
```

### Navigation Configuration

#### Stack Navigation Setup
```typescript
// Add to AppNavigator.tsx
const SessionStack = createStackNavigator();

function SessionNavigator() {
  return (
    <SessionStack.Navigator>
      <SessionStack.Screen
        name="SessionDetails"
        component={SessionDetailsScreen}
        options={{ title: 'Detalhes da Sessão' }}
      />
      <SessionStack.Screen
        name="SpeakerProfile"
        component={SpeakerProfileScreen}
        options={{ title: 'Perfil do Palestrante' }}
      />
    </SessionStack.Navigator>
  );
}
```

#### Deep Linking Configuration
```typescript
const linking = {
  prefixes: ['vtexevents://'],
  config: {
    screens: {
      SessionDetails: 'session/:id',
      SpeakerProfile: 'speaker/:id',
    }
  }
};
```
[Source: apps/mobile/src/navigation/AppNavigator.tsx pattern]

### Performance Optimizations

#### Cache Strategy
- **Session details**: Cache por 10 minutos (maior que lista por ser menos volátil)
- **Speaker profile**: Cache por 15 minutos (dados mais estáticos)
- **Speaker sessions**: Cache por 5 minutos (consistente com outras listas)

#### Image Loading
- Reutilizar LazyImage component da Story 3.2
- Implementar thumbnail preview para fotos grandes
- Fade-in animation ao carregar imagem final
[Source: apps/mobile/src/components/common/LazyImage.tsx]

### Accessibility Considerations

#### Screen Reader Support
```typescript
accessibilityLabel={`Palestra: ${session.title['pt-BR']}`}
accessibilityHint="Toque para mais detalhes"
accessibilityRole="button"
```

#### Social Links Accessibility
```typescript
accessibilityLabel={`Abrir LinkedIn de ${speaker.name}`}
accessibilityHint="Abrirá o LinkedIn no navegador"
```

### Testing Strategy
- **Unit Tests**: Services (SessionDetailsService, SpeakerService)
- **Component Tests**: Screens, SocialLinksBar, SpeakersCarousel
- **Integration Tests**: Navigation flow, deep linking
- **E2E Tests**: Share functionality, social links opening
- **Platform Tests**: iOS vs Android share behavior differences
[Source: apps/mobile/jest.config.js setup]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-29 | 1.0 | Story criada baseada no Épico 3 e contexto das Stories 3.1/3.2/3.3 | Bob (Scrum Master) |

## Dev Agent Record
*(Esta seção será preenchida pelo agente de desenvolvimento durante a implementação)*

### Agent Model Used
*(A ser preenchido)*

### Debug Log References
*(A ser preenchido)*

### Completion Notes List
*(A ser preenchido)*

### File List
*(A ser preenchido)*

## QA Results
*(Esta seção será preenchida pelo agente de QA após revisão)*