# Story 3.3: Agenda Completa

## Status
Draft

## Story
**As a** visitante,
**I want** visualizar toda programação do evento,
**so that** possa planejar minha participação.

## Acceptance Criteria
1. Visualização por dia com tabs (sem visualização de calendário)
2. Cards de sessão com hora, título, palestrante, sala, patrocinador
3. Filtros por palco, tema, palestrante
4. Busca contextual por texto em título/descrição/palestrante
5. Indicador visual de sessões acontecendo agora
6. Scroll infinito com paginação para grandes volumes

## Tasks / Subtasks
- [ ] Implementar estrutura base da Agenda (AC: 1)
  - [ ] Criar AgendaScreen com Tab Navigator para dias
  - [ ] Configurar tabs dinâmicas baseadas em datas das sessões
  - [ ] Implementar FlatList com scroll infinito para cada dia
  - [ ] Configurar RefreshControl para pull-to-refresh
  - [ ] Integrar com navigation stack para telas de detalhe
  - [ ] Configurar layout responsivo para diferentes tamanhos de tela

- [ ] Desenvolver SessionCard component (AC: 2)
  - [ ] Adaptar HighlightCard existente para formato agenda
  - [ ] Implementar layout com hora de início/fim destacada
  - [ ] Adicionar badges para stage/palco e tipo de sessão
  - [ ] Mostrar speakers com fotos em lista horizontal
  - [ ] Incluir logos de patrocinadores quando disponível
  - [ ] Adicionar indicador de capacidade e vagas disponíveis
  - [ ] Configurar acessibilidade e TouchableOpacity

- [ ] Implementar sistema de filtros (AC: 3)
  - [ ] Criar FilterModal com opções de stage, type, speaker
  - [ ] Implementar FilterChips para mostrar filtros ativos
  - [ ] Adicionar MultiSelect para speakers e tags
  - [ ] Configurar filtro de nível técnico (beginner/intermediate/advanced)
  - [ ] Implementar filtro por idioma (pt-BR/en/es)
  - [ ] Adicionar botão "Limpar Filtros" e contador de resultados
  - [ ] Persistir filtros selecionados no AsyncStorage

- [ ] Desenvolver busca contextual (AC: 4)
  - [ ] Implementar SearchBar component no header da agenda
  - [ ] Configurar busca real-time com debounce de 300ms
  - [ ] Buscar em title, description, speaker name e company
  - [ ] Implementar highlight de termos encontrados nos resultados
  - [ ] Adicionar sugestões de busca baseadas em tags populares
  - [ ] Criar histórico de buscas com AsyncStorage
  - [ ] Configurar search analytics para tracking

- [ ] Implementar indicador "acontecendo agora" (AC: 5)
  - [ ] Criar LiveIndicator component com animação pulsante
  - [ ] Implementar lógica de detecção de sessões em andamento
  - [ ] Adicionar timer automático para atualizar status em tempo real
  - [ ] Configurar badge especial para sessões ao vivo
  - [ ] Implementar ordenação prioritária para sessões live
  - [ ] Adicionar notificação visual quando sessão está começando
  - [ ] Configurar deep link para sessões live

- [ ] Configurar paginação e performance (AC: 6)
  - [ ] Integrar usePagination hook existente com filtros
  - [ ] Implementar scroll infinito com loading footer
  - [ ] Configurar limite de 20 itens por página
  - [ ] Adicionar skeleton loading para páginas subsequentes
  - [ ] Implementar cache inteligente por dia/filtros
  - [ ] Otimizar renderização com getItemLayout para FlatList
  - [ ] Configurar preload da próxima página quando usuário está a 80% da lista

- [ ] Integração com APIs e dados
  - [ ] Criar AgendaService usando API client existente
  - [ ] Implementar endpoints: `GET /sessions` com filtros complexos
  - [ ] Configurar populate de speakers e sponsors para cards
  - [ ] Implementar cache por dia com TTL de 5 minutos
  - [ ] Configurar error handling específico para falhas de busca
  - [ ] Implementar retry automático para falhas de rede
  - [ ] Adicionar analytics para tracking de visualizações

- [ ] Estados de loading e erro
  - [ ] Adaptar skeleton components existentes para agenda
  - [ ] Implementar SkeletonAgenda para loading inicial
  - [ ] Criar EmptyState para quando não há sessões no dia
  - [ ] Implementar ErrorState específico para falhas de busca
  - [ ] Configurar estado de "Nenhum resultado encontrado"
  - [ ] Adicionar retry button para falhas de conexão
  - [ ] Implementar feedback visual para filtros sem resultado

- [ ] Testes e validação
  - [ ] Criar testes unitários para AgendaService
  - [ ] Testar SessionCard component com diferentes layouts
  - [ ] Testar sistema de filtros e persistência
  - [ ] Validar busca contextual com diferentes termos
  - [ ] Testar detecção de sessões ao vivo
  - [ ] Validar scroll infinito e performance
  - [ ] Testar navegação entre tabs de dias
  - [ ] Garantir cobertura de testes mínima de 60%

## Dev Notes

### Dependências das Stories Anteriores

#### Story 3.1 - Infraestrutura Base
- Expo SDK 54 com React Navigation configurado
- API service layer com PaginatedResponse pattern
- Zustand store com AsyncStorage persistence
- usePagination hook implementado para scroll infinito
- AgendaScreen placeholder criada em `apps/mobile/src/screens/Agenda/`
[Source: docs/stories/3.1.story.md#dev-agent-record]

#### Story 3.2 - Componentes e Patterns
- HighlightCard component que pode ser adaptado para SessionCard
- Skeleton loading components (SkeletonCard, SkeletonLoader)
- Error handling components (ErrorBoundary, ErrorState)
- HomeService pattern que pode ser replicado para AgendaService
- Cache strategy de 5 minutos implementada
[Source: docs/stories/3.2.story.md#dev-agent-record]

### Estruturas de Dados Disponíveis

#### Session Interface Completa
```typescript
interface ISession extends Omit<BaseEntity, '_id'> {
  _id: string;
  title: { 'pt-BR': string; en: string; };
  description: { 'pt-BR': string; en: string; };
  type?: 'keynote' | 'talk' | 'panel' | 'workshop' | 'networking' | 'break';
  startTime: Date;
  endTime: Date;
  stage: string; // 'principal' | 'inovacao' | 'tech' | 'startup' | 'workshop_a' | 'workshop_b'
  speakerIds: string[];
  sponsorIds?: string[];
  tags: string[];
  capacity?: number;
  registeredCount?: number;
  isHighlight: boolean;
  isVisible: boolean;
  technicalLevel?: 'beginner' | 'intermediate' | 'advanced';
  language?: 'pt-BR' | 'en' | 'es';
  streamUrl?: string;
  materials?: Array<{title: string; url: string; type: 'pdf' | 'video' | 'link';}>;
}
```
[Source: packages/shared/src/types/session.types.ts]

#### Speaker Interface para Cards
```typescript
interface Speaker extends BaseEntity {
  name: string;
  bio: { 'pt-BR': string; en: string; };
  photoUrl: string;
  company: string;
  position: { 'pt-BR': string; en: string; };
  socialLinks: SpeakerSocialLinks;
  priority: number;
  isHighlight: boolean;
  isVisible: boolean;
}
```
[Source: packages/shared/src/types/speaker.types.ts]

### APIs Disponíveis para Agenda

#### Endpoint Principal com Filtros Avançados
```
GET /sessions
```

**Query Parameters Disponíveis:**
- `page`: Number (default: 1) - Paginação
- `limit`: Number (default: 20, max: 100) - Itens por página
- `sort`: String (ex: 'startTime,-priority') - Ordenação
- `search`: String - Busca em title e description (multilíngue)
- `startDate`: String (ISO) - Filtro por data inicial
- `endDate`: String (ISO) - Filtro por data final
- `stage`: String - Filtro por palco/sala
- `type`: String - Filtro por tipo de sessão
- `tags`: String[] - Filtro por tags (comma-separated)
- `speakerId`: String - Filtro por speaker específico
- `isHighlight`: Boolean - Filtro por sessões em destaque
- `isVisible`: Boolean - Filtro por sessões visíveis
[Source: apps/api/src/modules/sessions/sessions.controller.ts]

#### Endpoints Especializados
- `GET /sessions/live` - Sessões acontecendo agora
- `GET /sessions/highlights` - Sessões em destaque apenas
- `GET /speakers` - Lista de speakers para filtros
[Source: apps/api/src/modules/sessions/sessions.controller.ts]

### Implementação de Busca e Filtros

#### Busca Textual Multilíngue
```typescript
// Implementação no backend
if (search) {
  query.$or = [
    { 'title.pt-BR': { $regex: search, $options: 'i' } },
    { 'title.en': { $regex: search, $options: 'i' } },
    { 'description.pt-BR': { $regex: search, $options: 'i' } },
    { 'description.en': { $regex: search, $options: 'i' } },
  ];
}
```
[Source: apps/api/src/modules/sessions/sessions.service.ts]

#### Detecção de Sessões Ao Vivo
```typescript
// Lógica para "acontecendo agora"
const now = new Date();
const isLive = session.startTime <= now && session.endTime > now;
```
[Source: apps/api/src/modules/sessions/sessions.service.ts]

### Performance e Mobile Patterns

#### Infinite Scroll com usePagination
```typescript
// Hook existente que pode ser reutilizado
const {
  data: sessions,
  loading,
  error,
  hasMore,
  refreshing,
  metadata,
  loadMore,
  refresh
} = usePagination<ISession>({
  endpoint: '/sessions',
  limit: 20,
  params: { ...filters, startDate: selectedDay }
});
```
[Source: apps/mobile/src/hooks/usePagination.ts]

#### Otimizações de Renderização
- `getItemLayout` para FlatList quando altura é conhecida
- `removeClippedSubviews` para listas grandes
- `maxToRenderPerBatch={10}` para melhor performance
- `windowSize={21}` para controlar memory footprint
[Source: React Native best practices]

### Componentes Base Disponíveis

#### HighlightCard (Base para SessionCard)
- Layout otimizado para mobile com TouchableOpacity
- Suporte a acessibilidade e testID
- Integração com navigation stack
- Handling de imagens com lazy loading
[Source: apps/mobile/src/components/cards/HighlightCard.tsx]

#### Skeleton Loading Components
- `SkeletonCard` com shimmer animation
- `SkeletonLoader` para seções
- Configurável para diferentes layouts
[Source: apps/mobile/src/components/skeleton/]

### Cache Strategy e Offline

#### AsyncStorage Pattern
```typescript
// Cache por dia com TTL
const cacheKey = `agenda_${selectedDay}_${JSON.stringify(filters)}`;
const cached = await AsyncStorage.getItem(cacheKey);
```

#### Cache TTL de 5 minutos
```typescript
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos
const isExpired = (timestamp) => Date.now() - timestamp > CACHE_DURATION;
```
[Source: apps/mobile/src/services/HomeService.ts pattern]

### Navigation e Deep Links

#### Navegação para Detalhes
```typescript
// Navigate to session details
navigation.navigate('SessionDetails', { sessionId: session._id });

// Deep link pattern
const deepLink = `vtexevents://session/${session._id}`;
```
[Source: apps/mobile/src/navigation/AppNavigator.tsx]

### Error Handling e Accessibility

#### Error States
- `ErrorBoundary` para crashes de componentes
- `ErrorState` para falhas de API com retry
- Feedback específico para "Nenhum resultado encontrado"
[Source: apps/mobile/src/components/error/]

#### Accessibility Standards
```typescript
accessibilityLabel={`${session.title['pt-BR']}, ${formatTime(session.startTime)}`}
accessibilityHint="Toque para ver detalhes da sessão"
testID="session-card"
```

### Performance Targets
- **Initial Load**: < 500ms para primeiras 20 sessões
- **Search Debounce**: 300ms para evitar chamadas excessivas
- **Cache Hit Ratio**: > 80% para navegação entre dias
- **Memory Usage**: < 100MB para listas de 500+ sessões
[Source: Performance standards from Story 3.2]

### Testing Strategy
- **Unit Tests**: AgendaService, filtros, busca, cache
- **Component Tests**: SessionCard, filtros, loading states
- **Integration Tests**: Navigation, API calls, pagination
- **E2E Tests**: Fluxo completo de uso da agenda
- **Performance Tests**: Scroll infinito com 1000+ sessões
[Source: apps/mobile/jest.config.js setup]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-29 | 1.0 | Story criada baseada no Épico 3 e contexto das Stories 3.1/3.2 | Bob (Scrum Master) |

## Dev Agent Record
*(Esta seção será preenchida pelo agente de desenvolvimento durante a implementação)*

### Agent Model Used
*(A ser preenchido)*

### Debug Log References
*(A ser preenchido)*

### Completion Notes List
*(A ser preenchido)*

### File List
*(A ser preenchido)*

## QA Results
*(Esta seção será preenchida pelo agente de QA após revisão)*