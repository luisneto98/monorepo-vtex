---
title: Backend API - Press Materials Module
section: 7.1.1
type: backend
epic: Media Resources Management
priority: high
estimated_hours: 4
status: draft
---

# User Story: Backend API for Press Materials

## Story
**As a** marketing team member
**I want** a complete backend API for managing press materials
**So that** journalists and partners can access official event media resources

## Background
The VTEX Day 2026 platform needs a centralized system for managing press materials including press kits, logo packages, event photos, institutional videos, and presentations. This story implements the backend API module following existing patterns from modules like `speakers` and `event-settings`.

## Acceptance Criteria

### API Endpoints
- [ ] GET `/api/press-materials` - List all press materials with pagination
- [ ] GET `/api/press-materials/:id` - Get specific press material
- [ ] POST `/api/press-materials` - Create new press material (admin only)
- [ ] PUT `/api/press-materials/:id` - Update press material (admin only)
- [ ] DELETE `/api/press-materials/:id` - Delete press material (admin only)
- [ ] POST `/api/press-materials/upload` - Upload files to S3
- [ ] GET `/api/press-materials/public` - Public endpoint for approved materials

### Data Model
- [ ] Material type (press_kit, logo_package, photo, video, presentation)
- [ ] Title (multilingual support: pt-BR, en, es)
- [ ] Description (multilingual)
- [ ] File URL (S3 storage)
- [ ] File metadata (size, format, dimensions)
- [ ] Category/tags for organization
- [ ] Publication status (draft, published, archived)
- [ ] Access level (public, restricted)
- [ ] Download count tracking

### File Management
- [ ] S3 integration for file storage
- [ ] Support multiple file formats (PDF, ZIP, JPG, PNG, MP4, PPT)
- [ ] File size validation (max 500MB for videos, 50MB for others)
- [ ] Automatic thumbnail generation for images/videos
- [ ] Secure signed URLs for restricted content

### Business Rules
- [ ] Only published materials appear in public endpoint
- [ ] File type validation based on material type
- [ ] Automatic metadata extraction from files
- [ ] Download tracking for analytics
- [ ] Bulk upload support for photos

### Security
- [ ] JWT authentication for admin endpoints
- [ ] Role-based access (ADMIN, SUPER_ADMIN for management)
- [ ] Rate limiting on download endpoints
- [ ] Signed URLs expire after 24 hours

## Tasks / Subtasks

### 1. Module Setup (30 min)
- [ ] Create press-materials module structure
- [ ] Register module in app.module.ts
- [ ] Setup S3 integration config
- [ ] Configure multer for file uploads

### 2. Database Schema (45 min)
- [ ] Create PressMaterial schema with Mongoose
- [ ] Define interfaces for file metadata
- [ ] Setup indexes for search performance
- [ ] Create download tracking schema

### 3. DTOs and Validation (30 min)
- [ ] Create CreatePressMaterialDto
- [ ] Create UpdatePressMaterialDto
- [ ] Add file upload validation DTOs
- [ ] Test DTO validation rules

### 4. File Upload Service (60 min)
- [ ] Implement S3 upload service
- [ ] Add file validation logic
- [ ] Implement thumbnail generation
- [ ] Create signed URL generator
- [ ] Add file deletion capability

### 5. Service Implementation (45 min)
- [ ] Implement CRUD operations
- [ ] Add pagination and filtering
- [ ] Implement download tracking
- [ ] Add search functionality
- [ ] Create public materials query

### 6. Controller Implementation (30 min)
- [ ] Create all REST endpoints
- [ ] Add file upload endpoint
- [ ] Implement download tracking
- [ ] Add JWT guards and roles
- [ ] Add Swagger documentation

### 7. Testing (60 min)
- [ ] Write unit tests for services
- [ ] Test file upload scenarios
- [ ] Integration tests for endpoints
- [ ] Test S3 integration
- [ ] Verify >80% code coverage

### 8. Integration & Documentation (30 min)
- [ ] Export types to shared package
- [ ] Update API documentation
- [ ] Create sample upload scripts
- [ ] Test full integration flow

## Dev Notes

### Technical Context
- NestJS framework with modular architecture
- MongoDB with Mongoose for metadata storage
- AWS S3 for file storage (or MinIO for local dev)
- Sharp library for image processing
- FFmpeg for video thumbnail generation
- Multer for handling multipart uploads

### Key Implementation Details
1. **S3 Configuration**: Use AWS SDK v3 with proper IAM permissions
2. **File Organization**: Structure: `press-materials/{year}/{type}/{filename}`
3. **Thumbnail Generation**:
   - Images: 300x300 and 150x150 versions
   - Videos: Extract frame at 1 second
4. **Validation Patterns**:
   - Accepted formats by type:
     - press_kit: PDF, ZIP
     - logo_package: ZIP, AI, EPS, SVG
     - photo: JPG, PNG, WEBP
     - video: MP4, MOV, WEBM
     - presentation: PPT, PPTX, PDF
5. **Download Tracking**: Log IP, timestamp, user agent, material ID

### File Dependencies
- Auth module: apps/api/src/modules/auth/
- S3 config: apps/api/src/config/s3.config.ts
- Shared types: packages/shared/src/types/

### Environment Variables
```
AWS_S3_BUCKET=vtex-day-press-materials
AWS_S3_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
MAX_FILE_SIZE=524288000
```

## Technical Notes

### File Structure
```
apps/api/src/modules/press-materials/
├── press-materials.module.ts
├── press-materials.controller.ts
├── press-materials.service.ts
├── services/
│   ├── file-upload.service.ts
│   ├── thumbnail.service.ts
│   └── download-tracking.service.ts
├── schemas/
│   ├── press-material.schema.ts
│   └── download-log.schema.ts
├── dto/
│   ├── create-press-material.dto.ts
│   ├── update-press-material.dto.ts
│   └── file-upload.dto.ts
└── interfaces/
    └── press-material.interface.ts
```

### Schema Definition
```typescript
@Schema({ collection: 'press_materials' })
export class PressMaterial {
  @Prop({
    type: String,
    enum: ['press_kit', 'logo_package', 'photo', 'video', 'presentation'],
    required: true
  })
  type: PressMaterialType;

  @Prop({
    type: {
      pt: { type: String, required: true },
      en: { type: String, required: true },
      es: { type: String, required: true }
    }
  })
  title: LocalizedString;

  @Prop({
    type: {
      pt: String,
      en: String,
      es: String
    }
  })
  description: LocalizedString;

  @Prop({ required: true })
  fileUrl: string;

  @Prop({ type: String })
  thumbnailUrl: string;

  @Prop({
    type: {
      size: Number,
      format: String,
      width: Number,
      height: Number,
      duration: Number
    }
  })
  metadata: FileMetadata;

  @Prop({ type: [String], index: true })
  tags: string[];

  @Prop({
    type: String,
    enum: ['draft', 'published', 'archived'],
    default: 'draft'
  })
  status: PublicationStatus;

  @Prop({
    type: String,
    enum: ['public', 'restricted'],
    default: 'public'
  })
  accessLevel: AccessLevel;

  @Prop({ default: 0 })
  downloadCount: number;

  @Prop({ default: Date.now })
  createdAt: Date;

  @Prop({ default: Date.now })
  updatedAt: Date;

  @Prop({ required: true })
  uploadedBy: string;
}
```

## Testing

### Unit Tests
- [ ] Service methods (>80% coverage)
- [ ] File upload validation
- [ ] S3 operations
- [ ] Thumbnail generation

### Integration Tests
- [ ] All endpoints with file uploads
- [ ] Authentication/authorization
- [ ] Download tracking
- [ ] Error scenarios

### Test Frameworks
- Jest for unit testing
- Supertest for API testing
- Mock AWS SDK for S3 tests

## Definition of Done
- [ ] All endpoints implemented and documented
- [ ] File upload working with S3
- [ ] Thumbnail generation functional
- [ ] Download tracking implemented
- [ ] Tests passing (>80% coverage)
- [ ] Code review approved
- [ ] Deployed to development

## Dependencies
- JWT authentication module
- MongoDB connection
- AWS S3 bucket configured
- Sharp and FFmpeg installed

## Notes
- Consider implementing CDN for file delivery
- Add virus scanning for uploaded files
- Implement backup strategy for S3
- Consider watermarking for photos

## Change Log

| Date | Author | Description |
|------|--------|-------------|
| 2025-09-28 | Sarah (PO) | Initial story creation |

## Dev Agent Record

_No development activity yet_

## QA Results

_Pending implementation_