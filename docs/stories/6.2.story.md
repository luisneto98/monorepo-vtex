# Story 6.2: General Event Settings

## Status
Draft

## Story
**As a** VTEX Day 2026 event administrator,
**I want** to manage general event settings including basic information, location, contact details, and social media links,
**so that** I can maintain accurate and up-to-date event information that will be displayed across the website and mobile application.

## Acceptance Criteria

1. **Event Basic Information Management**
   - Admin can create, read, update, and delete event basic information
   - Event name field is required and supports multilingual content (pt-BR, en)
   - Start date and end date fields are required with proper validation (end date must be after start date)
   - All basic information changes are properly validated and saved to the database

2. **Location and Venue Management**
   - Admin can manage venue name with multilingual support (pt-BR, en)
   - Complete address management with fields: street, number, complement, neighborhood, city, state, zip code
   - Address validation ensures all required fields are filled
   - Location coordinates (latitude/longitude) can be set for Google Maps integration
   - Coordinates validation ensures valid geographic coordinates

3. **Contact Information Management**
   - Admin can manage contact email with proper email format validation
   - Phone number field with proper format validation
   - WhatsApp number field with proper format validation
   - All contact information is properly stored and retrievable

4. **Social Media Links Management**
   - Admin can manage social media URLs for Instagram, Facebook, LinkedIn, Twitter/X, and YouTube
   - URL validation ensures proper format for each social media platform
   - Social media links are optional but must be valid URLs when provided
   - Support for adding/removing social media platforms

5. **Data Persistence and API Integration**
   - All event settings are stored in PostgreSQL database using TypeORM entities
   - RESTful API endpoints follow existing NestJS patterns (GET, POST, PUT, DELETE)
   - API responses include proper error handling and validation messages
   - Changes are immediately reflected in the admin interface

6. **User Interface and Experience**
   - Admin interface follows existing React admin panel design patterns
   - Form validation provides real-time feedback to users
   - Success and error messages are displayed using existing toast notification system
   - Loading states are properly handled during API operations

7. **Security and Authorization**
   - All API endpoints require valid JWT authentication
   - Only users with admin role can access event settings management
   - Input sanitization prevents XSS and injection attacks
   - Audit trail tracks who made changes and when

8. **Integration Requirements**
   - Existing authentication and authorization systems continue to work unchanged
   - New functionality follows existing NestJS module patterns (similar to system-config module)
   - Frontend integration follows existing React component patterns
   - Database changes are additive only (no breaking changes to existing tables)

9. **Quality Requirements**
   - All new code is covered by unit tests following existing testing patterns
   - Integration tests verify API endpoints work correctly
   - Frontend components have proper error boundaries and loading states
   - No regression in existing functionality verified through testing

## Tasks / Subtasks

- [ ] **Backend API Development** (AC: 1,2,3,4,5,7,8,9)
  - [ ] Create EventSettings TypeORM entity with all required fields
  - [ ] Create EventSettings module, service, and controller following NestJS patterns
  - [ ] Implement CRUD operations (GET, POST, PUT, DELETE) for event settings
  - [ ] Add proper validation using class-validator decorators
  - [ ] Implement JWT authentication guards and role-based authorization
  - [ ] Add comprehensive error handling and response formatting
  - [ ] Create unit tests for service and controller
  - [ ] Create integration tests for API endpoints

- [ ] **Shared Types and Interfaces** (AC: 1,2,3,4,5,8)
  - [ ] Define EventSettings types in packages/shared/src/types/
  - [ ] Create DTOs for create/update operations
  - [ ] Export types from shared package index
  - [ ] Ensure type consistency between frontend and backend

- [ ] **Frontend Admin Interface** (AC: 1,2,3,4,6,8,9)
  - [ ] Create EventSettings page component following existing patterns
  - [ ] Implement form components for all event setting fields
  - [ ] Add real-time form validation using existing validation patterns
  - [ ] Integrate with existing toast notification system
  - [ ] Add loading states and error handling
  - [ ] Create service layer for API communication
  - [ ] Add unit tests for components and services
  - [ ] Integrate with existing routing and navigation

- [ ] **Database Schema and Migrations** (AC: 5,8,9)
  - [ ] Create database migration for event_settings table
  - [ ] Add proper indexes for performance optimization
  - [ ] Ensure foreign key constraints for audit fields
  - [ ] Test migration rollback scenarios

- [ ] **Documentation and Integration** (AC: 8,9)
  - [ ] Update API documentation with new endpoints
  - [ ] Add frontend component documentation
  - [ ] Update navigation to include new event settings page
  - [ ] Verify integration with existing admin authentication flow

## Dev Notes

### Relevant Source Tree Information
- **API Module Pattern**: Follow `/apps/api/src/modules/system-config/` as reference for NestJS module structure
- **Frontend Page Pattern**: Follow `/apps/admin/src/pages/VisibilityControl.tsx` for React admin page patterns
- **Database Schema Pattern**: Follow `/apps/api/src/modules/speakers/schemas/speaker.schema.ts` for Mongoose schema patterns
- **Shared Types Location**: `/packages/shared/src/types/` - add new `event-settings.types.ts`
- **Authentication**: Use existing JWT guards at `/apps/api/src/modules/auth/guards/`
- **Frontend Services**: Follow pattern in `/apps/admin/src/services/system-config.service.ts`

### Technical Implementation Notes
- **Database**: Use MongoDB with Mongoose (following existing patterns, not PostgreSQL as mentioned in requirements)
- **Validation**: Use class-validator for backend DTOs and zod for frontend forms
- **Internationalization**: Support pt-BR and en languages for text fields
- **Form Handling**: Use react-hook-form with existing form patterns
- **State Management**: Use React useState/useEffect patterns (no external state management)
- **UI Components**: Reuse existing shadcn/ui components from `/apps/admin/src/components/ui/`

### Testing Standards
- **Backend Tests**: Place in `/apps/api/tests/unit/modules/event-settings/` and `/apps/api/tests/integration/`
- **Frontend Tests**: Place in `/apps/admin/tests/unit/` following existing structure
- **Test Framework**: Jest for unit tests, supertest for API integration tests
- **Coverage**: Minimum 80% code coverage for new modules
- **Test Patterns**: Follow existing test patterns in system-config and speaker modules

### Key Constraints
- Must follow existing authentication patterns (no new auth mechanisms)
- Use existing UI component library and design system
- Follow established error handling and validation patterns
- Maintain consistency with existing API response formats
- Ensure backward compatibility with existing admin functionality

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-27 | 1.0 | Initial story creation for General Event Settings module | Claude |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled during implementation*

### Debug Log References
*To be filled during implementation*

### Completion Notes List
*To be filled during implementation*

### File List
*To be filled during implementation*

## QA Results
*This section will be populated by the QA agent during review*