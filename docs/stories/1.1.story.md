# Story 1.1: Setup Inicial do Projeto

## Status
Ready for Review

## Story
**As a** desenvolvedor,
**I want** configurar a estrutura base do monorepo com NestJS,
**so that** tenhamos um ambiente de desenvolvimento padronizado.

## Acceptance Criteria
1. Monorepo configurado com workspaces para backend, web e mobile
2. NestJS instalado com estrutura modular (auth, content, common)
3. MongoDB/Mongoose configurado com conexão para MongoDB Atlas
4. ESLint e Prettier configurados com regras consistentes
5. Scripts npm para desenvolvimento, build e teste funcionando
6. README com instruções de setup local

## Tasks / Subtasks
- [x] Task 1: Configure monorepo structure (AC: 1)
  - [x] Initialize root package.json with npm/yarn workspaces
  - [x] Create directory structure following architecture spec: apps/api, apps/web, apps/mobile, apps/admin, packages/shared, packages/ui
  - [x] Configure root tsconfig.json with path mappings for shared packages
  - [x] Set up shared TypeScript configuration in packages/shared

- [x] Task 2: Set up NestJS backend (AC: 2)
  - [x] Initialize NestJS project in apps/api directory
  - [x] Create modular structure with modules: auth, sessions, speakers, sponsors, users, notifications
  - [x] Configure common folder with decorators, filters, guards, interceptors
  - [x] Set up main.ts with CORS, validation pipe, and global exception filters

- [x] Task 3: Configure MongoDB connection (AC: 3)
  - [x] Install @nestjs/mongoose and mongoose dependencies
  - [x] Create database configuration module with environment variables
  - [x] Implement Mongoose schemas for User, Session, Speaker, and Sponsor models
  - [x] Set up connection to MongoDB Atlas with proper connection string handling
  - [x] Add indexes for optimized queries on frequently accessed fields

- [x] Task 4: Set up linting and formatting (AC: 4)
  - [x] Configure ESLint with TypeScript support across all workspaces
  - [x] Set up Prettier with consistent formatting rules
  - [x] Add pre-commit hooks using husky for automatic linting
  - [x] Ensure lint scripts work at both root and workspace levels

- [x] Task 5: Configure development scripts (AC: 5)
  - [x] Add root scripts for running all applications concurrently
  - [x] Configure individual workspace scripts for dev, build, test
  - [x] Set up nodemon/ts-node-dev for hot reloading in development
  - [x] Add Docker Compose configuration for local MongoDB if needed

- [x] Task 6: Create comprehensive README (AC: 6)
  - [x] Document prerequisites (Node.js, npm/yarn versions)
  - [x] Provide step-by-step local setup instructions
  - [x] Include environment variables template (.env.example)
  - [x] Add troubleshooting section and development workflow guide

- [x] Task 7: Write unit tests for initial setup
  - [x] Create test structure in apps/api/tests following testing strategy
  - [x] Write basic tests for MongoDB connection
  - [x] Set up Jest configuration with proper coverage thresholds
  - [x] Ensure test scripts are working properly

## Dev Notes

### Technology Stack
Based on architecture specifications, the following technologies must be used:
- **TypeScript**: Version 5.0+ for type-safe development [Source: architecture/tech-stack.md#11]
- **NestJS**: Version 10.0+ as backend framework [Source: architecture/tech-stack.md#13]
- **MongoDB**: Version 6.0+ with Mongoose for data persistence [Source: architecture/tech-stack.md#15]
- **Redis**: Version 7.0+ for caching (setup connection but implementation in later stories) [Source: architecture/tech-stack.md#16]
- **Jest**: Version 29+ for testing framework [Source: architecture/tech-stack.md#18-19]
- **Docker & Docker Compose**: For containerization [Source: architecture/tech-stack.md#24]

### Project Structure Requirements
The monorepo must follow this exact structure [Source: architecture/unified-project-structure.md]:
```
vtexday26/
├── apps/
│   ├── api/          # NestJS backend
│   │   ├── src/
│   │   │   ├── modules/
│   │   │   │   ├── auth/
│   │   │   │   ├── sessions/
│   │   │   │   ├── speakers/
│   │   │   │   ├── sponsors/
│   │   │   │   ├── users/
│   │   │   │   └── notifications/
│   │   │   ├── common/
│   │   │   │   ├── decorators/
│   │   │   │   ├── filters/
│   │   │   │   ├── guards/
│   │   │   │   └── interceptors/
│   │   │   └── main.ts
│   ├── web/          # React web (placeholder)
│   ├── mobile/       # React Native (placeholder)
│   └── admin/        # Backoffice React (placeholder)
├── packages/
│   ├── shared/       # Shared types/utilities
│   └── ui/           # Shared UI components (placeholder)
├── infrastructure/
│   └── docker/
│       └── docker-compose.yml
└── scripts/
```

### Database Models to Initialize
Initial Mongoose schemas needed [Source: architecture/data-models.md]:
1. **User Model** - With roles (super_admin, producer, sponsor, participant), profile, preferences
2. **Session Model** - With multilingual fields (title, description), speakers array, schedule info
3. **Speaker Model** - With bio, company, social links, highlight flag
4. **Sponsor Model** - With tier, logo, contact info, post limits

### Coding Standards to Enforce
Critical rules from architecture [Source: architecture/coding-standards.md]:
- **Type Sharing**: Define all types in packages/shared and import from there
- **Environment Variables**: Use SCREAMING_SNAKE_CASE (e.g., MONGODB_URI)
- **Database Collections**: Use PascalCase singular (e.g., User, Session, Speaker)
- **Database Fields**: Use camelCase (e.g., startTime, createdAt)
- **Never** access process.env directly - use config objects

### Testing Requirements

#### Testing Strategy [Source: architecture/testing-strategy.md]
- Test structure location: `apps/api/tests/` with subdirectories for unit/, integration/, e2e/
- Use Jest version 29+ with Supertest for API testing
- Test files should follow naming pattern: `*.spec.ts` or `*.test.ts`
- Coverage thresholds: Aim for 60% unit tests, 30% integration, 10% E2E

#### Initial Test Requirements
- Test MongoDB connection establishment and error handling
- Test environment variable loading and validation
- Test module initialization for each NestJS module
- Use mocking for external dependencies

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-26 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*To be populated by development agent during implementation*

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
No debug logs required - implementation completed successfully

### Completion Notes List
- Successfully configured monorepo structure with workspaces
- NestJS backend set up with all required modules (auth, users, sessions, speakers, sponsors, notifications)
- MongoDB schemas created with proper indexes for optimized queries
- ESLint and Prettier configured with consistent rules across workspaces
- Docker Compose configuration added for local MongoDB and Redis
- Comprehensive README with setup instructions created
- Unit and integration tests written for initial setup validation

### File List
**Root Files:**
- package.json
- tsconfig.json
- .eslintrc.js
- .prettierrc
- .eslintignore
- .prettierignore
- .env.example
- README.md

**Shared Package:**
- packages/shared/package.json
- packages/shared/tsconfig.json
- packages/shared/src/index.ts
- packages/shared/src/types/common.types.ts
- packages/shared/src/types/user.types.ts
- packages/shared/src/types/session.types.ts
- packages/shared/src/types/speaker.types.ts
- packages/shared/src/types/sponsor.types.ts

**API Application:**
- apps/api/package.json
- apps/api/tsconfig.json
- apps/api/nest-cli.json
- apps/api/src/main.ts
- apps/api/src/app.module.ts
- apps/api/src/config/configuration.ts

**Common:**
- apps/api/src/common/filters/all-exceptions.filter.ts
- apps/api/src/common/interceptors/transform.interceptor.ts
- apps/api/src/common/guards/jwt-auth.guard.ts
- apps/api/src/common/guards/roles.guard.ts
- apps/api/src/common/decorators/public.decorator.ts
- apps/api/src/common/decorators/roles.decorator.ts
- apps/api/src/common/decorators/current-user.decorator.ts

**Modules:**
- apps/api/src/modules/database/database.module.ts
- apps/api/src/modules/auth/auth.module.ts
- apps/api/src/modules/auth/auth.service.ts
- apps/api/src/modules/auth/auth.controller.ts
- apps/api/src/modules/auth/strategies/jwt.strategy.ts
- apps/api/src/modules/auth/strategies/local.strategy.ts
- apps/api/src/modules/auth/guards/local-auth.guard.ts
- apps/api/src/modules/users/users.module.ts
- apps/api/src/modules/users/users.service.ts
- apps/api/src/modules/users/users.controller.ts
- apps/api/src/modules/users/schemas/user.schema.ts
- apps/api/src/modules/sessions/sessions.module.ts
- apps/api/src/modules/sessions/sessions.service.ts
- apps/api/src/modules/sessions/sessions.controller.ts
- apps/api/src/modules/sessions/schemas/session.schema.ts
- apps/api/src/modules/speakers/speakers.module.ts
- apps/api/src/modules/speakers/speakers.service.ts
- apps/api/src/modules/speakers/speakers.controller.ts
- apps/api/src/modules/speakers/schemas/speaker.schema.ts
- apps/api/src/modules/sponsors/sponsors.module.ts
- apps/api/src/modules/sponsors/sponsors.service.ts
- apps/api/src/modules/sponsors/sponsors.controller.ts
- apps/api/src/modules/sponsors/schemas/sponsor.schema.ts
- apps/api/src/modules/notifications/notifications.module.ts
- apps/api/src/modules/notifications/notifications.service.ts
- apps/api/src/modules/notifications/notifications.controller.ts

**Tests:**
- apps/api/tests/jest.config.js
- apps/api/tests/unit/database.connection.spec.ts
- apps/api/tests/unit/config.validation.spec.ts
- apps/api/tests/unit/modules/users/users.service.spec.ts
- apps/api/tests/unit/modules/auth/auth.service.spec.ts
- apps/api/tests/integration/auth.integration.spec.ts
- apps/api/test/jest-e2e.json

**Infrastructure:**
- infrastructure/docker/docker-compose.yml
- infrastructure/docker/init-mongo.js

## QA Results

### Review Date: 2025-09-26

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation successfully establishes the monorepo foundation with excellent structural organization and adherence to architectural specifications. The modular NestJS backend follows best practices with proper separation of concerns, comprehensive error handling, and security-first authentication. The shared types package correctly centralizes type definitions, ensuring consistency across the monorepo.

### Refactoring Performed

No refactoring required - implementation already follows best practices and architectural guidelines.

### Compliance Check

- Coding Standards: ✓ Follows SCREAMING_SNAKE_CASE for env vars, PascalCase for collections, camelCase for fields
- Project Structure: ✓ Exact match with specified architecture in unified-project-structure.md
- Testing Strategy: ✓ Tests properly organized in apps/api/tests with unit and integration coverage
- All ACs Met: ✓ All 6 acceptance criteria fully implemented and validated

### Improvements Checklist

- [x] Monorepo structure with workspaces verified working
- [x] NestJS modules properly separated with auth, users, sessions, speakers, sponsors, notifications
- [x] MongoDB schemas include proper indexes for optimized queries
- [x] Docker Compose configuration for local development environment
- [x] Environment variables properly configured with .env.example template
- [ ] Consider adding rate limiting to auth endpoints (future story)
- [ ] Add request validation DTOs for all endpoints (partially done, complete in next iteration)
- [ ] Implement comprehensive E2E test suite (currently at unit/integration level)

### Security Review

**Strengths:**
- JWT authentication properly implemented with Passport.js
- Passwords hashed using bcrypt with salt rounds of 10
- Environment variables for sensitive configuration
- Role-based access control (RBAC) with guards

**Recommendations:**
- JWT secret in .env.example should have stronger guidance for production values
- Consider implementing refresh token rotation (mentioned in schema but not fully implemented)
- Add rate limiting for auth endpoints to prevent brute force attacks

### Performance Considerations

**Optimizations Found:**
- Database indexes properly configured on frequently queried fields (email, role, company, isActive)
- Connection pooling configured with MongoDB driver
- Redis cache connection prepared (implementation deferred to future stories per requirements)

**Future Considerations:**
- Implement Redis caching layer when usage patterns are established
- Consider connection pool tuning based on load testing results

### Files Modified During Review

No files modified - implementation meets quality standards without requiring changes.

### Gate Status

Gate: **PASS** → docs/qa/gates/1.1-setup-inicial-do-projeto.yml
Risk profile: Low risk - foundational setup with standard patterns
NFR assessment: Security, performance, reliability, maintainability all PASS

### Recommended Status

✓ Ready for Done - All acceptance criteria met with high-quality implementation
(Story owner decides final status)