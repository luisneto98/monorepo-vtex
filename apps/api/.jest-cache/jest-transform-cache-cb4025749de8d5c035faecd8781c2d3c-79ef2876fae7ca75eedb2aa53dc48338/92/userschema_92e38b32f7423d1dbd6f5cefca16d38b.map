{"version":3,"names":["cov_2csnzszzfh","actualCoverage","mongoose_1","s","require","mongoose_2","user_types_1","Profile","name","phone","company","position","photoUrl","language","__decorate","Prop","required","minlength","maxlength","trim","match","enum","default","Schema","_id","Preferences","interests","notificationsEnabled","favoriteSessionIds","type","String","Types","ObjectId","ref","User","email","password","role","profile","preferences","isActive","isValidated","lastLogin","refreshToken","exports","unique","lowercase","index","select","Object","values","UserRole","Date","timestamps","collection","UserSchema","SchemaFactory","createForClass","pre","next","f","b","toLowerCase","virtual","get","split","methods","obj"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/users/schemas/user.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\nimport { Document, Schema as MongooseSchema } from 'mongoose';\nimport { User as IUser, UserRole, UserProfile, UserPreferences } from '@shared/types/user.types';\n\nexport type UserDocument = User & Document;\n\n@Schema({ _id: false })\nclass Profile implements UserProfile {\n  @Prop({\n    required: true,\n    minlength: 3,\n    maxlength: 100,\n    trim: true,\n  })\n  name: string;\n\n  @Prop({\n    match: /^[+]?[0-9]{10,15}$/,\n    trim: true,\n  })\n  phone?: string;\n\n  @Prop({\n    maxlength: 100,\n    trim: true,\n  })\n  company?: string;\n\n  @Prop({\n    maxlength: 50,\n    trim: true,\n  })\n  position?: string;\n\n  @Prop({\n    match: /^https?:\\/\\/.+/,\n  })\n  photoUrl?: string;\n\n  @Prop({\n    enum: ['pt-BR', 'en'],\n    default: 'pt-BR',\n  })\n  language?: 'pt-BR' | 'en';\n}\n\n@Schema({ _id: false })\nclass Preferences implements UserPreferences {\n  @Prop({\n    type: [String],\n    default: [],\n  })\n  interests?: string[];\n\n  @Prop({\n    default: true,\n  })\n  notificationsEnabled?: boolean;\n\n  @Prop({\n    type: [{ type: MongooseSchema.Types.ObjectId, ref: 'Session' }],\n    default: [],\n  })\n  favoriteSessionIds?: string[];\n}\n\n@Schema({ timestamps: true, collection: 'User' })\nexport class User implements Omit<IUser, '_id'> {\n  @Prop({\n    required: true,\n    unique: true,\n    lowercase: true,\n    index: true,\n    trim: true,\n    match: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/,\n  })\n  email: string;\n\n  @Prop({\n    required: true,\n    select: false,\n  })\n  password: string;\n\n  @Prop({\n    required: true,\n    enum: Object.values(UserRole),\n    index: true,\n  })\n  role: UserRole;\n\n  @Prop({\n    type: Profile,\n    required: true,\n  })\n  profile: UserProfile;\n\n  @Prop({\n    type: Preferences,\n    required: true,\n    default: {},\n  })\n  preferences: UserPreferences;\n\n  @Prop({\n    default: true,\n  })\n  isActive: boolean;\n\n  @Prop({\n    default: false,\n    index: true,\n  })\n  isValidated: boolean;\n\n  @Prop({\n    type: Date,\n  })\n  lastLogin?: Date;\n\n  @Prop({\n    select: false,\n  })\n  refreshToken?: string;\n}\n\nexport const UserSchema = SchemaFactory.createForClass(User);\n\n// Indexes\nUserSchema.index({ email: 1 });\nUserSchema.index({ role: 1 });\nUserSchema.index({ isValidated: 1 });\nUserSchema.index({ 'profile.company': 1 });\nUserSchema.index({ isActive: 1 });\nUserSchema.index({ role: 1, isValidated: 1 });\n\n// Pre-save middleware for data normalization\nUserSchema.pre('save', function (next) {\n  if (this.email) {\n    this.email = this.email.toLowerCase().trim();\n  }\n  if (this.profile?.name) {\n    this.profile.name = this.profile.name.trim();\n  }\n  if (this.profile?.company) {\n    this.profile.company = this.profile.company.trim();\n  }\n  if (this.profile?.position) {\n    this.profile.position = this.profile.position.trim();\n  }\n  next();\n});\n\n// Virtual fields\nUserSchema.virtual('displayName').get(function () {\n  return this.profile?.name || this.email.split('@')[0];\n});\n\n// Schema methods\nUserSchema.methods['toJSON'] = function () {\n  const obj = this['toObject']();\n  delete obj.password;\n  delete obj.refreshToken;\n  return obj;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}