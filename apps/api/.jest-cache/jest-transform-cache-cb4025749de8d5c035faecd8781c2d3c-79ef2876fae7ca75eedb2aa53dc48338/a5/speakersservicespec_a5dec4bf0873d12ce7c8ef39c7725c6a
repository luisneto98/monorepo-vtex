6c9863ef5364504e1a6a4719325c5617
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const testing_1 = require("@nestjs/testing");
const mongoose_1 = require("@nestjs/mongoose");
const speakers_service_1 = require("../../../../../src/modules/speakers/speakers.service");
const speaker_schema_1 = require("../../../../../src/modules/speakers/schemas/speaker.schema");
const common_1 = require("@nestjs/common");
const storage_service_1 = require("../../../../../src/modules/storage/services/storage.service");
const storage_types_1 = require("../../../../../src/modules/storage/types/storage.types");
const stream_1 = require("stream");
describe('SpeakersService', () => {
    let service;
    const mockSpeaker = {
        _id: '507f1f77bcf86cd799439011',
        name: 'John Doe',
        bio: {
            'pt-BR': 'Biografia em português do palestrante com mais de cem caracteres para atender ao requisito mínimo de comprimento',
            en: 'Speaker biography in English with more than one hundred characters to meet the minimum length requirement',
        },
        photoUrl: 'https://example.com/photo.jpg',
        company: 'Tech Corp',
        position: {
            'pt-BR': 'Diretor de Tecnologia',
            en: 'Technology Director',
        },
        socialLinks: {
            linkedin: 'https://linkedin.com/in/johndoe',
            twitter: 'https://twitter.com/johndoe',
        },
        isHighlight: false,
        isVisible: true,
        priority: 100,
        tags: ['AI', 'Cloud'],
        deletedAt: null,
        save: jest.fn().mockResolvedValue(this),
    };
    const mockSpeakerModel = jest.fn().mockImplementation((dto) => ({
        ...mockSpeaker,
        ...dto,
        save: jest.fn().mockResolvedValue({ ...mockSpeaker, ...dto }),
    }));
    mockSpeakerModel.findOne = jest.fn();
    mockSpeakerModel.find = jest.fn();
    mockSpeakerModel.countDocuments = jest.fn();
    mockSpeakerModel.create = jest.fn();
    const mockStorageService = {
        uploadFile: jest.fn().mockResolvedValue({
            key: 'speaker-photos/12345-67890.jpg',
            url: 'https://test-bucket.s3.us-east-1.amazonaws.com/speaker-photos/12345-67890.jpg',
        }),
    };
    beforeEach(async () => {
        const module = await testing_1.Test.createTestingModule({
            providers: [
                speakers_service_1.SpeakersService,
                {
                    provide: (0, mongoose_1.getModelToken)(speaker_schema_1.Speaker.name),
                    useValue: mockSpeakerModel,
                },
                {
                    provide: storage_service_1.StorageService,
                    useValue: mockStorageService,
                },
            ],
        }).compile();
        service = module.get(speakers_service_1.SpeakersService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('create', () => {
        it('should create a new speaker', async () => {
            const createDto = {
                name: 'Jane Smith',
                bio: {
                    'pt-BR': 'Biografia em português do palestrante com mais de cem caracteres para atender ao requisito mínimo de comprimento',
                    en: 'Speaker biography in English with more than one hundred characters to meet the minimum length requirement',
                    es: 'Biografía del ponente en español con más de cien caracteres para cumplir con el requisito de longitud mínima',
                },
                photoUrl: 'https://example.com/jane.jpg',
                company: 'Innovation Inc',
                position: {
                    'pt-BR': 'CEO',
                    en: 'CEO',
                    es: 'CEO',
                },
            };
            mockSpeakerModel.findOne.mockResolvedValue(null);
            const result = await service.create(createDto);
            expect(mockSpeakerModel.findOne).toHaveBeenCalledWith({
                name: createDto.name,
                deletedAt: null,
            });
            expect(result).toBeDefined();
        });
        it('should throw ConflictException if speaker already exists', async () => {
            const createDto = {
                name: 'John Doe',
                bio: {
                    'pt-BR': 'Bio em português',
                    en: 'Bio in English',
                    es: 'Bio en español',
                },
                photoUrl: 'https://example.com/photo.jpg',
                company: 'Tech Corp',
                position: {
                    'pt-BR': 'CTO',
                    en: 'CTO',
                    es: 'CTO',
                },
            };
            mockSpeakerModel.findOne.mockResolvedValue(mockSpeaker);
            await expect(service.create(createDto)).rejects.toThrow(common_1.ConflictException);
        });
    });
    describe('findAll', () => {
        it('should return paginated speakers', async () => {
            const filterDto = {
                page: 1,
                limit: 10,
                search: '',
                sort: '-createdAt',
            };
            const speakers = [mockSpeaker];
            mockSpeakerModel.find.mockReturnValue({
                sort: jest.fn().mockReturnThis(),
                skip: jest.fn().mockReturnThis(),
                limit: jest.fn().mockReturnThis(),
                exec: jest.fn().mockResolvedValue(speakers),
            });
            mockSpeakerModel.countDocuments.mockResolvedValue(1);
            const result = await service.findAll(filterDto);
            expect(result).toEqual({
                success: true,
                data: speakers,
                metadata: {
                    total: 1,
                    page: 1,
                    limit: 10,
                    hasNext: false,
                    hasPrev: false,
                },
            });
        });
        it('should apply filters correctly', async () => {
            const filterDto = {
                page: 1,
                limit: 20,
                isHighlight: true,
                tags: ['AI', 'Cloud'],
            };
            mockSpeakerModel.find.mockReturnValue({
                sort: jest.fn().mockReturnThis(),
                skip: jest.fn().mockReturnThis(),
                limit: jest.fn().mockReturnThis(),
                exec: jest.fn().mockResolvedValue([]),
            });
            mockSpeakerModel.countDocuments.mockResolvedValue(0);
            await service.findAll(filterDto);
            expect(mockSpeakerModel.find).toHaveBeenCalledWith({
                deletedAt: null,
                isHighlight: true,
                tags: { $in: ['AI', 'Cloud'] },
            });
        });
    });
    describe('findById', () => {
        it('should return a speaker by id', async () => {
            mockSpeakerModel.findOne.mockReturnValue({
                exec: jest.fn().mockResolvedValue(mockSpeaker),
            });
            const result = await service.findById('507f1f77bcf86cd799439011');
            expect(result).toEqual(mockSpeaker);
            expect(mockSpeakerModel.findOne).toHaveBeenCalledWith({
                _id: '507f1f77bcf86cd799439011',
                deletedAt: null,
            });
        });
        it('should throw NotFoundException if speaker not found', async () => {
            mockSpeakerModel.findOne.mockReturnValue({
                exec: jest.fn().mockResolvedValue(null),
            });
            await expect(service.findById('507f1f77bcf86cd799439011')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('update', () => {
        it('should update a speaker', async () => {
            const updateDto = {
                company: 'New Company',
            };
            const existingSpeaker = {
                ...mockSpeaker,
                save: jest.fn().mockResolvedValue({ ...mockSpeaker, ...updateDto }),
            };
            mockSpeakerModel.findOne.mockResolvedValueOnce(existingSpeaker).mockResolvedValueOnce(null);
            const result = await service.update('507f1f77bcf86cd799439011', updateDto);
            expect(result).toBeDefined();
            expect(existingSpeaker.save).toHaveBeenCalled();
        });
        it('should throw NotFoundException if speaker not found', async () => {
            mockSpeakerModel.findOne.mockResolvedValue(null);
            await expect(service.update('507f1f77bcf86cd799439011', {})).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('remove', () => {
        it('should soft delete a speaker', async () => {
            const speaker = {
                ...mockSpeaker,
                deletedAt: null,
                deleteReason: null,
                deletedBy: null,
                save: jest.fn().mockResolvedValue(mockSpeaker),
            };
            mockSpeakerModel.findOne.mockResolvedValue(speaker);
            await service.remove('507f1f77bcf86cd799439011', 'Test reason', 'userId');
            expect(speaker.deletedAt).toBeDefined();
            expect(speaker.deleteReason).toBe('Test reason');
            expect(speaker.save).toHaveBeenCalled();
        });
        it('should throw NotFoundException if speaker not found', async () => {
            mockSpeakerModel.findOne.mockResolvedValue(null);
            await expect(service.remove('507f1f77bcf86cd799439011')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('restore', () => {
        it('should restore a soft-deleted speaker', async () => {
            const deletedSpeaker = {
                ...mockSpeaker,
                deletedAt: new Date(),
                deletedBy: 'userId',
                deleteReason: 'Test',
                save: jest.fn().mockResolvedValue(mockSpeaker),
            };
            mockSpeakerModel.findOne.mockResolvedValue(deletedSpeaker);
            await service.restore('507f1f77bcf86cd799439011');
            expect(deletedSpeaker.deletedAt).toBeNull();
            expect(deletedSpeaker.deletedBy).toBeNull();
            expect(deletedSpeaker.deleteReason).toBeNull();
            expect(deletedSpeaker.save).toHaveBeenCalled();
        });
        it('should throw NotFoundException if deleted speaker not found', async () => {
            mockSpeakerModel.findOne.mockResolvedValue(null);
            await expect(service.restore('507f1f77bcf86cd799439011')).rejects.toThrow(common_1.NotFoundException);
        });
    });
    describe('findHighlights', () => {
        it('should return highlighted speakers', async () => {
            const highlights = [{ ...mockSpeaker, isHighlight: true }];
            mockSpeakerModel.find.mockReturnValue({
                sort: jest.fn().mockReturnThis(),
                exec: jest.fn().mockResolvedValue(highlights),
            });
            const result = await service.findHighlights();
            expect(result).toEqual(highlights);
            expect(mockSpeakerModel.find).toHaveBeenCalledWith({
                isHighlight: true,
                isVisible: true,
                deletedAt: null,
            });
        });
    });
    describe('uploadPhoto', () => {
        const createMockFile = (buffer, mimetype, size, originalname = 'test.jpg') => ({
            buffer,
            mimetype,
            size,
            originalname,
            fieldname: 'file',
            encoding: '7bit',
            destination: '',
            filename: '',
            path: '',
            stream: new stream_1.Readable(),
        });
        it('should successfully upload a photo and update speaker', async () => {
            const speakerId = '507f1f77bcf86cd799439011';
            const file = createMockFile(Buffer.alloc(1000, 'a'), 'image/jpeg', 1000);
            const mockSpeakerDoc = {
                ...mockSpeaker,
                _id: speakerId,
                photoUrl: 'https://example.com/old-photo.jpg',
                save: jest.fn().mockResolvedValue({
                    ...mockSpeaker,
                    photoUrl: 'https://test-bucket.s3.us-east-1.amazonaws.com/speaker-photos/12345-67890.jpg',
                }),
            };
            mockSpeakerModel.findOne.mockResolvedValue(mockSpeakerDoc);
            const result = await service.uploadPhoto(speakerId, file);
            expect(result).toBe('https://test-bucket.s3.us-east-1.amazonaws.com/speaker-photos/12345-67890.jpg');
            expect(mockSpeakerModel.findOne).toHaveBeenCalledWith({
                _id: speakerId,
                deletedAt: null,
            });
            expect(mockStorageService.uploadFile).toHaveBeenCalledWith(file, storage_types_1.FileCategory.SPEAKER_PHOTOS);
            expect(mockSpeakerDoc.save).toHaveBeenCalled();
            expect(mockSpeakerDoc.photoUrl).toBe('https://test-bucket.s3.us-east-1.amazonaws.com/speaker-photos/12345-67890.jpg');
        });
        it('should throw NotFoundException when speaker does not exist', async () => {
            const speakerId = '507f1f77bcf86cd799439012';
            const file = createMockFile(Buffer.alloc(1000, 'a'), 'image/jpeg', 1000);
            mockSpeakerModel.findOne.mockResolvedValue(null);
            await expect(service.uploadPhoto(speakerId, file)).rejects.toThrow(common_1.NotFoundException);
            await expect(service.uploadPhoto(speakerId, file)).rejects.toThrow(`Speaker with ID ${speakerId} not found`);
            expect(mockStorageService.uploadFile).not.toHaveBeenCalled();
        });
        it('should throw NotFoundException when speaker is deleted', async () => {
            const speakerId = '507f1f77bcf86cd799439011';
            const file = createMockFile(Buffer.alloc(1000, 'a'), 'image/jpeg', 1000);
            // Soft-deleted speaker
            mockSpeakerModel.findOne.mockResolvedValue(null);
            await expect(service.uploadPhoto(speakerId, file)).rejects.toThrow(common_1.NotFoundException);
            expect(mockSpeakerModel.findOne).toHaveBeenCalledWith({
                _id: speakerId,
                deletedAt: null,
            });
        });
        it('should propagate StorageService errors', async () => {
            const speakerId = '507f1f77bcf86cd799439011';
            const file = createMockFile(Buffer.alloc(1000, 'a'), 'image/jpeg', 1000);
            const mockSpeakerDoc = {
                ...mockSpeaker,
                _id: speakerId,
                photoUrl: 'https://example.com/old-photo.jpg',
                save: jest.fn(),
            };
            mockSpeakerModel.findOne.mockResolvedValue(mockSpeakerDoc);
            mockStorageService.uploadFile.mockRejectedValueOnce(new Error('S3 upload failed'));
            await expect(service.uploadPhoto(speakerId, file)).rejects.toThrow('S3 upload failed');
            expect(mockSpeakerDoc.save).not.toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbHVpc25ldG85OC9Eb2N1bWVudG9zL0NvZGUvbW9ub3JlcG8tdnRleC9hcHBzL2FwaS90ZXN0cy91bml0L21vZHVsZXMvc3BlYWtlcnMvc2VydmljZXMvc3BlYWtlcnMuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQXNEO0FBQ3RELCtDQUFpRDtBQUNqRCwyRkFBdUY7QUFDdkYsK0ZBQXFGO0FBQ3JGLDJDQUFzRTtBQUN0RSxpR0FBNkY7QUFDN0YsMEZBQXNGO0FBQ3RGLG1DQUFrQztBQUVsQyxRQUFRLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxFQUFFO0lBQy9CLElBQUksT0FBd0IsQ0FBQztJQUU3QixNQUFNLFdBQVcsR0FBRztRQUNsQixHQUFHLEVBQUUsMEJBQTBCO1FBQy9CLElBQUksRUFBRSxVQUFVO1FBQ2hCLEdBQUcsRUFBRTtZQUNILE9BQU8sRUFDTCxrSEFBa0g7WUFDcEgsRUFBRSxFQUFFLDJHQUEyRztTQUNoSDtRQUNELFFBQVEsRUFBRSwrQkFBK0I7UUFDekMsT0FBTyxFQUFFLFdBQVc7UUFDcEIsUUFBUSxFQUFFO1lBQ1IsT0FBTyxFQUFFLHVCQUF1QjtZQUNoQyxFQUFFLEVBQUUscUJBQXFCO1NBQzFCO1FBQ0QsV0FBVyxFQUFFO1lBQ1gsUUFBUSxFQUFFLGlDQUFpQztZQUMzQyxPQUFPLEVBQUUsNkJBQTZCO1NBQ3ZDO1FBQ0QsV0FBVyxFQUFFLEtBQUs7UUFDbEIsU0FBUyxFQUFFLElBQUk7UUFDZixRQUFRLEVBQUUsR0FBRztRQUNiLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUM7UUFDckIsU0FBUyxFQUFFLElBQUk7UUFDZixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztLQUN4QyxDQUFDO0lBRUYsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFD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QVMsR0FBRywwQkFBMEIsQ0FBQztZQUM3QyxNQUFNLElBQUksR0FBRyxjQUFjLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUUsWUFBWSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXpFLE1BQU0sY0FBYyxHQUFHO2dCQUNyQixHQUFHLFdBQVc7Z0JBQ2QsR0FBRyxFQUFFLFNBQVM7Z0JBQ2QsUUFBUSxFQUFFLG1DQUFtQztnQkFDN0MsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7YUFDaEIsQ0FBQztZQUVGLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMzRCxrQkFBa0IsQ0FBQyxVQUFVLENBQUMscUJBQXFCLENBQ2pELElBQUksS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQzlCLENBQUM7WUFFRixNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN2RixNQUFNLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9sdWlzbmV0bzk4L0RvY3VtZW50b3MvQ29kZS9tb25vcmVwby12dGV4L2FwcHMvYXBpL3Rlc3RzL3VuaXQvbW9kdWxlcy9zcGVha2Vycy9zZXJ2aWNlcy9zcGVha2Vycy5zZXJ2aWNlLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVzdCwgVGVzdGluZ01vZHVsZSB9IGZyb20gJ0BuZXN0anMvdGVzdGluZyc7XG5pbXBvcnQgeyBnZXRNb2RlbFRva2VuIH0gZnJvbSAnQG5lc3Rqcy9tb25nb29zZSc7XG5pbXBvcnQgeyBTcGVha2Vyc1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9zcGVha2Vycy9zcGVha2Vycy5zZXJ2aWNlJztcbmltcG9ydCB7IFNwZWFrZXIgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9zcGVha2Vycy9zY2hlbWFzL3NwZWFrZXIuc2NoZW1hJztcbmltcG9ydCB7IE5vdEZvdW5kRXhjZXB0aW9uLCBDb25mbGljdEV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc3RvcmFnZS9zZXJ2aWNlcy9zdG9yYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgRmlsZUNhdGVnb3J5IH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc3RvcmFnZS90eXBlcy9zdG9yYWdlLnR5cGVzJztcbmltcG9ydCB7IFJlYWRhYmxlIH0gZnJvbSAnc3RyZWFtJztcblxuZGVzY3JpYmUoJ1NwZWFrZXJzU2VydmljZScsICgpID0+IHtcbiAgbGV0IHNlcnZpY2U6IFNwZWFrZXJzU2VydmljZTtcblxuICBjb25zdCBtb2NrU3BlYWtlciA9IHtcbiAgICBfaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxuICAgIG5hbWU6ICdKb2huIERvZScsXG4gICAgYmlvOiB7XG4gICAgICAncHQtQlInOlxuICAgICAgICAnQmlvZ3JhZmlhIGVtIHBvcnR1Z3XDqnMgZG8gcGFsZXN0cmFudGUgY29tIG1haXMgZGUgY2VtIGNhcmFjdGVyZXMgcGFyYSBhdGVuZGVyIGFvIHJlcXVpc2l0byBtw61uaW1vIGRlIGNvbXByaW1lbnRvJyxcbiAgICAgIGVuOiAnU3BlYWtlciBiaW9ncmFwaHkgaW4gRW5nbGlzaCB3aXRoIG1vcmUgdGhhbiBvbmUgaHVuZHJlZCBjaGFyYWN0ZXJzIHRvIG1lZXQgdGhlIG1pbmltdW0gbGVuZ3RoIHJlcXVpcmVtZW50JyxcbiAgICB9LFxuICAgIHBob3RvVXJsOiAnaHR0cHM6Ly9leGFtcGxlLmNvbS9waG90by5qcGcnLFxuICAgIGNvbXBhbnk6ICdUZWNoIENvcnAnLFxuICAgIHBvc2l0aW9uOiB7XG4gICAgICAncHQtQlInOiAnRGlyZXRvciBkZSBUZWNub2xvZ2lhJyxcbiAgICAgIGVuOiAnVGVjaG5vbG9neSBEaXJlY3RvcicsXG4gICAgfSxcbiAgICBzb2NpYWxMaW5rczoge1xuICAgICAgbGlua2VkaW46ICdodHRwczovL2xpbmtlZGluLmNvbS9pbi9qb2huZG9lJyxcbiAgICAgIHR3aXR0ZXI6ICdodHRwczovL3R3aXR0ZXIuY29tL2pvaG5kb2UnLFxuICAgIH0sXG4gICAgaXNIaWdobGlnaHQ6IGZhbHNlLFxuICAgIGlzVmlzaWJsZTogdHJ1ZSxcbiAgICBwcmlvcml0eTogMTAwLFxuICAgIHRhZ3M6IFsnQUknLCAnQ2xvdWQnXSxcbiAgICBkZWxldGVkQXQ6IG51bGwsXG4gICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRoaXMpLFxuICB9O1xuXG4gIGNvbnN0IG1vY2tTcGVha2VyTW9kZWwgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChkdG8pID0+ICh7XG4gICAgLi4ubW9ja1NwZWFrZXIsXG4gICAgLi4uZHRvLFxuICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IC4uLm1vY2tTcGVha2VyLCAuLi5kdG8gfSksXG4gIH0pKSBhcyBhbnk7XG5cbiAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lID0gamVzdC5mbigpO1xuICBtb2NrU3BlYWtlck1vZGVsLmZpbmQgPSBqZXN0LmZuKCk7XG4gIG1vY2tTcGVha2VyTW9kZWwuY291bnREb2N1bWVudHMgPSBqZXN0LmZuKCk7XG4gIG1vY2tTcGVha2VyTW9kZWwuY3JlYXRlID0gamVzdC5mbigpO1xuXG4gIGNvbnN0IG1vY2tTdG9yYWdlU2VydmljZSA9IHtcbiAgICB1cGxvYWRGaWxlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAga2V5OiAnc3BlYWtlci1waG90b3MvMTIzNDUtNjc4OTAuanBnJyxcbiAgICAgIHVybDogJ2h0dHBzOi8vdGVzdC1idWNrZXQuczMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vc3BlYWtlci1waG90b3MvMTIzNDUtNjc4OTAuanBnJyxcbiAgICB9KSxcbiAgfTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIFNwZWFrZXJzU2VydmljZSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGdldE1vZGVsVG9rZW4oU3BlYWtlci5uYW1lKSxcbiAgICAgICAgICB1c2VWYWx1ZTogbW9ja1NwZWFrZXJNb2RlbCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICAgIHVzZVZhbHVlOiBtb2NrU3RvcmFnZVNlcnZpY2UsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pLmNvbXBpbGUoKTtcblxuICAgIHNlcnZpY2UgPSBtb2R1bGUuZ2V0PFNwZWFrZXJzU2VydmljZT4oU3BlYWtlcnNTZXJ2aWNlKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBhIG5ldyBzcGVha2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY3JlYXRlRHRvID0ge1xuICAgICAgICBuYW1lOiAnSmFuZSBTbWl0aCcsXG4gICAgICAgIGJpbzoge1xuICAgICAgICAgICdwdC1CUic6XG4gICAgICAgICAgICAnQmlvZ3JhZmlhIGVtIHBvcnR1Z3XDqnMgZG8gcGFsZXN0cmFudGUgY29tIG1haXMgZGUgY2VtIGNhcmFjdGVyZXMgcGFyYSBhdGVuZGVyIGFvIHJlcXVpc2l0byBtw61uaW1vIGRlIGNvbXByaW1lbnRvJyxcbiAgICAgICAgICBlbjogJ1NwZWFrZXIgYmlvZ3JhcGh5IGluIEVuZ2xpc2ggd2l0aCBtb3JlIHRoYW4gb25lIGh1bmRyZWQgY2hhcmFjdGVycyB0byBtZWV0IHRoZSBtaW5pbXVtIGxlbmd0aCByZXF1aXJlbWVudCcsXG4gICAgICAgICAgZXM6ICdCaW9ncmFmw61hIGRlbCBwb25lbnRlIGVuIGVzcGHDsW9sIGNvbiBtw6FzIGRlIGNpZW4gY2FyYWN0ZXJlcyBwYXJhIGN1bXBsaXIgY29uIGVsIHJlcXVpc2l0byBkZSBsb25naXR1ZCBtw61uaW1hJyxcbiAgICAgICAgfSxcbiAgICAgICAgcGhvdG9Vcmw6ICdodHRwczovL2V4YW1wbGUuY29tL2phbmUuanBnJyxcbiAgICAgICAgY29tcGFueTogJ0lubm92YXRpb24gSW5jJyxcbiAgICAgICAgcG9zaXRpb246IHtcbiAgICAgICAgICAncHQtQlInOiAnQ0VPJyxcbiAgICAgICAgICBlbjogJ0NFTycsXG4gICAgICAgICAgZXM6ICdDRU8nLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmNyZWF0ZShjcmVhdGVEdG8pO1xuXG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJNb2RlbC5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIG5hbWU6IGNyZWF0ZUR0by5uYW1lLFxuICAgICAgICBkZWxldGVkQXQ6IG51bGwsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IENvbmZsaWN0RXhjZXB0aW9uIGlmIHNwZWFrZXIgYWxyZWFkeSBleGlzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVEdG8gPSB7XG4gICAgICAgIG5hbWU6ICdKb2huIERvZScsXG4gICAgICAgIGJpbzoge1xuICAgICAgICAgICdwdC1CUic6ICdCaW8gZW0gcG9ydHVndcOqcycsXG4gICAgICAgICAgZW46ICdCaW8gaW4gRW5nbGlzaCcsXG4gICAgICAgICAgZXM6ICdCaW8gZW4gZXNwYcOxb2wnLFxuICAgICAgICB9LFxuICAgICAgICBwaG90b1VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vcGhvdG8uanBnJyxcbiAgICAgICAgY29tcGFueTogJ1RlY2ggQ29ycCcsXG4gICAgICAgIHBvc2l0aW9uOiB7XG4gICAgICAgICAgJ3B0LUJSJzogJ0NUTycsXG4gICAgICAgICAgZW46ICdDVE8nLFxuICAgICAgICAgIGVzOiAnQ1RPJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3BlYWtlcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmNyZWF0ZShjcmVhdGVEdG8pKS5yZWplY3RzLnRvVGhyb3coQ29uZmxpY3RFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEFsbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwYWdpbmF0ZWQgc3BlYWtlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmaWx0ZXJEdG8gPSB7XG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIGxpbWl0OiAxMCxcbiAgICAgICAgc2VhcmNoOiAnJyxcbiAgICAgICAgc29ydDogJy1jcmVhdGVkQXQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc3BlYWtlcnMgPSBbbW9ja1NwZWFrZXJdO1xuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIHNvcnQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgICAgbGltaXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBleGVjOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoc3BlYWtlcnMpLFxuICAgICAgfSk7XG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmNvdW50RG9jdW1lbnRzLm1vY2tSZXNvbHZlZFZhbHVlKDEpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRBbGwoZmlsdGVyRHRvKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHNwZWFrZXJzLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHRvdGFsOiAxLFxuICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgbGltaXQ6IDEwLFxuICAgICAgICAgIGhhc05leHQ6IGZhbHNlLFxuICAgICAgICAgIGhhc1ByZXY6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFwcGx5IGZpbHRlcnMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmlsdGVyRHRvID0ge1xuICAgICAgICBwYWdlOiAxLFxuICAgICAgICBsaW1pdDogMjAsXG4gICAgICAgIGlzSGlnaGxpZ2h0OiB0cnVlLFxuICAgICAgICB0YWdzOiBbJ0FJJywgJ0Nsb3VkJ10sXG4gICAgICB9O1xuXG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc29ydDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIHNraXA6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgICBsaW1pdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gICAgICB9KTtcbiAgICAgIG1vY2tTcGVha2VyTW9kZWwuY291bnREb2N1bWVudHMubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuZmluZEFsbChmaWx0ZXJEdG8pO1xuXG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJNb2RlbC5maW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRlbGV0ZWRBdDogbnVsbCxcbiAgICAgICAgaXNIaWdobGlnaHQ6IHRydWUsXG4gICAgICAgIHRhZ3M6IHsgJGluOiBbJ0FJJywgJ0Nsb3VkJ10gfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEJ5SWQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBzcGVha2VyIGJ5IGlkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3BlYWtlciksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5maW5kQnlJZCgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1NwZWFrZXIpO1xuICAgICAgZXhwZWN0KG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBfaWQ6ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnLFxuICAgICAgICBkZWxldGVkQXQ6IG51bGwsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgc3BlYWtlciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmRPbmUubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgZXhlYzogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmZpbmRCeUlkKCc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhIHNwZWFrZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVEdG8gPSB7XG4gICAgICAgIGNvbXBhbnk6ICdOZXcgQ29tcGFueScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBleGlzdGluZ1NwZWFrZXIgPSB7XG4gICAgICAgIC4uLm1vY2tTcGVha2VyLFxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyAuLi5tb2NrU3BlYWtlciwgLi4udXBkYXRlRHRvIH0pLFxuICAgICAgfTtcblxuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlT25jZShleGlzdGluZ1NwZWFrZXIpLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGRhdGUoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScsIHVwZGF0ZUR0byk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZXhpc3RpbmdTcGVha2VyLnNhdmUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gaWYgc3BlYWtlciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwZGF0ZSgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywge30pKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIE5vdEZvdW5kRXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlbW92ZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNvZnQgZGVsZXRlIGEgc3BlYWtlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZWFrZXIgPSB7XG4gICAgICAgIC4uLm1vY2tTcGVha2VyLFxuICAgICAgICBkZWxldGVkQXQ6IG51bGwgYXMgYW55LFxuICAgICAgICBkZWxldGVSZWFzb246IG51bGwgYXMgYW55LFxuICAgICAgICBkZWxldGVkQnk6IG51bGwgYXMgYW55LFxuICAgICAgICBzYXZlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NwZWFrZXIpLFxuICAgICAgfTtcblxuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKHNwZWFrZXIpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnJlbW92ZSgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJywgJ1Rlc3QgcmVhc29uJywgJ3VzZXJJZCcpO1xuXG4gICAgICBleHBlY3Qoc3BlYWtlci5kZWxldGVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3Qoc3BlYWtlci5kZWxldGVSZWFzb24pLnRvQmUoJ1Rlc3QgcmVhc29uJyk7XG4gICAgICBleHBlY3Qoc3BlYWtlci5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIHNwZWFrZXIgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS5yZW1vdmUoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVzdG9yZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJlc3RvcmUgYSBzb2Z0LWRlbGV0ZWQgc3BlYWtlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbGV0ZWRTcGVha2VyID0ge1xuICAgICAgICAuLi5tb2NrU3BlYWtlcixcbiAgICAgICAgZGVsZXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICBkZWxldGVkQnk6ICd1c2VySWQnLFxuICAgICAgICBkZWxldGVSZWFzb246ICdUZXN0JyxcbiAgICAgICAgc2F2ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTcGVha2VyKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShkZWxldGVkU3BlYWtlcik7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UucmVzdG9yZSgnNTA3ZjFmNzdiY2Y4NmNkNzk5NDM5MDExJyk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkU3BlYWtlci5kZWxldGVkQXQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QoZGVsZXRlZFNwZWFrZXIuZGVsZXRlZEJ5KS50b0JlTnVsbCgpO1xuICAgICAgZXhwZWN0KGRlbGV0ZWRTcGVha2VyLmRlbGV0ZVJlYXNvbikudG9CZU51bGwoKTtcbiAgICAgIGV4cGVjdChkZWxldGVkU3BlYWtlci5zYXZlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIGlmIGRlbGV0ZWQgc3BlYWtlciBub3QgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnJlc3RvcmUoJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMScpKS5yZWplY3RzLnRvVGhyb3coTm90Rm91bmRFeGNlcHRpb24pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZmluZEhpZ2hsaWdodHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gaGlnaGxpZ2h0ZWQgc3BlYWtlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBoaWdobGlnaHRzID0gW3sgLi4ubW9ja1NwZWFrZXIsIGlzSGlnaGxpZ2h0OiB0cnVlIH1dO1xuXG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmQubW9ja1JldHVyblZhbHVlKHtcbiAgICAgICAgc29ydDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICAgIGV4ZWM6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShoaWdobGlnaHRzKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmZpbmRIaWdobGlnaHRzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoaGlnaGxpZ2h0cyk7XG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJNb2RlbC5maW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGlzSGlnaGxpZ2h0OiB0cnVlLFxuICAgICAgICBpc1Zpc2libGU6IHRydWUsXG4gICAgICAgIGRlbGV0ZWRBdDogbnVsbCxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBsb2FkUGhvdG8nLCAoKSA9PiB7XG4gICAgY29uc3QgY3JlYXRlTW9ja0ZpbGUgPSAoXG4gICAgICBidWZmZXI6IEJ1ZmZlcixcbiAgICAgIG1pbWV0eXBlOiBzdHJpbmcsXG4gICAgICBzaXplOiBudW1iZXIsXG4gICAgICBvcmlnaW5hbG5hbWUgPSAndGVzdC5qcGcnLFxuICAgICk6IEV4cHJlc3MuTXVsdGVyLkZpbGUgPT4gKHtcbiAgICAgIGJ1ZmZlcixcbiAgICAgIG1pbWV0eXBlLFxuICAgICAgc2l6ZSxcbiAgICAgIG9yaWdpbmFsbmFtZSxcbiAgICAgIGZpZWxkbmFtZTogJ2ZpbGUnLFxuICAgICAgZW5jb2Rpbmc6ICc3Yml0JyxcbiAgICAgIGRlc3RpbmF0aW9uOiAnJyxcbiAgICAgIGZpbGVuYW1lOiAnJyxcbiAgICAgIHBhdGg6ICcnLFxuICAgICAgc3RyZWFtOiBuZXcgUmVhZGFibGUoKSxcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHVwbG9hZCBhIHBob3RvIGFuZCB1cGRhdGUgc3BlYWtlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZWFrZXJJZCA9ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnO1xuICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZU1vY2tGaWxlKEJ1ZmZlci5hbGxvYygxMDAwLCAnYScpLCAnaW1hZ2UvanBlZycsIDEwMDApO1xuXG4gICAgICBjb25zdCBtb2NrU3BlYWtlckRvYyA9IHtcbiAgICAgICAgLi4ubW9ja1NwZWFrZXIsXG4gICAgICAgIF9pZDogc3BlYWtlcklkLFxuICAgICAgICBwaG90b1VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vb2xkLXBob3RvLmpwZycsXG4gICAgICAgIHNhdmU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgICAgLi4ubW9ja1NwZWFrZXIsXG4gICAgICAgICAgcGhvdG9Vcmw6ICdodHRwczovL3Rlc3QtYnVja2V0LnMzLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3NwZWFrZXItcGhvdG9zLzEyMzQ1LTY3ODkwLmpwZycsXG4gICAgICAgIH0pLFxuICAgICAgfTtcblxuICAgICAgbW9ja1NwZWFrZXJNb2RlbC5maW5kT25lLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tTcGVha2VyRG9jKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS51cGxvYWRQaG90byhzcGVha2VySWQsIGZpbGUpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKCdodHRwczovL3Rlc3QtYnVja2V0LnMzLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3NwZWFrZXItcGhvdG9zLzEyMzQ1LTY3ODkwLmpwZycpO1xuICAgICAgZXhwZWN0KG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBfaWQ6IHNwZWFrZXJJZCxcbiAgICAgICAgZGVsZXRlZEF0OiBudWxsLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja1N0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGZpbGUsIEZpbGVDYXRlZ29yeS5TUEVBS0VSX1BIT1RPUyk7XG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJEb2Muc2F2ZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tTcGVha2VyRG9jLnBob3RvVXJsKS50b0JlKFxuICAgICAgICAnaHR0cHM6Ly90ZXN0LWJ1Y2tldC5zMy51cy1lYXN0LTEuYW1hem9uYXdzLmNvbS9zcGVha2VyLXBob3Rvcy8xMjM0NS02Nzg5MC5qcGcnLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgTm90Rm91bmRFeGNlcHRpb24gd2hlbiBzcGVha2VyIGRvZXMgbm90IGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3BlYWtlcklkID0gJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMic7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoQnVmZmVyLmFsbG9jKDEwMDAsICdhJyksICdpbWFnZS9qcGVnJywgMTAwMCk7XG5cbiAgICAgIG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkUGhvdG8oc3BlYWtlcklkLCBmaWxlKSkucmVqZWN0cy50b1Rocm93KE5vdEZvdW5kRXhjZXB0aW9uKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZFBob3RvKHNwZWFrZXJJZCwgZmlsZSkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgYFNwZWFrZXIgd2l0aCBJRCAke3NwZWFrZXJJZH0gbm90IGZvdW5kYCxcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1N0b3JhZ2VTZXJ2aWNlLnVwbG9hZEZpbGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IE5vdEZvdW5kRXhjZXB0aW9uIHdoZW4gc3BlYWtlciBpcyBkZWxldGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3BlYWtlcklkID0gJzUwN2YxZjc3YmNmODZjZDc5OTQzOTAxMSc7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoQnVmZmVyLmFsbG9jKDEwMDAsICdhJyksICdpbWFnZS9qcGVnJywgMTAwMCk7XG5cbiAgICAgIC8vIFNvZnQtZGVsZXRlZCBzcGVha2VyXG4gICAgICBtb2NrU3BlYWtlck1vZGVsLmZpbmRPbmUubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZFBob3RvKHNwZWFrZXJJZCwgZmlsZSkpLnJlamVjdHMudG9UaHJvdyhOb3RGb3VuZEV4Y2VwdGlvbik7XG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJNb2RlbC5maW5kT25lKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIF9pZDogc3BlYWtlcklkLFxuICAgICAgICBkZWxldGVkQXQ6IG51bGwsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvcGFnYXRlIFN0b3JhZ2VTZXJ2aWNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNwZWFrZXJJZCA9ICc1MDdmMWY3N2JjZjg2Y2Q3OTk0MzkwMTEnO1xuICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZU1vY2tGaWxlKEJ1ZmZlci5hbGxvYygxMDAwLCAnYScpLCAnaW1hZ2UvanBlZycsIDEwMDApO1xuXG4gICAgICBjb25zdCBtb2NrU3BlYWtlckRvYyA9IHtcbiAgICAgICAgLi4ubW9ja1NwZWFrZXIsXG4gICAgICAgIF9pZDogc3BlYWtlcklkLFxuICAgICAgICBwaG90b1VybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vb2xkLXBob3RvLmpwZycsXG4gICAgICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tTcGVha2VyTW9kZWwuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrU3BlYWtlckRvYyk7XG4gICAgICBtb2NrU3RvcmFnZVNlcnZpY2UudXBsb2FkRmlsZS5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoXG4gICAgICAgIG5ldyBFcnJvcignUzMgdXBsb2FkIGZhaWxlZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkUGhvdG8oc3BlYWtlcklkLCBmaWxlKSkucmVqZWN0cy50b1Rocm93KCdTMyB1cGxvYWQgZmFpbGVkJyk7XG4gICAgICBleHBlY3QobW9ja1NwZWFrZXJEb2Muc2F2ZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==