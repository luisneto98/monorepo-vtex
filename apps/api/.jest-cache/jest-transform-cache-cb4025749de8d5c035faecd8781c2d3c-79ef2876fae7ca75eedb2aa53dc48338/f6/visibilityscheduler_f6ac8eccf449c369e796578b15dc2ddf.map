{"version":3,"names":["cov_24m87itwku","actualCoverage","common_1","s","require","schedule_1","system_config_service_1","VisibilityScheduler","VisibilityScheduler_1","systemConfigService","logger","Logger","name","constructor","f","handleScheduledVisibilityChanges","debug","applyScheduledChanges","error","cleanupOldAuditLogs","retentionDays","cutoffDate","Date","setDate","getDate","deletedCount","cleanupAuditLogs","exports","__decorate","Cron","CronExpression","EVERY_MINUTE","EVERY_DAY_AT_MIDNIGHT","Injectable","SystemConfigService"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/common/schedulers/visibility.scheduler.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { Cron, CronExpression } from '@nestjs/schedule';\nimport { SystemConfigService } from '../../modules/system-config/system-config.service';\n\n@Injectable()\nexport class VisibilityScheduler {\n  private readonly logger = new Logger(VisibilityScheduler.name);\n\n  constructor(private readonly systemConfigService: SystemConfigService) {}\n\n  @Cron(CronExpression.EVERY_MINUTE)\n  async handleScheduledVisibilityChanges() {\n    try {\n      this.logger.debug('Checking for scheduled visibility changes...');\n      await this.systemConfigService.applyScheduledChanges();\n    } catch (error) {\n      this.logger.error('Failed to apply scheduled visibility changes', error);\n    }\n  }\n\n  @Cron(CronExpression.EVERY_DAY_AT_MIDNIGHT)\n  async cleanupOldAuditLogs() {\n    try {\n      this.logger.debug('Starting audit log cleanup...');\n      // Cleanup logic for audit logs older than 90 days\n      const retentionDays = 90;\n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - retentionDays);\n\n      const deletedCount = await this.systemConfigService.cleanupAuditLogs(cutoffDate);\n      this.logger.debug(`Audit log cleanup completed. Deleted ${deletedCount} old records.`);\n    } catch (error) {\n      this.logger.error('Failed to cleanup audit logs', error);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}