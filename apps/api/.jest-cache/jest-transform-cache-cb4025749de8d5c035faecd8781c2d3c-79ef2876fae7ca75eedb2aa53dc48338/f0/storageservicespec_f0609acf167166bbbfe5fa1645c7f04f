5ad3577c07f0c84016b7471d57cc0888
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock AWS SDK
jest.mock('@aws-sdk/client-s3');
jest.mock('@aws-sdk/s3-request-presigner');
const testing_1 = require("@nestjs/testing");
const common_1 = require("@nestjs/common");
const storage_service_1 = require("../../../../src/modules/storage/services/storage.service");
const storage_config_service_1 = require("../../../../src/modules/storage/services/storage-config.service");
const virus_scanner_service_1 = require("../../../../src/modules/storage/services/virus-scanner.service");
const storage_types_1 = require("../../../../src/modules/storage/types/storage.types");
const client_s3_1 = require("@aws-sdk/client-s3");
const s3_request_presigner_1 = require("@aws-sdk/s3-request-presigner");
const stream_1 = require("stream");
describe('StorageService', () => {
    let service;
    let virusScannerService;
    let mockS3Send;
    const mockStorageConfigService = {
        getAwsRegion: jest.fn().mockReturnValue('us-east-1'),
        getAwsBucket: jest.fn().mockReturnValue('test-bucket'),
        getAwsAccessKeyId: jest.fn().mockReturnValue('test-access-key'),
        getAwsSecretAccessKey: jest.fn().mockReturnValue('test-secret-key'),
    };
    const mockVirusScannerService = {
        scanFile: jest.fn().mockResolvedValue(undefined),
    };
    // Helper to create mock file
    const createMockFile = (buffer, mimetype, size, originalname = 'test.jpg') => ({
        buffer,
        mimetype,
        size,
        originalname,
        fieldname: 'file',
        encoding: '7bit',
        destination: '',
        filename: '',
        path: '',
        stream: new stream_1.Readable(),
    });
    beforeEach(async () => {
        // Mock S3Client
        mockS3Send = jest.fn().mockResolvedValue({});
        client_s3_1.S3Client.mockImplementation(() => ({
            send: mockS3Send,
        }));
        const module = await testing_1.Test.createTestingModule({
            providers: [
                storage_service_1.StorageService,
                {
                    provide: storage_config_service_1.StorageConfigService,
                    useValue: mockStorageConfigService,
                },
                {
                    provide: virus_scanner_service_1.VirusScannerService,
                    useValue: mockVirusScannerService,
                },
            ],
        }).compile();
        service = module.get(storage_service_1.StorageService);
        virusScannerService = module.get(virus_scanner_service_1.VirusScannerService);
    });
    afterEach(() => {
        jest.clearAllMocks();
    });
    describe('uploadFile', () => {
        it('should successfully upload a valid JPEG image', async () => {
            // JPEG magic bytes: FF D8 FF
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            const result = await service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS);
            expect(result).toHaveProperty('key');
            expect(result).toHaveProperty('url');
            expect(result.key).toContain('speaker-photos/');
            expect(result.url).toContain('https://test-bucket.s3.us-east-1.amazonaws.com');
            expect(virusScannerService.scanFile).toHaveBeenCalledWith(file.buffer, file.originalname, file.mimetype);
            expect(mockS3Send).toHaveBeenCalledWith(expect.any(client_s3_1.PutObjectCommand));
        });
        it('should successfully upload a valid PNG image', async () => {
            // PNG magic bytes: 89 50 4E 47 0D 0A 1A 0A
            const pngBuffer = Buffer.concat([
                Buffer.from([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a]),
                Buffer.alloc(100, 'b'),
            ]);
            const file = createMockFile(pngBuffer, 'image/png', pngBuffer.length, 'test.png');
            const result = await service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS);
            expect(result).toBeDefined();
            expect(result.key).toContain('speaker-photos/');
            expect(mockS3Send).toHaveBeenCalled();
        });
        it('should successfully upload a valid WebP image', async () => {
            // WebP magic bytes: RIFF [4 bytes] WEBP
            const webpBuffer = Buffer.concat([
                Buffer.from([0x52, 0x49, 0x46, 0x46]), // RIFF
                Buffer.alloc(4, 0), // File size placeholder
                Buffer.from('WEBP', 'ascii'), // WEBP marker
                Buffer.alloc(100, 'c'),
            ]);
            const file = createMockFile(webpBuffer, 'image/webp', webpBuffer.length, 'test.webp');
            const result = await service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS);
            expect(result).toBeDefined();
            expect(result.key).toContain('speaker-photos/');
        });
        it('should successfully upload a valid PDF for legal documents', async () => {
            // PDF magic bytes: %PDF
            const pdfBuffer = Buffer.concat([
                Buffer.from([0x25, 0x50, 0x44, 0x46]),
                Buffer.alloc(100, 'd'),
            ]);
            const file = createMockFile(pdfBuffer, 'application/pdf', pdfBuffer.length, 'legal.pdf');
            const result = await service.uploadFile(file, storage_types_1.FileCategory.LEGAL_DOCUMENTS);
            expect(result).toBeDefined();
            expect(result.key).toContain('legal-documents/');
        });
        it('should skip virus scanning when scanForVirus is false', async () => {
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            await service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS, { scanForVirus: false });
            expect(virusScannerService.scanFile).not.toHaveBeenCalled();
        });
        it('should throw BadRequestException when file is empty', async () => {
            const file = createMockFile(Buffer.alloc(0), 'image/jpeg', 0);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('No file provided or file is empty');
        });
        it('should throw BadRequestException when file size exceeds limit', async () => {
            const largeBuffer = Buffer.alloc(6 * 1024 * 1024, 'x'); // 6MB
            const file = createMockFile(largeBuffer, 'image/jpeg', largeBuffer.length);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('File size exceeds maximum allowed size of 5MB');
        });
        it('should throw BadRequestException for invalid file type', async () => {
            const pdfBuffer = Buffer.concat([
                Buffer.from([0x25, 0x50, 0x44, 0x46]),
                Buffer.alloc(100, 'd'),
            ]);
            const file = createMockFile(pdfBuffer, 'application/pdf', pdfBuffer.length, 'doc.pdf');
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('Invalid file type. Only JPEG, PNG, WEBP files are allowed');
        });
        it('should throw BadRequestException when magic bytes do not match MIME type', async () => {
            // PNG magic bytes but claiming to be JPEG
            const fakeMagicBytes = Buffer.concat([
                Buffer.from([0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a]),
                Buffer.alloc(100, 'b'),
            ]);
            const file = createMockFile(fakeMagicBytes, 'image/jpeg', fakeMagicBytes.length);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('File content does not match declared file type');
        });
        it('should throw BadRequestException when virus is detected', async () => {
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            mockVirusScannerService.scanFile.mockRejectedValueOnce(new common_1.BadRequestException('File failed security scan and was rejected'));
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow(common_1.BadRequestException);
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('File failed security scan and was rejected');
        });
        it('should throw InternalServerErrorException when S3 upload fails', async () => {
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            mockS3Send.mockRejectedValue(new Error('S3 connection error'));
            await expect(service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS)).rejects.toThrow('Failed to upload file to storage');
        });
        it('should include custom metadata in S3 upload', async () => {
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            const metadata = { uploadedBy: 'user123', category: 'profile' };
            await service.uploadFile(file, storage_types_1.FileCategory.SPEAKER_PHOTOS, { metadata });
            expect(mockS3Send).toHaveBeenCalledWith(expect.any(client_s3_1.PutObjectCommand));
        });
    });
    describe('validateFile', () => {
        it('should validate a correct file successfully', async () => {
            const jpegBuffer = Buffer.concat([Buffer.from([0xff, 0xd8, 0xff]), Buffer.alloc(100, 'a')]);
            const file = createMockFile(jpegBuffer, 'image/jpeg', jpegBuffer.length);
            const result = await service.validateFile(file, {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedMimeTypes: ['image/jpeg'],
                validateMagicBytes: true,
            });
            expect(result).toBe(true);
        });
        it('should throw error for missing file', async () => {
            await expect(service.validateFile(null, {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedMimeTypes: ['image/jpeg'],
                validateMagicBytes: true,
            })).rejects.toThrow('No file provided or file is empty');
        });
        it('should throw error for file exceeding size limit', async () => {
            const largeBuffer = Buffer.alloc(6 * 1024 * 1024, 'x');
            const file = createMockFile(largeBuffer, 'image/jpeg', largeBuffer.length);
            await expect(service.validateFile(file, {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedMimeTypes: ['image/jpeg'],
                validateMagicBytes: false,
            })).rejects.toThrow('File size exceeds maximum allowed size of 5MB');
        });
        it('should throw error for disallowed MIME type', async () => {
            const buffer = Buffer.alloc(100, 'a');
            const file = createMockFile(buffer, 'application/pdf', buffer.length);
            await expect(service.validateFile(file, {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedMimeTypes: ['image/jpeg', 'image/png'],
                validateMagicBytes: false,
            })).rejects.toThrow('Invalid file type. Only JPEG, PNG files are allowed');
        });
        it('should throw error when magic bytes validation fails', async () => {
            // Wrong magic bytes for JPEG
            const wrongMagicBytes = Buffer.concat([
                Buffer.from([0x00, 0x00, 0x00]),
                Buffer.alloc(100, 'a'),
            ]);
            const file = createMockFile(wrongMagicBytes, 'image/jpeg', wrongMagicBytes.length);
            await expect(service.validateFile(file, {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedMimeTypes: ['image/jpeg'],
                validateMagicBytes: true,
            })).rejects.toThrow('File content does not match declared file type');
        });
    });
    describe('deleteFile', () => {
        it('should successfully delete a file from S3', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            await service.deleteFile(key);
            expect(mockS3Send).toHaveBeenCalledWith(expect.any(client_s3_1.DeleteObjectCommand));
        });
        it('should not throw error when S3 delete fails (swallow error)', async () => {
            const key = 'speaker-photos/nonexistent.jpg';
            mockS3Send.mockRejectedValueOnce(new Error('File not found'));
            await expect(service.deleteFile(key)).resolves.not.toThrow();
        });
    });
    describe('getSignedUrl', () => {
        it('should generate a signed URL for a file', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            const mockSignedUrl = 'https://test-bucket.s3.amazonaws.com/signed-url';
            s3_request_presigner_1.getSignedUrl.mockResolvedValue(mockSignedUrl);
            const result = await service.getSignedUrl(key);
            expect(result).toBe(mockSignedUrl);
            expect(s3_request_presigner_1.getSignedUrl).toHaveBeenCalledWith(expect.anything(), // S3Client instance
            expect.any(client_s3_1.GetObjectCommand), { expiresIn: 3600 });
        });
        it('should use custom expiration time', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            const mockSignedUrl = 'https://test-bucket.s3.amazonaws.com/signed-url';
            const customExpiry = 7200;
            s3_request_presigner_1.getSignedUrl.mockResolvedValue(mockSignedUrl);
            await service.getSignedUrl(key, customExpiry);
            expect(s3_request_presigner_1.getSignedUrl).toHaveBeenCalledWith(expect.anything(), // S3Client instance
            expect.any(client_s3_1.GetObjectCommand), { expiresIn: customExpiry });
        });
        it('should throw InternalServerErrorException when signing fails', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            s3_request_presigner_1.getSignedUrl.mockRejectedValue(new Error('Signing failed'));
            await expect(service.getSignedUrl(key)).rejects.toThrow(common_1.InternalServerErrorException);
            await expect(service.getSignedUrl(key)).rejects.toThrow('Failed to generate download URL');
        });
    });
    describe('getFile', () => {
        it('should retrieve a file from S3', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            const mockStream = new stream_1.Readable();
            mockS3Send.mockResolvedValueOnce({ Body: mockStream });
            const result = await service.getFile(key);
            expect(result).toBe(mockStream);
            expect(mockS3Send).toHaveBeenCalledWith(expect.any(client_s3_1.GetObjectCommand));
        });
        it('should throw InternalServerErrorException when retrieval fails', async () => {
            const key = 'speaker-photos/nonexistent.jpg';
            mockS3Send.mockRejectedValue(new Error('File not found'));
            await expect(service.getFile(key)).rejects.toThrow('Failed to retrieve file from storage');
        });
    });
    describe('getFileMetadata', () => {
        it('should retrieve file metadata from S3', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            mockS3Send.mockResolvedValueOnce({
                ContentLength: 1024,
                ContentType: 'image/jpeg',
            });
            const result = await service.getFileMetadata(key);
            expect(result).toEqual({
                size: 1024,
                contentType: 'image/jpeg',
            });
            expect(mockS3Send).toHaveBeenCalledWith(expect.any(client_s3_1.HeadObjectCommand));
        });
        it('should use default values when metadata is missing', async () => {
            const key = 'speaker-photos/12345-67890.jpg';
            mockS3Send.mockResolvedValueOnce({});
            const result = await service.getFileMetadata(key);
            expect(result).toEqual({
                size: 0,
                contentType: 'application/octet-stream',
            });
        });
        it('should throw InternalServerErrorException when metadata retrieval fails', async () => {
            const key = 'speaker-photos/nonexistent.jpg';
            mockS3Send.mockRejectedValue(new Error('File not found'));
            await expect(service.getFileMetadata(key)).rejects.toThrow('Failed to retrieve file metadata');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbHVpc25ldG85OC9Eb2N1bWVudG9zL0NvZGUvbW9ub3JlcG8tdnRleC9hcHBzL2FwaS90ZXN0cy91bml0L21vZHVsZXMvc3RvcmFnZS9zdG9yYWdlLnNlcnZpY2Uuc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQWdCQSxlQUFlO0FBQ2YsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQWxCM0MsNkNBQXNEO0FBQ3RELDJDQUFtRjtBQUNuRiw4RkFBMEY7QUFDMUYsNEdBQXVHO0FBQ3ZHLDBHQUFxRztBQUNyRyx1RkFBbUY7QUFDbkYsa0RBTTRCO0FBQzVCLHdFQUE2RDtBQUM3RCxtQ0FBa0M7QUFNbEMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtJQUM5QixJQUFJLE9BQXVCLENBQUM7SUFDNUIsSUFBSSxtQkFBd0MsQ0FBQztJQUM3QyxJQUFJLFVBQXFCLENBQUM7SUFFMUIsTUFBTSx3QkFBd0IsR0FBRztRQUMvQixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUM7UUFDcEQsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsYUFBYSxDQUFDO1FBQ3RELGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsaUJBQWlCLENBQUM7UUFDL0QscUJBQXFCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQztLQUNwRSxDQUFDO0lBRUYsTUFBTSx1QkFBdUIsR0FBRztRQUM5QixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQztLQUNqRCxDQUFDO0lBRUYsNkJBQTZCO0lBQzdCLE1BQU0sY0FBYyxHQUFHLENBQ3JCLE1BQWMsRUFDZCxRQUFnQixFQUNoQixJQUFZLEVB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TUFBTSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUN4RCxrQ0FBa0MsQ0FDbkMsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9sdWlzbmV0bzk4L0RvY3VtZW50b3MvQ29kZS9tb25vcmVwby12dGV4L2FwcHMvYXBpL3Rlc3RzL3VuaXQvbW9kdWxlcy9zdG9yYWdlL3N0b3JhZ2Uuc2VydmljZS5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRlc3QsIFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuaW1wb3J0IHsgQmFkUmVxdWVzdEV4Y2VwdGlvbiwgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiB9IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IFN0b3JhZ2VTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvc3RvcmFnZS9zZXJ2aWNlcy9zdG9yYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgU3RvcmFnZUNvbmZpZ1NlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvbW9kdWxlcy9zdG9yYWdlL3NlcnZpY2VzL3N0b3JhZ2UtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHsgVmlydXNTY2FubmVyU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL3N0b3JhZ2Uvc2VydmljZXMvdmlydXMtc2Nhbm5lci5zZXJ2aWNlJztcbmltcG9ydCB7IEZpbGVDYXRlZ29yeSB9IGZyb20gJy4uLy4uLy4uLy4uL3NyYy9tb2R1bGVzL3N0b3JhZ2UvdHlwZXMvc3RvcmFnZS50eXBlcyc7XG5pbXBvcnQge1xuICBTM0NsaWVudCxcbiAgUHV0T2JqZWN0Q29tbWFuZCxcbiAgR2V0T2JqZWN0Q29tbWFuZCxcbiAgRGVsZXRlT2JqZWN0Q29tbWFuZCxcbiAgSGVhZE9iamVjdENvbW1hbmQsXG59IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XG5pbXBvcnQgeyBnZXRTaWduZWRVcmwgfSBmcm9tICdAYXdzLXNkay9zMy1yZXF1ZXN0LXByZXNpZ25lcic7XG5pbXBvcnQgeyBSZWFkYWJsZSB9IGZyb20gJ3N0cmVhbSc7XG5cbi8vIE1vY2sgQVdTIFNES1xuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnKTtcbmplc3QubW9jaygnQGF3cy1zZGsvczMtcmVxdWVzdC1wcmVzaWduZXInKTtcblxuZGVzY3JpYmUoJ1N0b3JhZ2VTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc2VydmljZTogU3RvcmFnZVNlcnZpY2U7XG4gIGxldCB2aXJ1c1NjYW5uZXJTZXJ2aWNlOiBWaXJ1c1NjYW5uZXJTZXJ2aWNlO1xuICBsZXQgbW9ja1MzU2VuZDogamVzdC5Nb2NrO1xuXG4gIGNvbnN0IG1vY2tTdG9yYWdlQ29uZmlnU2VydmljZSA9IHtcbiAgICBnZXRBd3NSZWdpb246IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ3VzLWVhc3QtMScpLFxuICAgIGdldEF3c0J1Y2tldDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgndGVzdC1idWNrZXQnKSxcbiAgICBnZXRBd3NBY2Nlc3NLZXlJZDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSgndGVzdC1hY2Nlc3Mta2V5JyksXG4gICAgZ2V0QXdzU2VjcmV0QWNjZXNzS2V5OiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKCd0ZXN0LXNlY3JldC1rZXknKSxcbiAgfTtcblxuICBjb25zdCBtb2NrVmlydXNTY2FubmVyU2VydmljZSA9IHtcbiAgICBzY2FuRmlsZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gIH07XG5cbiAgLy8gSGVscGVyIHRvIGNyZWF0ZSBtb2NrIGZpbGVcbiAgY29uc3QgY3JlYXRlTW9ja0ZpbGUgPSAoXG4gICAgYnVmZmVyOiBCdWZmZXIsXG4gICAgbWltZXR5cGU6IHN0cmluZyxcbiAgICBzaXplOiBudW1iZXIsXG4gICAgb3JpZ2luYWxuYW1lID0gJ3Rlc3QuanBnJyxcbiAgKTogRXhwcmVzcy5NdWx0ZXIuRmlsZSA9PiAoe1xuICAgIGJ1ZmZlcixcbiAgICBtaW1ldHlwZSxcbiAgICBzaXplLFxuICAgIG9yaWdpbmFsbmFtZSxcbiAgICBmaWVsZG5hbWU6ICdmaWxlJyxcbiAgICBlbmNvZGluZzogJzdiaXQnLFxuICAgIGRlc3RpbmF0aW9uOiAnJyxcbiAgICBmaWxlbmFtZTogJycsXG4gICAgcGF0aDogJycsXG4gICAgc3RyZWFtOiBuZXcgUmVhZGFibGUoKSxcbiAgfSk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgLy8gTW9jayBTM0NsaWVudFxuICAgIG1vY2tTM1NlbmQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xuICAgIChTM0NsaWVudCBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgc2VuZDogbW9ja1MzU2VuZCxcbiAgICB9KSk7XG5cbiAgICBjb25zdCBtb2R1bGU6IFRlc3RpbmdNb2R1bGUgPSBhd2FpdCBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUoe1xuICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIFN0b3JhZ2VTZXJ2aWNlLFxuICAgICAgICB7XG4gICAgICAgICAgcHJvdmlkZTogU3RvcmFnZUNvbmZpZ1NlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tTdG9yYWdlQ29uZmlnU2VydmljZSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IFZpcnVzU2Nhbm5lclNlcnZpY2UsXG4gICAgICAgICAgdXNlVmFsdWU6IG1vY2tWaXJ1c1NjYW5uZXJTZXJ2aWNlLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KS5jb21waWxlKCk7XG5cbiAgICBzZXJ2aWNlID0gbW9kdWxlLmdldDxTdG9yYWdlU2VydmljZT4oU3RvcmFnZVNlcnZpY2UpO1xuICAgIHZpcnVzU2Nhbm5lclNlcnZpY2UgPSBtb2R1bGUuZ2V0PFZpcnVzU2Nhbm5lclNlcnZpY2U+KFZpcnVzU2Nhbm5lclNlcnZpY2UpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBsb2FkRmlsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSB1cGxvYWQgYSB2YWxpZCBKUEVHIGltYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gSlBFRyBtYWdpYyBieXRlczogRkYgRDggRkZcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuZnJvbShbMHhmZiwgMHhkOCwgMHhmZl0pLCBCdWZmZXIuYWxsb2MoMTAwLCAnYScpXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoanBlZ0J1ZmZlciwgJ2ltYWdlL2pwZWcnLCBqcGVnQnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgna2V5Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndXJsJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmtleSkudG9Db250YWluKCdzcGVha2VyLXBob3Rvcy8nKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudXJsKS50b0NvbnRhaW4oJ2h0dHBzOi8vdGVzdC1idWNrZXQuczMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXJ1c1NjYW5uZXJTZXJ2aWNlLnNjYW5GaWxlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZmlsZS5idWZmZXIsXG4gICAgICAgIGZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICBmaWxlLm1pbWV0eXBlLFxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrUzNTZW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFB1dE9iamVjdENvbW1hbmQpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHVwbG9hZCBhIHZhbGlkIFBORyBpbWFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFBORyBtYWdpYyBieXRlczogODkgNTAgNEUgNDcgMEQgMEEgMUEgMEFcbiAgICAgIGNvbnN0IHBuZ0J1ZmZlciA9IEJ1ZmZlci5jb25jYXQoW1xuICAgICAgICBCdWZmZXIuZnJvbShbMHg4OSwgMHg1MCwgMHg0ZSwgMHg0NywgMHgwZCwgMHgwYSwgMHgxYSwgMHgwYV0pLFxuICAgICAgICBCdWZmZXIuYWxsb2MoMTAwLCAnYicpLFxuICAgICAgXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUocG5nQnVmZmVyLCAnaW1hZ2UvcG5nJywgcG5nQnVmZmVyLmxlbmd0aCwgJ3Rlc3QucG5nJyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5rZXkpLnRvQ29udGFpbignc3BlYWtlci1waG90b3MvJyk7XG4gICAgICBleHBlY3QobW9ja1MzU2VuZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgdXBsb2FkIGEgdmFsaWQgV2ViUCBpbWFnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFdlYlAgbWFnaWMgYnl0ZXM6IFJJRkYgWzQgYnl0ZXNdIFdFQlBcbiAgICAgIGNvbnN0IHdlYnBCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtcbiAgICAgICAgQnVmZmVyLmZyb20oWzB4NTIsIDB4NDksIDB4NDYsIDB4NDZdKSwgLy8gUklGRlxuICAgICAgICBCdWZmZXIuYWxsb2MoNCwgMCksIC8vIEZpbGUgc2l6ZSBwbGFjZWhvbGRlclxuICAgICAgICBCdWZmZXIuZnJvbSgnV0VCUCcsICdhc2NpaScpLCAvLyBXRUJQIG1hcmtlclxuICAgICAgICBCdWZmZXIuYWxsb2MoMTAwLCAnYycpLFxuICAgICAgXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUod2VicEJ1ZmZlciwgJ2ltYWdlL3dlYnAnLCB3ZWJwQnVmZmVyLmxlbmd0aCwgJ3Rlc3Qud2VicCcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2V5KS50b0NvbnRhaW4oJ3NwZWFrZXItcGhvdG9zLycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgdXBsb2FkIGEgdmFsaWQgUERGIGZvciBsZWdhbCBkb2N1bWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBQREYgbWFnaWMgYnl0ZXM6ICVQREZcbiAgICAgIGNvbnN0IHBkZkJ1ZmZlciA9IEJ1ZmZlci5jb25jYXQoW1xuICAgICAgICBCdWZmZXIuZnJvbShbMHgyNSwgMHg1MCwgMHg0NCwgMHg0Nl0pLFxuICAgICAgICBCdWZmZXIuYWxsb2MoMTAwLCAnZCcpLFxuICAgICAgXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUocGRmQnVmZmVyLCAnYXBwbGljYXRpb24vcGRmJywgcGRmQnVmZmVyLmxlbmd0aCwgJ2xlZ2FsLnBkZicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LkxFR0FMX0RPQ1VNRU5UUyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmtleSkudG9Db250YWluKCdsZWdhbC1kb2N1bWVudHMvJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNraXAgdmlydXMgc2Nhbm5pbmcgd2hlbiBzY2FuRm9yVmlydXMgaXMgZmFsc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBqcGVnQnVmZmVyID0gQnVmZmVyLmNvbmNhdChbQnVmZmVyLmZyb20oWzB4ZmYsIDB4ZDgsIDB4ZmZdKSwgQnVmZmVyLmFsbG9jKDEwMCwgJ2EnKV0pO1xuICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZU1vY2tGaWxlKGpwZWdCdWZmZXIsICdpbWFnZS9qcGVnJywganBlZ0J1ZmZlci5sZW5ndGgpO1xuXG4gICAgICBhd2FpdCBzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TLCB7IHNjYW5Gb3JWaXJ1czogZmFsc2UgfSk7XG5cbiAgICAgIGV4cGVjdCh2aXJ1c1NjYW5uZXJTZXJ2aWNlLnNjYW5GaWxlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBCYWRSZXF1ZXN0RXhjZXB0aW9uIHdoZW4gZmlsZSBpcyBlbXB0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBjcmVhdGVNb2NrRmlsZShCdWZmZXIuYWxsb2MoMCksICdpbWFnZS9qcGVnJywgMCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnTm8gZmlsZSBwcm92aWRlZCBvciBmaWxlIGlzIGVtcHR5JyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gd2hlbiBmaWxlIHNpemUgZXhjZWVkcyBsaW1pdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxhcmdlQnVmZmVyID0gQnVmZmVyLmFsbG9jKDYgKiAxMDI0ICogMTAyNCwgJ3gnKTsgLy8gNk1CXG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUobGFyZ2VCdWZmZXIsICdpbWFnZS9qcGVnJywgbGFyZ2VCdWZmZXIubGVuZ3RoKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGaWxlIHNpemUgZXhjZWVkcyBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBvZiA1TUInLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgQmFkUmVxdWVzdEV4Y2VwdGlvbiBmb3IgaW52YWxpZCBmaWxlIHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwZGZCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtcbiAgICAgICAgQnVmZmVyLmZyb20oWzB4MjUsIDB4NTAsIDB4NDQsIDB4NDZdKSxcbiAgICAgICAgQnVmZmVyLmFsbG9jKDEwMCwgJ2QnKSxcbiAgICAgIF0pO1xuICAgICAgY29uc3QgZmlsZSA9IGNyZWF0ZU1vY2tGaWxlKHBkZkJ1ZmZlciwgJ2FwcGxpY2F0aW9uL3BkZicsIHBkZkJ1ZmZlci5sZW5ndGgsICdkb2MucGRmJyk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICBCYWRSZXF1ZXN0RXhjZXB0aW9uLFxuICAgICAgKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLnVwbG9hZEZpbGUoZmlsZSwgRmlsZUNhdGVnb3J5LlNQRUFLRVJfUEhPVE9TKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnSW52YWxpZCBmaWxlIHR5cGUuIE9ubHkgSlBFRywgUE5HLCBXRUJQIGZpbGVzIGFyZSBhbGxvd2VkJyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gd2hlbiBtYWdpYyBieXRlcyBkbyBub3QgbWF0Y2ggTUlNRSB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gUE5HIG1hZ2ljIGJ5dGVzIGJ1dCBjbGFpbWluZyB0byBiZSBKUEVHXG4gICAgICBjb25zdCBmYWtlTWFnaWNCeXRlcyA9IEJ1ZmZlci5jb25jYXQoW1xuICAgICAgICBCdWZmZXIuZnJvbShbMHg4OSwgMHg1MCwgMHg0ZSwgMHg0NywgMHgwZCwgMHgwYSwgMHgxYSwgMHgwYV0pLFxuICAgICAgICBCdWZmZXIuYWxsb2MoMTAwLCAnYicpLFxuICAgICAgXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoZmFrZU1hZ2ljQnl0ZXMsICdpbWFnZS9qcGVnJywgZmFrZU1hZ2ljQnl0ZXMubGVuZ3RoKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGaWxlIGNvbnRlbnQgZG9lcyBub3QgbWF0Y2ggZGVjbGFyZWQgZmlsZSB0eXBlJyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IEJhZFJlcXVlc3RFeGNlcHRpb24gd2hlbiB2aXJ1cyBpcyBkZXRlY3RlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuZnJvbShbMHhmZiwgMHhkOCwgMHhmZl0pLCBCdWZmZXIuYWxsb2MoMTAwLCAnYScpXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoanBlZ0J1ZmZlciwgJ2ltYWdlL2pwZWcnLCBqcGVnQnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgIG1vY2tWaXJ1c1NjYW5uZXJTZXJ2aWNlLnNjYW5GaWxlLm1vY2tSZWplY3RlZFZhbHVlT25jZShcbiAgICAgICAgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ZpbGUgZmFpbGVkIHNlY3VyaXR5IHNjYW4gYW5kIHdhcyByZWplY3RlZCcpLFxuICAgICAgKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIEJhZFJlcXVlc3RFeGNlcHRpb24sXG4gICAgICApO1xuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGaWxlIGZhaWxlZCBzZWN1cml0eSBzY2FuIGFuZCB3YXMgcmVqZWN0ZWQnLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiB3aGVuIFMzIHVwbG9hZCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuZnJvbShbMHhmZiwgMHhkOCwgMHhmZl0pLCBCdWZmZXIuYWxsb2MoMTAwLCAnYScpXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoanBlZ0J1ZmZlciwgJ2ltYWdlL2pwZWcnLCBqcGVnQnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgIG1vY2tTM1NlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdTMyBjb25uZWN0aW9uIGVycm9yJykpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2VydmljZS51cGxvYWRGaWxlKGZpbGUsIEZpbGVDYXRlZ29yeS5TUEVBS0VSX1BIT1RPUykpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ0ZhaWxlZCB0byB1cGxvYWQgZmlsZSB0byBzdG9yYWdlJyxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgY3VzdG9tIG1ldGFkYXRhIGluIFMzIHVwbG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuZnJvbShbMHhmZiwgMHhkOCwgMHhmZl0pLCBCdWZmZXIuYWxsb2MoMTAwLCAnYScpXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoanBlZ0J1ZmZlciwgJ2ltYWdlL2pwZWcnLCBqcGVnQnVmZmVyLmxlbmd0aCk7XG4gICAgICBjb25zdCBtZXRhZGF0YSA9IHsgdXBsb2FkZWRCeTogJ3VzZXIxMjMnLCBjYXRlZ29yeTogJ3Byb2ZpbGUnIH07XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBGaWxlQ2F0ZWdvcnkuU1BFQUtFUl9QSE9UT1MsIHsgbWV0YWRhdGEgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUzNTZW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KFB1dE9iamVjdENvbW1hbmQpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlRmlsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGEgY29ycmVjdCBmaWxlIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGpwZWdCdWZmZXIgPSBCdWZmZXIuY29uY2F0KFtCdWZmZXIuZnJvbShbMHhmZiwgMHhkOCwgMHhmZl0pLCBCdWZmZXIuYWxsb2MoMTAwLCAnYScpXSk7XG4gICAgICBjb25zdCBmaWxlID0gY3JlYXRlTW9ja0ZpbGUoanBlZ0J1ZmZlciwgJ2ltYWdlL2pwZWcnLCBqcGVnQnVmZmVyLmxlbmd0aCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UudmFsaWRhdGVGaWxlKGZpbGUsIHtcbiAgICAgICAgbWF4U2l6ZUJ5dGVzOiA1ICogMTAyNCAqIDEwMjQsXG4gICAgICAgIGFsbG93ZWRNaW1lVHlwZXM6IFsnaW1hZ2UvanBlZyddLFxuICAgICAgICB2YWxpZGF0ZU1hZ2ljQnl0ZXM6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIG1pc3NpbmcgZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS52YWxpZGF0ZUZpbGUobnVsbCBhcyBhbnksIHtcbiAgICAgICAgICBtYXhTaXplQnl0ZXM6IDUgKiAxMDI0ICogMTAyNCxcbiAgICAgICAgICBhbGxvd2VkTWltZVR5cGVzOiBbJ2ltYWdlL2pwZWcnXSxcbiAgICAgICAgICB2YWxpZGF0ZU1hZ2ljQnl0ZXM6IHRydWUsXG4gICAgICAgIH0pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ05vIGZpbGUgcHJvdmlkZWQgb3IgZmlsZSBpcyBlbXB0eScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgZmlsZSBleGNlZWRpbmcgc2l6ZSBsaW1pdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGxhcmdlQnVmZmVyID0gQnVmZmVyLmFsbG9jKDYgKiAxMDI0ICogMTAyNCwgJ3gnKTtcbiAgICAgIGNvbnN0IGZpbGUgPSBjcmVhdGVNb2NrRmlsZShsYXJnZUJ1ZmZlciwgJ2ltYWdlL2pwZWcnLCBsYXJnZUJ1ZmZlci5sZW5ndGgpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHNlcnZpY2UudmFsaWRhdGVGaWxlKGZpbGUsIHtcbiAgICAgICAgICBtYXhTaXplQnl0ZXM6IDUgKiAxMDI0ICogMTAyNCxcbiAgICAgICAgICBhbGxvd2VkTWltZVR5cGVzOiBbJ2ltYWdlL2pwZWcnXSxcbiAgICAgICAgICB2YWxpZGF0ZU1hZ2ljQnl0ZXM6IGZhbHNlLFxuICAgICAgICB9KSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdGaWxlIHNpemUgZXhjZWVkcyBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBvZiA1TUInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGRpc2FsbG93ZWQgTUlNRSB0eXBlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmFsbG9jKDEwMCwgJ2EnKTtcbiAgICAgIGNvbnN0IGZpbGUgPSBjcmVhdGVNb2NrRmlsZShidWZmZXIsICdhcHBsaWNhdGlvbi9wZGYnLCBidWZmZXIubGVuZ3RoKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBzZXJ2aWNlLnZhbGlkYXRlRmlsZShmaWxlLCB7XG4gICAgICAgICAgbWF4U2l6ZUJ5dGVzOiA1ICogMTAyNCAqIDEwMjQsXG4gICAgICAgICAgYWxsb3dlZE1pbWVUeXBlczogWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZyddLFxuICAgICAgICAgIHZhbGlkYXRlTWFnaWNCeXRlczogZmFsc2UsXG4gICAgICAgIH0pLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0ludmFsaWQgZmlsZSB0eXBlLiBPbmx5IEpQRUcsIFBORyBmaWxlcyBhcmUgYWxsb3dlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciB3aGVuIG1hZ2ljIGJ5dGVzIHZhbGlkYXRpb24gZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBXcm9uZyBtYWdpYyBieXRlcyBmb3IgSlBFR1xuICAgICAgY29uc3Qgd3JvbmdNYWdpY0J5dGVzID0gQnVmZmVyLmNvbmNhdChbXG4gICAgICAgIEJ1ZmZlci5mcm9tKFsweDAwLCAweDAwLCAweDAwXSksXG4gICAgICAgIEJ1ZmZlci5hbGxvYygxMDAsICdhJyksXG4gICAgICBdKTtcbiAgICAgIGNvbnN0IGZpbGUgPSBjcmVhdGVNb2NrRmlsZSh3cm9uZ01hZ2ljQnl0ZXMsICdpbWFnZS9qcGVnJywgd3JvbmdNYWdpY0J5dGVzLmxlbmd0aCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgc2VydmljZS52YWxpZGF0ZUZpbGUoZmlsZSwge1xuICAgICAgICAgIG1heFNpemVCeXRlczogNSAqIDEwMjQgKiAxMDI0LFxuICAgICAgICAgIGFsbG93ZWRNaW1lVHlwZXM6IFsnaW1hZ2UvanBlZyddLFxuICAgICAgICAgIHZhbGlkYXRlTWFnaWNCeXRlczogdHJ1ZSxcbiAgICAgICAgfSksXG4gICAgICApLnJlamVjdHMudG9UaHJvdygnRmlsZSBjb250ZW50IGRvZXMgbm90IG1hdGNoIGRlY2xhcmVkIGZpbGUgdHlwZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVsZXRlRmlsZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBkZWxldGUgYSBmaWxlIGZyb20gUzMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSAnc3BlYWtlci1waG90b3MvMTIzNDUtNjc4OTAuanBnJztcblxuICAgICAgYXdhaXQgc2VydmljZS5kZWxldGVGaWxlKGtleSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUzNTZW5kKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChleHBlY3QuYW55KERlbGV0ZU9iamVjdENvbW1hbmQpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHRocm93IGVycm9yIHdoZW4gUzMgZGVsZXRlIGZhaWxzIChzd2FsbG93IGVycm9yKScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy9ub25leGlzdGVudC5qcGcnO1xuICAgICAgbW9ja1MzU2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdGaWxlIG5vdCBmb3VuZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZGVsZXRlRmlsZShrZXkpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0U2lnbmVkVXJsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgYSBzaWduZWQgVVJMIGZvciBhIGZpbGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBrZXkgPSAnc3BlYWtlci1waG90b3MvMTIzNDUtNjc4OTAuanBnJztcbiAgICAgIGNvbnN0IG1vY2tTaWduZWRVcmwgPSAnaHR0cHM6Ly90ZXN0LWJ1Y2tldC5zMy5hbWF6b25hd3MuY29tL3NpZ25lZC11cmwnO1xuXG4gICAgICAoZ2V0U2lnbmVkVXJsIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NpZ25lZFVybCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0U2lnbmVkVXJsKGtleSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja1NpZ25lZFVybCk7XG4gICAgICBleHBlY3QoZ2V0U2lnbmVkVXJsKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKCksIC8vIFMzQ2xpZW50IGluc3RhbmNlXG4gICAgICAgIGV4cGVjdC5hbnkoR2V0T2JqZWN0Q29tbWFuZCksXG4gICAgICAgIHsgZXhwaXJlc0luOiAzNjAwIH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgY3VzdG9tIGV4cGlyYXRpb24gdGltZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy8xMjM0NS02Nzg5MC5qcGcnO1xuICAgICAgY29uc3QgbW9ja1NpZ25lZFVybCA9ICdodHRwczovL3Rlc3QtYnVja2V0LnMzLmFtYXpvbmF3cy5jb20vc2lnbmVkLXVybCc7XG4gICAgICBjb25zdCBjdXN0b21FeHBpcnkgPSA3MjAwO1xuXG4gICAgICAoZ2V0U2lnbmVkVXJsIGFzIGplc3QuTW9jaykubW9ja1Jlc29sdmVkVmFsdWUobW9ja1NpZ25lZFVybCk7XG5cbiAgICAgIGF3YWl0IHNlcnZpY2UuZ2V0U2lnbmVkVXJsKGtleSwgY3VzdG9tRXhwaXJ5KTtcblxuICAgICAgZXhwZWN0KGdldFNpZ25lZFVybCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpLCAvLyBTM0NsaWVudCBpbnN0YW5jZVxuICAgICAgICBleHBlY3QuYW55KEdldE9iamVjdENvbW1hbmQpLFxuICAgICAgICB7IGV4cGlyZXNJbjogY3VzdG9tRXhwaXJ5IH0sXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uIHdoZW4gc2lnbmluZyBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy8xMjM0NS02Nzg5MC5qcGcnO1xuXG4gICAgICAoZ2V0U2lnbmVkVXJsIGFzIGplc3QuTW9jaykubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdTaWduaW5nIGZhaWxlZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0U2lnbmVkVXJsKGtleSkpLnJlamVjdHMudG9UaHJvdyhJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uKTtcbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmdldFNpZ25lZFVybChrZXkpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBnZW5lcmF0ZSBkb3dubG9hZCBVUkwnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEZpbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXRyaWV2ZSBhIGZpbGUgZnJvbSBTMycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy8xMjM0NS02Nzg5MC5qcGcnO1xuICAgICAgY29uc3QgbW9ja1N0cmVhbSA9IG5ldyBSZWFkYWJsZSgpO1xuXG4gICAgICBtb2NrUzNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IEJvZHk6IG1vY2tTdHJlYW0gfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0RmlsZShrZXkpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKG1vY2tTdHJlYW0pO1xuICAgICAgZXhwZWN0KG1vY2tTM1NlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoR2V0T2JqZWN0Q29tbWFuZCkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBJbnRlcm5hbFNlcnZlckVycm9yRXhjZXB0aW9uIHdoZW4gcmV0cmlldmFsIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gJ3NwZWFrZXItcGhvdG9zL25vbmV4aXN0ZW50LmpwZyc7XG5cbiAgICAgIG1vY2tTM1NlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdGaWxlIG5vdCBmb3VuZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNlcnZpY2UuZ2V0RmlsZShrZXkpKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byByZXRyaWV2ZSBmaWxlIGZyb20gc3RvcmFnZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0RmlsZU1ldGFkYXRhJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0cmlldmUgZmlsZSBtZXRhZGF0YSBmcm9tIFMzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gJ3NwZWFrZXItcGhvdG9zLzEyMzQ1LTY3ODkwLmpwZyc7XG5cbiAgICAgIG1vY2tTM1NlbmQubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgQ29udGVudExlbmd0aDogMTAyNCxcbiAgICAgICAgQ29udGVudFR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLmdldEZpbGVNZXRhZGF0YShrZXkpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgc2l6ZTogMTAyNCxcbiAgICAgICAgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJyxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KG1vY2tTM1NlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGV4cGVjdC5hbnkoSGVhZE9iamVjdENvbW1hbmQpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgdmFsdWVzIHdoZW4gbWV0YWRhdGEgaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy8xMjM0NS02Nzg5MC5qcGcnO1xuXG4gICAgICBtb2NrUzNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7fSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UuZ2V0RmlsZU1ldGFkYXRhKGtleSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICBzaXplOiAwLFxuICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgSW50ZXJuYWxTZXJ2ZXJFcnJvckV4Y2VwdGlvbiB3aGVuIG1ldGFkYXRhIHJldHJpZXZhbCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9ICdzcGVha2VyLXBob3Rvcy9ub25leGlzdGVudC5qcGcnO1xuXG4gICAgICBtb2NrUzNTZW5kLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRmlsZSBub3QgZm91bmQnKSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzZXJ2aWNlLmdldEZpbGVNZXRhZGF0YShrZXkpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdGYWlsZWQgdG8gcmV0cmlldmUgZmlsZSBtZXRhZGF0YScsXG4gICAgICApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9