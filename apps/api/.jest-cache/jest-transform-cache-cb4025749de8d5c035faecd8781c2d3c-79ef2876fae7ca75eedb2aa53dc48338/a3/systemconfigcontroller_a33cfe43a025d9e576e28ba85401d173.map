{"file":"/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/system-config/system-config.controller.ts","mappings":"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","names":[],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/system-config/system-config.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Patch,\n  Post,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  Request,\n  Ip,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { SystemConfigService } from './system-config.service';\nimport { UpdateSystemConfigDto } from './dto/update-config.dto';\nimport { UpdateSectionVisibilityDto } from './dto/section-visibility.dto';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { UserRole, type SectionName } from '@vtexday26/shared';\n\n@Controller('system-config')\nexport class SystemConfigController {\n  constructor(private readonly systemConfigService: SystemConfigService) {}\n\n  @Get()\n  async getConfig() {\n    return this.systemConfigService.getConfig();\n  }\n\n  @Get('section/:section')\n  async getSectionVisibility(@Param('section') section: SectionName) {\n    return this.systemConfigService.getSectionVisibility(section);\n  }\n\n  @Put()\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @Throttle({ default: { limit: 10, ttl: 60000 } }) // Rate limit: 10 requests per minute\n  @HttpCode(HttpStatus.OK)\n  async updateConfig(\n    @Body() updateDto: UpdateSystemConfigDto,\n    @Request() req: any,\n    @Ip() ip: string,\n  ) {\n    return this.systemConfigService.updateConfig(updateDto, req.user.id, ip);\n  }\n\n  @Patch('section/:section')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @Throttle({ default: { limit: 10, ttl: 60000 } }) // Rate limit: 10 requests per minute\n  async updateSection(\n    @Param('section') section: SectionName,\n    @Body() updateDto: UpdateSectionVisibilityDto,\n    @Request() req: any,\n    @Ip() ip: string,\n  ) {\n    return this.systemConfigService.updateSection(section, updateDto, req.user.id, ip);\n  }\n\n  @Get('audit')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  async getAuditLogs(\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n    @Query('section') section?: string,\n  ) {\n    return this.systemConfigService.getAuditLogs(\n      page ? parseInt(page, 10) : 1,\n      limit ? parseInt(limit, 10) : 20,\n      section,\n    );\n  }\n\n  @Get('preview')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  async getScheduledChanges() {\n    return this.systemConfigService.getScheduledChanges();\n  }\n\n  @Post('apply-scheduled')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @HttpCode(HttpStatus.OK)\n  async applyScheduledChanges() {\n    await this.systemConfigService.applyScheduledChanges();\n    return { message: 'Scheduled changes applied successfully' };\n  }\n}\n"],"version":3}