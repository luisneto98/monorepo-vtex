{"version":3,"names":["cov_r4yqoo8b0","actualCoverage","common_1","s","require","throttler_1","system_config_service_1","update_config_dto_1","section_visibility_dto_1","jwt_auth_guard_1","roles_guard_1","roles_decorator_1","shared_1","SystemConfigController","systemConfigService","constructor","f","getConfig","getSectionVisibility","section","updateConfig","updateDto","req","ip","user","id","updateSection","getAuditLogs","page","limit","b","parseInt","getScheduledChanges","applyScheduledChanges","message","exports","__decorate","Get","__param","Param","Put","UseGuards","JwtAuthGuard","RolesGuard","Roles","UserRole","SUPER_ADMIN","Throttle","default","ttl","HttpCode","HttpStatus","OK","Body","Request","Ip","UpdateSystemConfigDto","Object","String","Patch","UpdateSectionVisibilityDto","Query","Post","Controller","SystemConfigService"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/system-config/system-config.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Patch,\n  Post,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  Request,\n  Ip,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { Throttle } from '@nestjs/throttler';\nimport { SystemConfigService } from './system-config.service';\nimport { UpdateSystemConfigDto } from './dto/update-config.dto';\nimport { UpdateSectionVisibilityDto } from './dto/section-visibility.dto';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { UserRole, type SectionName } from '@vtexday26/shared';\n\n@Controller('system-config')\nexport class SystemConfigController {\n  constructor(private readonly systemConfigService: SystemConfigService) {}\n\n  @Get()\n  async getConfig() {\n    return this.systemConfigService.getConfig();\n  }\n\n  @Get('section/:section')\n  async getSectionVisibility(@Param('section') section: SectionName) {\n    return this.systemConfigService.getSectionVisibility(section);\n  }\n\n  @Put()\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @Throttle({ default: { limit: 10, ttl: 60000 } }) // Rate limit: 10 requests per minute\n  @HttpCode(HttpStatus.OK)\n  async updateConfig(\n    @Body() updateDto: UpdateSystemConfigDto,\n    @Request() req: any,\n    @Ip() ip: string,\n  ) {\n    return this.systemConfigService.updateConfig(updateDto, req.user.id, ip);\n  }\n\n  @Patch('section/:section')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @Throttle({ default: { limit: 10, ttl: 60000 } }) // Rate limit: 10 requests per minute\n  async updateSection(\n    @Param('section') section: SectionName,\n    @Body() updateDto: UpdateSectionVisibilityDto,\n    @Request() req: any,\n    @Ip() ip: string,\n  ) {\n    return this.systemConfigService.updateSection(section, updateDto, req.user.id, ip);\n  }\n\n  @Get('audit')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  async getAuditLogs(\n    @Query('page') page?: string,\n    @Query('limit') limit?: string,\n    @Query('section') section?: string,\n  ) {\n    return this.systemConfigService.getAuditLogs(\n      page ? parseInt(page, 10) : 1,\n      limit ? parseInt(limit, 10) : 20,\n      section,\n    );\n  }\n\n  @Get('preview')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  async getScheduledChanges() {\n    return this.systemConfigService.getScheduledChanges();\n  }\n\n  @Post('apply-scheduled')\n  @UseGuards(JwtAuthGuard, RolesGuard)\n  @Roles(UserRole.SUPER_ADMIN)\n  @HttpCode(HttpStatus.OK)\n  async applyScheduledChanges() {\n    await this.systemConfigService.applyScheduledChanges();\n    return { message: 'Scheduled changes applied successfully' };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}