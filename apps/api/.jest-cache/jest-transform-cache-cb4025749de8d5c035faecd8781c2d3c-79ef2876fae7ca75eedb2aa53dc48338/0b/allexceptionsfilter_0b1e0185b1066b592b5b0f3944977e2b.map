{"version":3,"names":["cov_29e27zkmsq","actualCoverage","common_1","s","require","AllExceptionsFilter","AllExceptionsFilter_1","logger","Logger","name","catch","exception","host","f","ctx","switchToHttp","response","getResponse","status","HttpStatus","INTERNAL_SERVER_ERROR","message","code","details","undefined","HttpException","b","getStatus","exceptionResponse","constructor","responseObj","Error","error","stack","requestId","Date","now","Math","random","toString","substr","errorResponse","timestamp","toISOString","json","exports","__decorate","Catch"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/common/filters/all-exceptions.filter.ts"],"sourcesContent":["import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Logger,\n} from '@nestjs/common';\nimport { Response } from 'express';\n\n@Catch()\nexport class AllExceptionsFilter implements ExceptionFilter {\n  private readonly logger = new Logger(AllExceptionsFilter.name);\n\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n\n    let status = HttpStatus.INTERNAL_SERVER_ERROR;\n    let message = 'Internal server error';\n    let code = 'InternalServerError';\n    let details: any = undefined;\n\n    if (exception instanceof HttpException) {\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n      code = exception.constructor.name;\n\n      if (typeof exceptionResponse === 'object' && exceptionResponse !== null) {\n        const responseObj = exceptionResponse as any;\n        message = responseObj.message || exception.message;\n        details = responseObj.details;\n      } else {\n        message = exception.message;\n      }\n    } else if (exception instanceof Error) {\n      message = exception.message;\n      code = exception.name;\n\n      this.logger.error(`Unhandled exception: ${exception.message}`, exception.stack);\n    }\n\n    // Generate request ID for tracking\n    const requestId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    const errorResponse = {\n      error: {\n        code,\n        message,\n        details,\n        timestamp: new Date().toISOString(),\n        requestId,\n      },\n    };\n\n    response.status(status).json(errorResponse);\n  }\n}\n"],"mappings":"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","ignoreList":[]}