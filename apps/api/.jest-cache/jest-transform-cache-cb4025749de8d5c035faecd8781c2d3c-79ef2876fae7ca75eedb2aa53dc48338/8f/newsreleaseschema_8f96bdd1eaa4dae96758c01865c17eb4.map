{"file":"/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/news-releases/schemas/news-release.schema.ts","mappings":"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","names":[],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/news-releases/schemas/news-release.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\nimport { Document } from 'mongoose';\nimport { NewsReleaseStatus, LocalizedNewsContent, ImageGalleryItem } from '@vtexday26/shared';\n\nexport type NewsReleaseDocument = NewsRelease & Document;\n\n@Schema({ _id: false })\nexport class LocalizedContent implements LocalizedNewsContent {\n  @Prop({ required: true })\n  title: string;\n\n  @Prop()\n  subtitle?: string;\n\n  @Prop({ required: true })\n  content: string;\n\n  @Prop()\n  metaTitle?: string;\n\n  @Prop()\n  metaDescription?: string;\n\n  @Prop([String])\n  keywords?: string[];\n}\n\nexport const LocalizedContentSchema = SchemaFactory.createForClass(LocalizedContent);\n\n@Schema({ _id: false })\nexport class ImageGallery implements ImageGalleryItem {\n  @Prop()\n  _id?: string;\n\n  @Prop({ required: true })\n  url: string;\n\n  @Prop()\n  thumbnailUrl?: string;\n\n  @Prop({ type: Object })\n  caption?: Record<string, string>;\n\n  @Prop({ type: Object })\n  altText?: Record<string, string>;\n\n  @Prop({ required: true })\n  order: number;\n\n  @Prop({ default: Date.now })\n  uploadedAt: Date;\n}\n\nexport const ImageGallerySchema = SchemaFactory.createForClass(ImageGallery);\n\n@Schema({ _id: false })\nexport class Author {\n  @Prop({ required: true })\n  id: string;\n\n  @Prop({ required: true })\n  name: string;\n\n  @Prop({ required: true })\n  email: string;\n}\n\nexport const AuthorSchema = SchemaFactory.createForClass(Author);\n\n@Schema({ timestamps: true, versionKey: 'version' })\nexport class NewsRelease {\n  @Prop({\n    unique: true,\n    required: true,\n    index: true,\n  })\n  slug: string;\n\n  @Prop({\n    type: {\n      'pt-BR': { type: LocalizedContentSchema, required: true },\n      en: { type: LocalizedContentSchema, required: true },\n      es: { type: LocalizedContentSchema, required: true },\n    },\n    _id: false,\n    required: true,\n  })\n  content: {\n    'pt-BR': LocalizedContent;\n    en: LocalizedContent;\n    es: LocalizedContent;\n  };\n\n  @Prop({\n    type: String,\n    enum: Object.values(NewsReleaseStatus),\n    default: NewsReleaseStatus.DRAFT,\n    index: true,\n  })\n  status: NewsReleaseStatus;\n\n  @Prop({ default: false, index: true })\n  featured: boolean;\n\n  @Prop()\n  featuredImage?: string;\n\n  @Prop({ type: [ImageGallerySchema], default: [] })\n  images: ImageGallery[];\n\n  @Prop([String])\n  categories: string[];\n\n  @Prop({ type: [String], index: true })\n  tags: string[];\n\n  @Prop({ type: AuthorSchema, required: true })\n  author: Author;\n\n  @Prop({ index: true })\n  publishedAt?: Date;\n\n  @Prop()\n  scheduledFor?: Date;\n\n  @Prop({ default: 0 })\n  viewCount: number;\n\n  @Prop([String])\n  relatedArticles?: string[];\n\n  @Prop({ default: false })\n  isDeleted: boolean;\n\n  @Prop()\n  deletedAt?: Date;\n\n  @Prop({ default: 0 })\n  version: number;\n\n  // Timestamps are automatically added by Mongoose when timestamps: true\n  createdAt?: Date;\n  updatedAt?: Date;\n}\n\nexport const NewsReleaseSchema = SchemaFactory.createForClass(NewsRelease);\n\n// Compound indexes for common queries\nNewsReleaseSchema.index({ status: 1, publishedAt: -1 });\nNewsReleaseSchema.index({ status: 1, featured: 1, publishedAt: -1 });\nNewsReleaseSchema.index({ isDeleted: 1, status: 1, publishedAt: -1 });\n\n// Full text search index with weights for better relevance\nNewsReleaseSchema.index(\n  {\n    'content.pt-BR.title': 'text',\n    'content.en.title': 'text',\n    'content.es.title': 'text',\n    'content.pt-BR.subtitle': 'text',\n    'content.en.subtitle': 'text',\n    'content.es.subtitle': 'text',\n    'content.pt-BR.content': 'text',\n    'content.en.content': 'text',\n    'content.es.content': 'text',\n    'content.pt-BR.keywords': 'text',\n    'content.en.keywords': 'text',\n    'content.es.keywords': 'text',\n    tags: 'text',\n    categories: 'text',\n  },\n  {\n    weights: {\n      'content.pt-BR.title': 10,\n      'content.en.title': 10,\n      'content.es.title': 10,\n      'content.pt-BR.subtitle': 5,\n      'content.en.subtitle': 5,\n      'content.es.subtitle': 5,\n      'content.pt-BR.keywords': 3,\n      'content.en.keywords': 3,\n      'content.es.keywords': 3,\n      tags: 3,\n      categories: 2,\n      'content.pt-BR.content': 1,\n      'content.en.content': 1,\n      'content.es.content': 1,\n    },\n    name: 'news_search_index',\n    default_language: 'english',\n    language_override: 'language',\n  },\n);\n\n// Multikey indexes for array fields\nNewsReleaseSchema.index({ tags: 1 });\nNewsReleaseSchema.index({ categories: 1 });\nNewsReleaseSchema.index({ tags: 1, categories: 1 });\n\n// Single field indexes for sorting and filtering\nNewsReleaseSchema.index({ createdAt: -1 });\nNewsReleaseSchema.index({ updatedAt: -1 });\nNewsReleaseSchema.index({ viewCount: -1 });\nNewsReleaseSchema.index({ publishedAt: -1 });\nNewsReleaseSchema.index({ scheduledFor: 1 });\n\n// Partial indexes for performance optimization\nNewsReleaseSchema.index(\n  { featured: 1, publishedAt: -1 },\n  { partialFilterExpression: { featured: true, status: NewsReleaseStatus.PUBLISHED } },\n);\n\n// Index for soft delete queries\nNewsReleaseSchema.index(\n  { isDeleted: 1, status: 1 },\n  { partialFilterExpression: { isDeleted: false } },\n);\n"],"version":3}