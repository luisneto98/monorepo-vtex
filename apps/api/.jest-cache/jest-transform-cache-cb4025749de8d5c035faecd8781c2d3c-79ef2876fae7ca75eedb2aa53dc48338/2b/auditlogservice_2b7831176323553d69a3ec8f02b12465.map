{"version":3,"names":["cov_2knhu633kp","actualCoverage","common_1","s","require","mongoose_1","mongoose_2","audit_log_schema_1","AuditLogService","auditLogModel","constructor","f","logAction","data","auditLog","entityType","save","getAuditLogs","entityId","limit","b","find","sort","timestamp","exec","getUserActivity","userId","exports","__decorate","Injectable","__param","InjectModel","NewsReleaseAuditLog","name","Model"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/news-releases/services/audit-log.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { InjectModel } from '@nestjs/mongoose';\nimport { Model } from 'mongoose';\nimport { NewsReleaseAuditLog, NewsReleaseAuditLogDocument } from '../schemas/audit-log.schema';\n\n@Injectable()\nexport class AuditLogService {\n  constructor(\n    @InjectModel(NewsReleaseAuditLog.name)\n    private auditLogModel: Model<NewsReleaseAuditLogDocument>,\n  ) {}\n\n  async logAction(data: {\n    entityId: string;\n    action: 'create' | 'update' | 'delete' | 'publish' | 'archive' | 'restore';\n    performedBy: {\n      id: string;\n      name: string;\n      email: string;\n      role: string;\n    };\n    changes?: Record<string, any>;\n    metadata?: Record<string, any>;\n    ipAddress?: string;\n    userAgent?: string;\n  }): Promise<NewsReleaseAuditLogDocument> {\n    const auditLog = new this.auditLogModel({\n      ...data,\n      entityType: 'news-release',\n    });\n    return auditLog.save();\n  }\n\n  async getAuditLogs(entityId: string, limit: number = 50): Promise<NewsReleaseAuditLogDocument[]> {\n    return this.auditLogModel.find({ entityId }).sort({ timestamp: -1 }).limit(limit).exec();\n  }\n\n  async getUserActivity(\n    userId: string,\n    limit: number = 50,\n  ): Promise<NewsReleaseAuditLogDocument[]> {\n    return this.auditLogModel\n      .find({ 'performedBy.id': userId })\n      .sort({ timestamp: -1 })\n      .limit(limit)\n      .exec();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAA;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,MAAAE,QAAA;AAAA;AAAA,CAAAF,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAC,UAAA;AAAA;AAAA,CAAAL,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAE,UAAA;AAAA;AAAA,CAAAN,cAAA,GAAAG,CAAA,QAAAC,OAAA;AACA,MAAAG,kBAAA;AAAA;AAAA,CAAAP,cAAA,GAAAG,CAAA,QAAAC,OAAA;AAA+F;AAAAJ,cAAA,GAAAG,CAAA;AAGxF,IAAMK,eAAe,GAArB,MAAMA,eAAe;EAGhBC,aAAA;EAFVC,YAEUD,aAAiD;IAAA;IAAAT,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAG,CAAA;IAAjD,KAAAM,aAAa,GAAbA,aAAa;EACpB;EAEH,MAAMG,SAASA,CAACC,IAaf;IAAA;IAAAb,cAAA,GAAAW,CAAA;IACC,MAAMG,QAAQ;IAAA;IAAA,CAAAd,cAAA,GAAAG,CAAA,QAAG,IAAI,IAAI,CAACM,aAAa,CAAC;MACtC,GAAGI,IAAI;MACPE,UAAU,EAAE;KACb,CAAC;IAAC;IAAAf,cAAA,GAAAG,CAAA;IACH,OAAOW,QAAQ,CAACE,IAAI,EAAE;EACxB;EAEA,MAAMC,YAAYA,CAACC,QAAgB,EAAEC,KAAA;EAAA;EAAA,CAAAnB,cAAA,GAAAoB,CAAA,WAAgB,EAAE;IAAA;IAAApB,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAG,CAAA;IACrD,OAAO,IAAI,CAACM,aAAa,CAACY,IAAI,CAAC;MAAEH;IAAQ,CAAE,CAAC,CAACI,IAAI,CAAC;MAAEC,SAAS,EAAE,CAAC;IAAC,CAAE,CAAC,CAACJ,KAAK,CAACA,KAAK,CAAC,CAACK,IAAI,EAAE;EAC1F;EAEA,MAAMC,eAAeA,CACnBC,MAAc,EACdP,KAAA;EAAA;EAAA,CAAAnB,cAAA,GAAAoB,CAAA,WAAgB,EAAE;IAAA;IAAApB,cAAA,GAAAW,CAAA;IAAAX,cAAA,GAAAG,CAAA;IAElB,OAAO,IAAI,CAACM,aAAa,CACtBY,IAAI,CAAC;MAAE,gBAAgB,EAAEK;IAAM,CAAE,CAAC,CAClCJ,IAAI,CAAC;MAAEC,SAAS,EAAE,CAAC;IAAC,CAAE,CAAC,CACvBJ,KAAK,CAACA,KAAK,CAAC,CACZK,IAAI,EAAE;EACX;CACD;AAAA;AAAAxB,cAAA,GAAAG,CAAA;AAzCYwB,OAAA,CAAAnB,eAAA,GAAAA,eAAA;AAAe;AAAAR,cAAA,GAAAG,CAAA;0BAAfK,eAAe,GAAAoB,UAAA,EAD3B,IAAA1B,QAAA,CAAA2B,UAAU,GAAE,EAGRC,OAAA,QAAAzB,UAAA,CAAA0B,WAAW,EAACxB,kBAAA,CAAAyB,mBAAmB,CAACC,IAAI,CAAC,G,iCACf3B,UAAA,CAAA4B,KAAK,G,EAHnB1B,eAAe,CAyC3B","ignoreList":[]}