{"version":3,"names":["cov_2imd57c3wi","actualCoverage","bull_1","s","require","common_1","notifications_service_1","NotificationsProcessor","NotificationsProcessor_1","notificationsService","logger","Logger","name","constructor","f","handleSendNotification","job","notificationId","data","log","deliverNotification","error","b","message","exports","__decorate","Process","Processor","NotificationsService"],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/notifications/notifications.processor.ts"],"sourcesContent":["import { Processor, Process } from '@nestjs/bull';\nimport { Job } from 'bull';\nimport { Logger } from '@nestjs/common';\nimport { NotificationsService } from './notifications.service';\n\n@Processor('notifications')\nexport class NotificationsProcessor {\n  private readonly logger = new Logger(NotificationsProcessor.name);\n\n  constructor(private readonly notificationsService: NotificationsService) {}\n\n  @Process('send-notification')\n  async handleSendNotification(job: Job): Promise<void> {\n    const { notificationId } = job.data;\n\n    this.logger.log(`Processing notification ${notificationId}`);\n\n    try {\n      await this.notificationsService.deliverNotification(notificationId);\n      this.logger.log(`Successfully delivered notification ${notificationId}`);\n    } catch (error: any) {\n      this.logger.error(\n        `Failed to deliver notification ${notificationId}: ${error?.message || 'Unknown error'}`,\n      );\n      throw error; // This will trigger Bull's retry mechanism\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}