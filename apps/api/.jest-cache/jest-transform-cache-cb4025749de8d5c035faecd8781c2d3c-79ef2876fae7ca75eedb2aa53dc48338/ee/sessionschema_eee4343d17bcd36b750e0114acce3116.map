{"file":"/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/sessions/schemas/session.schema.ts","mappings":"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","names":[],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/sessions/schemas/session.schema.ts"],"sourcesContent":["import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';\nimport { Document, Schema as MongooseSchema } from 'mongoose';\nimport { Session as ISession, SessionType, SessionStage } from '@shared/types/session.types';\n\nexport type SessionDocument = Session & Document;\n\n@Schema({ _id: false })\nclass Title {\n  @Prop({\n    required: true,\n    maxlength: 150,\n    trim: true,\n  })\n  'pt-BR': string;\n\n  @Prop({\n    required: true,\n    maxlength: 150,\n    trim: true,\n  })\n  'en': string;\n}\n\n@Schema({ _id: false })\nclass Description {\n  @Prop({\n    required: true,\n    minlength: 100,\n    maxlength: 1000,\n    trim: true,\n  })\n  'pt-BR': string;\n\n  @Prop({\n    required: true,\n    minlength: 100,\n    maxlength: 1000,\n    trim: true,\n  })\n  'en': string;\n}\n\n@Schema({ timestamps: true, collection: 'Session' })\nexport class Session implements Omit<ISession, '_id'> {\n  @Prop({\n    type: Title,\n    required: true,\n  })\n  title: {\n    'pt-BR': string;\n    en: string;\n  };\n\n  @Prop({\n    type: Description,\n    required: true,\n  })\n  description: {\n    'pt-BR': string;\n    en: string;\n  };\n\n  @Prop({\n    required: true,\n    enum: Object.values(SessionType),\n  })\n  type: SessionType;\n\n  @Prop({\n    required: true,\n    type: Date,\n    index: true,\n  })\n  startTime: Date;\n\n  @Prop({\n    required: true,\n    type: Date,\n  })\n  endTime: Date;\n\n  @Prop({\n    required: true,\n    enum: Object.values(SessionStage),\n    index: true,\n  })\n  stage: SessionStage;\n\n  @Prop({\n    type: [{ type: MongooseSchema.Types.ObjectId, ref: 'Speaker' }],\n    default: [],\n  })\n  speakerIds: string[];\n\n  @Prop({\n    type: [{ type: MongooseSchema.Types.ObjectId, ref: 'Sponsor' }],\n    default: [],\n  })\n  sponsorIds: string[];\n\n  @Prop({\n    type: [String],\n    default: [],\n    index: true,\n  })\n  tags: string[];\n\n  @Prop({\n    min: 0,\n  })\n  capacity?: number;\n\n  @Prop({\n    min: 0,\n    default: 0,\n  })\n  registeredCount: number;\n\n  @Prop({\n    default: false,\n  })\n  isHighlight: boolean;\n\n  @Prop({\n    default: true,\n    index: true,\n  })\n  isVisible: boolean;\n\n  @Prop({\n    type: Date,\n    default: null,\n  })\n  deletedAt?: Date;\n\n  @Prop({\n    type: MongooseSchema.Types.ObjectId,\n    ref: 'User',\n  })\n  deletedBy?: MongooseSchema.Types.ObjectId;\n\n  @Prop({\n    type: String,\n  })\n  deleteReason?: string;\n}\n\nexport const SessionSchema = SchemaFactory.createForClass(Session);\n\n// Indexes\nSessionSchema.index({ startTime: 1 });\nSessionSchema.index({ stage: 1 });\nSessionSchema.index({ tags: 1 });\nSessionSchema.index({ startTime: 1, stage: 1 });\nSessionSchema.index({ type: 1 });\nSessionSchema.index({ isHighlight: 1 });\nSessionSchema.index({ isVisible: 1 });\nSessionSchema.index({ deletedAt: 1 });\nSessionSchema.index({\n  'title.pt-BR': 'text',\n  'title.en': 'text',\n  'description.pt-BR': 'text',\n  'description.en': 'text',\n});\n\n// Pre-save middleware for data normalization\nSessionSchema.pre('save', function (next) {\n  if (this.title) {\n    if (this.title['pt-BR']) {\n      this.title['pt-BR'] = this.title['pt-BR'].trim();\n    }\n    if (this.title['en']) {\n      this.title['en'] = this.title['en'].trim();\n    }\n  }\n  if (this.description) {\n    if (this.description['pt-BR']) {\n      this.description['pt-BR'] = this.description['pt-BR'].trim();\n    }\n    if (this.description['en']) {\n      this.description['en'] = this.description['en'].trim();\n    }\n  }\n  if (this.tags && Array.isArray(this.tags)) {\n    this.tags = this.tags.map((tag) => tag.toLowerCase().trim());\n  }\n  next();\n});\n\n// Validation middleware\nSessionSchema.pre('save', function (next) {\n  if (this.startTime && this.endTime) {\n    if (this.endTime <= this.startTime) {\n      next(new Error('End time must be after start time'));\n      return;\n    }\n  }\n  next();\n});\n\n// Virtual fields\nSessionSchema.virtual('duration').get(function () {\n  if (this.startTime && this.endTime) {\n    return Math.round((this.endTime.getTime() - this.startTime.getTime()) / 60000);\n  }\n  return 0;\n});\n\nSessionSchema.virtual('isFull').get(function () {\n  if (this.capacity && this.registeredCount) {\n    return this.registeredCount >= this.capacity;\n  }\n  return false;\n});\n\n// Schema methods\nSessionSchema.methods['getLocalizedTitle'] = function (language: 'pt-BR' | 'en'): string {\n  return this['title'][language] || this['title']['pt-BR'];\n};\n\nSessionSchema.methods['getLocalizedDescription'] = function (language: 'pt-BR' | 'en'): string {\n  return this['description'][language] || this['description']['pt-BR'];\n};\n\nSessionSchema.methods['isLive'] = function (): boolean {\n  const now = new Date();\n  return this['startTime'] <= now && this['endTime'] > now;\n};\n\nSessionSchema.methods['isUpcoming'] = function (): boolean {\n  const now = new Date();\n  return this['startTime'] > now;\n};\n\nSessionSchema.methods['isPast'] = function (): boolean {\n  const now = new Date();\n  return this['endTime'] < now;\n};\n"],"version":3}