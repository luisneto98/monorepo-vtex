{"file":"/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/notifications/notifications.processor.ts","mappings":";;;;;;;;;;;;;AAAA,uCAAkD;AAElD,2CAAwC;AACxC,mEAA+D;AAGxD,IAAM,sBAAsB,8BAA5B,MAAM,sBAAsB;IAGJ;IAFZ,MAAM,GAAG,IAAI,eAAM,CAAC,wBAAsB,CAAC,IAAI,CAAC,CAAC;IAElE,YAA6B,oBAA0C;QAA1C,yBAAoB,GAApB,oBAAoB,CAAsB;IAAG,CAAC;IAGrE,AAAN,KAAK,CAAC,sBAAsB,CAAC,GAAQ;QACnC,MAAM,EAAE,cAAc,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;QAEpC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,2BAA2B,cAAc,EAAE,CAAC,CAAC;QAE7D,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,oBAAoB,CAAC,mBAAmB,CAAC,cAAc,CAAC,CAAC;YACpE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,uCAAuC,cAAc,EAAE,CAAC,CAAC;QAC3E,CAAC;QAAC,OAAO,KAAU,EAAE,CAAC;YACpB,IAAI,CAAC,MAAM,CAAC,KAAK,CACf,kCAAkC,cAAc,KAAK,KAAK,EAAE,OAAO,IAAI,eAAe,EAAE,CACzF,CAAC;YACF,MAAM,KAAK,CAAC,CAAC,2CAA2C;QAC1D,CAAC;IACH,CAAC;CACF,CAAA;AArBY,wDAAsB;AAM3B;IADL,IAAA,cAAO,EAAC,mBAAmB,CAAC;;;;oEAe5B;iCApBU,sBAAsB;IADlC,IAAA,gBAAS,EAAC,eAAe,CAAC;qCAI0B,4CAAoB;GAH5D,sBAAsB,CAqBlC","names":[],"sources":["/home/luisneto98/Documentos/Code/monorepo-vtex/apps/api/src/modules/notifications/notifications.processor.ts"],"sourcesContent":["import { Processor, Process } from '@nestjs/bull';\nimport { Job } from 'bull';\nimport { Logger } from '@nestjs/common';\nimport { NotificationsService } from './notifications.service';\n\n@Processor('notifications')\nexport class NotificationsProcessor {\n  private readonly logger = new Logger(NotificationsProcessor.name);\n\n  constructor(private readonly notificationsService: NotificationsService) {}\n\n  @Process('send-notification')\n  async handleSendNotification(job: Job): Promise<void> {\n    const { notificationId } = job.data;\n\n    this.logger.log(`Processing notification ${notificationId}`);\n\n    try {\n      await this.notificationsService.deliverNotification(notificationId);\n      this.logger.log(`Successfully delivered notification ${notificationId}`);\n    } catch (error: any) {\n      this.logger.error(\n        `Failed to deliver notification ${notificationId}: ${error?.message || 'Unknown error'}`,\n      );\n      throw error; // This will trigger Bull's retry mechanism\n    }\n  }\n}\n"],"version":3}