5e5d3901ce0cc039b27eced68af925a9
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var __param = (this && this.__param) || function (paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PressMaterialsController = void 0;
const common_1 = require("@nestjs/common");
const platform_express_1 = require("@nestjs/platform-express");
const swagger_1 = require("@nestjs/swagger");
const throttler_1 = require("@nestjs/throttler");
const press_materials_service_1 = require("./press-materials.service");
const update_press_material_dto_1 = require("./dto/update-press-material.dto");
const query_press_material_dto_1 = require("./dto/query-press-material.dto");
const jwt_auth_guard_1 = require("../auth/guards/jwt-auth.guard");
const roles_guard_1 = require("../auth/guards/roles.guard");
const roles_decorator_1 = require("../auth/decorators/roles.decorator");
const current_user_decorator_1 = require("../auth/decorators/current-user.decorator");
const public_decorator_1 = require("../auth/decorators/public.decorator");
const multer_config_1 = require("../../config/multer.config");
const shared_1 = require("@vtexday26/shared");
let PressMaterialsController = class PressMaterialsController {
    pressMaterialsService;
    constructor(pressMaterialsService) {
        this.pressMaterialsService = pressMaterialsService;
    }
    async create(file, body, user) {
        if (!file) {
            throw new common_1.BadRequestException('File is required');
        }
        if (!user || !user.sub) {
            throw new common_1.BadRequestException('User authentication failed');
        }
        // Parse multipart form data
        const dto = {
            type: body.type,
            title: {
                pt: body['title[pt]'] || body.title?.pt,
                en: body['title[en]'] || body.title?.en,
                es: body['title[es]'] || body.title?.es,
            },
            description: body.description
                ? {
                    pt: body['description[pt]'] || body.description?.pt,
                    en: body['description[en]'] || body.description?.en,
                    es: body['description[es]'] || body.description?.es,
                }
                : undefined,
            tags: Array.isArray(body.tags) ? body.tags : body.tags?.split(','),
            status: body.status,
            accessLevel: body.accessLevel,
        };
        return this.pressMaterialsService.create(dto, file, user.sub);
    }
    async findAll(query) {
        return this.pressMaterialsService.findAll(query);
    }
    async findPublic() {
        return this.pressMaterialsService.findPublic();
    }
    async getTopDownloaded(limit) {
        return this.pressMaterialsService.getTopDownloaded(limit);
    }
    async findOne(id) {
        return this.pressMaterialsService.findOne(id);
    }
    async download(id, req, res, user) {
        const ipAddress = req.ip || req.socket.remoteAddress || '';
        const userAgent = req.get('user-agent') || '';
        const url = await this.pressMaterialsService.getDownloadUrl(id, ipAddress, userAgent, user?.sub);
        // Return URL as JSON for frontend to open directly
        res.json({ url });
    }
    async getStatistics(id) {
        return this.pressMaterialsService.getStatistics(id);
    }
    async update(id, dto, user) {
        // Remove MongoDB _id fields from nested objects if present
        const cleanDto = { ...dto };
        if (cleanDto.title && '_id' in cleanDto.title) {
            const { _id, ...titleWithoutId } = cleanDto.title;
            cleanDto.title = titleWithoutId;
        }
        if (cleanDto.description && '_id' in cleanDto.description) {
            const { _id, ...descriptionWithoutId } = cleanDto.description;
            cleanDto.description = descriptionWithoutId;
        }
        return this.pressMaterialsService.update(id, cleanDto, user.sub);
    }
    async remove(id) {
        await this.pressMaterialsService.remove(id);
        return { message: 'Press material deleted successfully' };
    }
    async uploadFile(file, materialType, user) {
        if (!file) {
            throw new common_1.BadRequestException('File is required');
        }
        return this.pressMaterialsService.uploadFile(file, materialType, user.sub);
    }
};
exports.PressMaterialsController = PressMaterialsController;
__decorate([
    (0, common_1.Post)(),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileInterceptor)('file', multer_config_1.multerConfig)),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 60000 } }) // 5 uploads per minute
    ,
    (0, swagger_1.ApiOperation)({ summary: 'Create new press material' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, swagger_1.ApiBody)({
        schema: {
            type: 'object',
            required: ['file', 'type', 'title'],
            properties: {
                file: {
                    type: 'string',
                    format: 'binary',
                },
                type: {
                    type: 'string',
                    enum: ['press_kit', 'logo_package', 'photo', 'video', 'presentation'],
                },
                'title[pt]': { type: 'string' },
                'title[en]': { type: 'string' },
                'title[es]': { type: 'string' },
                'description[pt]': { type: 'string' },
                'description[en]': { type: 'string' },
                'description[es]': { type: 'string' },
                tags: {
                    type: 'array',
                    items: { type: 'string' },
                },
                status: {
                    type: 'string',
                    enum: ['draft', 'published', 'archived'],
                },
                accessLevel: {
                    type: 'string',
                    enum: ['public', 'restricted'],
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.CREATED, description: 'Press material created' }),
    __param(0, (0, common_1.UploadedFile)()),
    __param(1, (0, common_1.Body)()),
    __param(2, (0, current_user_decorator_1.CurrentUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, Object, Object]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "create", null);
__decorate([
    (0, common_1.Get)(),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Get all press materials with pagination' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'List of press materials' }),
    __param(0, (0, common_1.Query)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [query_press_material_dto_1.QueryPressMaterialDto]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "findAll", null);
__decorate([
    (0, common_1.Get)('public'),
    (0, public_decorator_1.Public)(),
    (0, swagger_1.ApiOperation)({ summary: 'Get public press materials' }),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'List of public press materials' }),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", []),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "findPublic", null);
__decorate([
    (0, common_1.Get)('top-downloaded'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Get top downloaded materials' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'Top downloaded materials' }),
    __param(0, (0, common_1.Query)('limit')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Number]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "getTopDownloaded", null);
__decorate([
    (0, common_1.Get)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Get specific press material' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'Press material details' }),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "findOne", null);
__decorate([
    (0, common_1.Get)(':id/download'),
    (0, public_decorator_1.Public)(),
    (0, throttler_1.Throttle)({ default: { limit: 10, ttl: 60000 } }) // 10 downloads per minute per IP
    ,
    (0, swagger_1.ApiOperation)({ summary: 'Get download URL for press material' }),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'Download URL' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Req)()),
    __param(2, (0, common_1.Res)()),
    __param(3, (0, current_user_decorator_1.CurrentUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, Object, Object, Object]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "download", null);
__decorate([
    (0, common_1.Get)(':id/statistics'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Get download statistics for material' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'Download statistics' }),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "getStatistics", null);
__decorate([
    (0, common_1.Put)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Update press material' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'Press material updated' }),
    __param(0, (0, common_1.Param)('id')),
    __param(1, (0, common_1.Body)()),
    __param(2, (0, current_user_decorator_1.CurrentUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String, update_press_material_dto_1.UpdatePressMaterialDto, Object]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "update", null);
__decorate([
    (0, common_1.Delete)(':id'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, swagger_1.ApiOperation)({ summary: 'Delete press material' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.NO_CONTENT, description: 'Press material deleted' }),
    __param(0, (0, common_1.Param)('id')),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "remove", null);
__decorate([
    (0, common_1.Post)('upload'),
    (0, common_1.UseGuards)(jwt_auth_guard_1.JwtAuthGuard, roles_guard_1.RolesGuard),
    (0, roles_decorator_1.Roles)(shared_1.UserRole.SUPER_ADMIN, shared_1.UserRole.PRODUCER),
    (0, common_1.UseInterceptors)((0, platform_express_1.FileInterceptor)('file', multer_config_1.multerConfig)),
    (0, throttler_1.Throttle)({ default: { limit: 5, ttl: 60000 } }) // 5 uploads per minute
    ,
    (0, swagger_1.ApiOperation)({ summary: 'Upload file to S3' }),
    (0, swagger_1.ApiBearerAuth)(),
    (0, swagger_1.ApiConsumes)('multipart/form-data'),
    (0, swagger_1.ApiBody)({
        schema: {
            type: 'object',
            required: ['file', 'materialType'],
            properties: {
                file: {
                    type: 'string',
                    format: 'binary',
                },
                materialType: {
                    type: 'string',
                    enum: ['press_kit', 'logo_package', 'photo', 'video', 'presentation'],
                },
            },
        },
    }),
    (0, swagger_1.ApiResponse)({ status: common_1.HttpStatus.OK, description: 'File uploaded successfully' }),
    __param(0, (0, common_1.UploadedFile)()),
    __param(1, (0, common_1.Body)('materialType')),
    __param(2, (0, current_user_decorator_1.CurrentUser)()),
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Object, String, Object]),
    __metadata("design:returntype", Promise)
], PressMaterialsController.prototype, "uploadFile", null);
exports.PressMaterialsController = PressMaterialsController = __decorate([
    (0, swagger_1.ApiTags)('press-materials'),
    (0, common_1.Controller)('press-materials'),
    __metadata("design:paramtypes", [press_materials_service_1.PressMaterialsService])
], PressMaterialsController);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvbHVpc25ldG85OC9Eb2N1bWVudG9zL0NvZGUvbW9ub3JlcG8tdnRleC9hcHBzL2FwaS9zcmMvbW9kdWxlcy9wcmVzcy1tYXRlcmlhbHMvcHJlc3MtbWF0ZXJpYWxzLmNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBZ0J3QjtBQUN4QiwrREFBMkQ7QUFDM0QsNkNBT3lCO0FBRXpCLGlEQUE2QztBQUM3Qyx1RUFBa0U7QUFFbEUsK0VBQXlFO0FBQ3pFLDZFQUF1RTtBQUN2RSxrRUFBNkQ7QUFDN0QsNERBQXdEO0FBQ3hELHdFQUEyRDtBQUMzRCxzRkFBd0U7QUFDeEUsMEVBQTZEO0FBQzdELDhEQUEwRDtBQUMxRCw4Q0FBNkM7QUFJdEMsSUFBTSx3QkFBd0IsR0FBOUIsTUFBTSx3QkFBd0I7SUFDTjtJQUE3QixZQUE2QixxQkFBNEM7UUFBNUMsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUF1QjtJQUFHLENBQUM7SUE2Q3ZFLEFBQU4sS0FBSyxDQUFDLE1BQU0sQ0FDTSxJQUF5QixFQUNqQyxJQUFTLEVBQ0YsSUFBUztRQUV4QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDVixNQUFNLElBQUksNEJBQW1CLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN2QixNQUFNLElBQUksNEJBQW1CLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUM5RCxDQUFDO1FBRUQsNEJBQTRCO1FBQzVCLE1BQU0sR0FBRyxHQUEyQjtZQUNsQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixLQUFLLEVBQUU7Z0JBQ0wsRUFBRSxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQ3ZDLEVBQUUsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxF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RUFBRSxDQUFDO0lBQzlDLElBQUEsdUJBQWEsR0FBRTtJQUNmLElBQUEscUJBQVcsRUFBQyxxQkFBcUIsQ0FBQztJQUNsQyxJQUFBLGlCQUFPLEVBQUM7UUFDUCxNQUFNLEVBQUU7WUFDTixJQUFJLEVBQUUsUUFBUTtZQUNkLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUM7WUFDbEMsVUFBVSxFQUFFO2dCQUNWLElBQUksRUFBRTtvQkFDSixJQUFJLEVBQUUsUUFBUTtvQkFDZCxNQUFNLEVBQUUsUUFBUTtpQkFDakI7Z0JBQ0QsWUFBWSxFQUFFO29CQUNaLElBQUksRUFBRSxRQUFRO29CQUNkLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxjQUFjLENBQUM7aUJBQ3RFO2FBQ0Y7U0FDRjtLQUNGLENBQUM7SUFDRCxJQUFBLHFCQUFXLEVBQUMsRUFBRSxNQUFNLEVBQUUsbUJBQVUsQ0FBQyxFQUFFLEVBQUUsV0FBVyxFQUFFLDRCQUE0QixFQUFFLENBQUM7SUFFL0UsV0FBQSxJQUFBLHFCQUFZLEdBQUUsQ0FBQTtJQUNkLFdBQUEsSUFBQSxhQUFJLEVBQUMsY0FBYyxDQUFDLENBQUE7SUFDcEIsV0FBQSxJQUFBLG9DQUFXLEdBQUUsQ0FBQTs7OzswREFPZjttQ0E3TlUsd0JBQXdCO0lBRnBDLElBQUEsaUJBQU8sRUFBQyxpQkFBaUIsQ0FBQztJQUMxQixJQUFBLG1CQUFVLEVBQUMsaUJBQWlCLENBQUM7cUNBRXdCLCtDQUFxQjtHQUQ5RCx3QkFBd0IsQ0E4TnBDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2x1aXNuZXRvOTgvRG9jdW1lbnRvcy9Db2RlL21vbm9yZXBvLXZ0ZXgvYXBwcy9hcGkvc3JjL21vZHVsZXMvcHJlc3MtbWF0ZXJpYWxzL3ByZXNzLW1hdGVyaWFscy5jb250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbnRyb2xsZXIsXG4gIEdldCxcbiAgUG9zdCxcbiAgUHV0LFxuICBEZWxldGUsXG4gIEJvZHksXG4gIFBhcmFtLFxuICBRdWVyeSxcbiAgVXNlR3VhcmRzLFxuICBVc2VJbnRlcmNlcHRvcnMsXG4gIFVwbG9hZGVkRmlsZSxcbiAgUmVxLFxuICBSZXMsXG4gIEh0dHBTdGF0dXMsXG4gIEJhZFJlcXVlc3RFeGNlcHRpb24sXG59IGZyb20gJ0BuZXN0anMvY29tbW9uJztcbmltcG9ydCB7IEZpbGVJbnRlcmNlcHRvciB9IGZyb20gJ0BuZXN0anMvcGxhdGZvcm0tZXhwcmVzcyc7XG5pbXBvcnQge1xuICBBcGlUYWdzLFxuICBBcGlPcGVyYXRpb24sXG4gIEFwaVJlc3BvbnNlLFxuICBBcGlCZWFyZXJBdXRoLFxuICBBcGlDb25zdW1lcyxcbiAgQXBpQm9keSxcbn0gZnJvbSAnQG5lc3Rqcy9zd2FnZ2VyJztcbmltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBUaHJvdHRsZSB9IGZyb20gJ0BuZXN0anMvdGhyb3R0bGVyJztcbmltcG9ydCB7IFByZXNzTWF0ZXJpYWxzU2VydmljZSB9IGZyb20gJy4vcHJlc3MtbWF0ZXJpYWxzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ3JlYXRlUHJlc3NNYXRlcmlhbER0byB9IGZyb20gJy4vZHRvL2NyZWF0ZS1wcmVzcy1tYXRlcmlhbC5kdG8nO1xuaW1wb3J0IHsgVXBkYXRlUHJlc3NNYXRlcmlhbER0byB9IGZyb20gJy4vZHRvL3VwZGF0ZS1wcmVzcy1tYXRlcmlhbC5kdG8nO1xuaW1wb3J0IHsgUXVlcnlQcmVzc01hdGVyaWFsRHRvIH0gZnJvbSAnLi9kdG8vcXVlcnktcHJlc3MtbWF0ZXJpYWwuZHRvJztcbmltcG9ydCB7IEp3dEF1dGhHdWFyZCB9IGZyb20gJy4uL2F1dGgvZ3VhcmRzL2p3dC1hdXRoLmd1YXJkJztcbmltcG9ydCB7IFJvbGVzR3VhcmQgfSBmcm9tICcuLi9hdXRoL2d1YXJkcy9yb2xlcy5ndWFyZCc7XG5pbXBvcnQgeyBSb2xlcyB9IGZyb20gJy4uL2F1dGgvZGVjb3JhdG9ycy9yb2xlcy5kZWNvcmF0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVzZXIgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvY3VycmVudC11c2VyLmRlY29yYXRvcic7XG5pbXBvcnQgeyBQdWJsaWMgfSBmcm9tICcuLi9hdXRoL2RlY29yYXRvcnMvcHVibGljLmRlY29yYXRvcic7XG5pbXBvcnQgeyBtdWx0ZXJDb25maWcgfSBmcm9tICcuLi8uLi9jb25maWcvbXVsdGVyLmNvbmZpZyc7XG5pbXBvcnQgeyBVc2VyUm9sZSB9IGZyb20gJ0B2dGV4ZGF5MjYvc2hhcmVkJztcblxuQEFwaVRhZ3MoJ3ByZXNzLW1hdGVyaWFscycpXG5AQ29udHJvbGxlcigncHJlc3MtbWF0ZXJpYWxzJylcbmV4cG9ydCBjbGFzcyBQcmVzc01hdGVyaWFsc0NvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IHByZXNzTWF0ZXJpYWxzU2VydmljZTogUHJlc3NNYXRlcmlhbHNTZXJ2aWNlKSB7fVxuXG4gIEBQb3N0KClcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQsIFJvbGVzR3VhcmQpXG4gIEBSb2xlcyhVc2VyUm9sZS5TVVBFUl9BRE1JTiwgVXNlclJvbGUuUFJPRFVDRVIpXG4gIEBVc2VJbnRlcmNlcHRvcnMoRmlsZUludGVyY2VwdG9yKCdmaWxlJywgbXVsdGVyQ29uZmlnKSlcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogNSwgdHRsOiA2MDAwMCB9IH0pIC8vIDUgdXBsb2FkcyBwZXIgbWludXRlXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnQ3JlYXRlIG5ldyBwcmVzcyBtYXRlcmlhbCcgfSlcbiAgQEFwaUJlYXJlckF1dGgoKVxuICBAQXBpQ29uc3VtZXMoJ211bHRpcGFydC9mb3JtLWRhdGEnKVxuICBAQXBpQm9keSh7XG4gICAgc2NoZW1hOiB7XG4gICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgIHJlcXVpcmVkOiBbJ2ZpbGUnLCAndHlwZScsICd0aXRsZSddLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBmaWxlOiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgZm9ybWF0OiAnYmluYXJ5JyxcbiAgICAgICAgfSxcbiAgICAgICAgdHlwZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGVudW06IFsncHJlc3Nfa2l0JywgJ2xvZ29fcGFja2FnZScsICdwaG90bycsICd2aWRlbycsICdwcmVzZW50YXRpb24nXSxcbiAgICAgICAgfSxcbiAgICAgICAgJ3RpdGxlW3B0XSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgJ3RpdGxlW2VuXSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgJ3RpdGxlW2VzXSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgJ2Rlc2NyaXB0aW9uW3B0XSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgJ2Rlc2NyaXB0aW9uW2VuXSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgJ2Rlc2NyaXB0aW9uW2VzXSc6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgdGFnczoge1xuICAgICAgICAgIHR5cGU6ICdhcnJheScsXG4gICAgICAgICAgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgfSxcbiAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgZW51bTogWydkcmFmdCcsICdwdWJsaXNoZWQnLCAnYXJjaGl2ZWQnXSxcbiAgICAgICAgfSxcbiAgICAgICAgYWNjZXNzTGV2ZWw6IHtcbiAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICBlbnVtOiBbJ3B1YmxpYycsICdyZXN0cmljdGVkJ10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogSHR0cFN0YXR1cy5DUkVBVEVELCBkZXNjcmlwdGlvbjogJ1ByZXNzIG1hdGVyaWFsIGNyZWF0ZWQnIH0pXG4gIGFzeW5jIGNyZWF0ZShcbiAgICBAVXBsb2FkZWRGaWxlKCkgZmlsZTogRXhwcmVzcy5NdWx0ZXIuRmlsZSxcbiAgICBAQm9keSgpIGJvZHk6IGFueSxcbiAgICBAQ3VycmVudFVzZXIoKSB1c2VyOiBhbnksXG4gICkge1xuICAgIGlmICghZmlsZSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ZpbGUgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIXVzZXIgfHwgIXVzZXIuc3ViKSB7XG4gICAgICB0aHJvdyBuZXcgQmFkUmVxdWVzdEV4Y2VwdGlvbignVXNlciBhdXRoZW50aWNhdGlvbiBmYWlsZWQnKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZSBtdWx0aXBhcnQgZm9ybSBkYXRhXG4gICAgY29uc3QgZHRvOiBDcmVhdGVQcmVzc01hdGVyaWFsRHRvID0ge1xuICAgICAgdHlwZTogYm9keS50eXBlLFxuICAgICAgdGl0bGU6IHtcbiAgICAgICAgcHQ6IGJvZHlbJ3RpdGxlW3B0XSddIHx8IGJvZHkudGl0bGU/LnB0LFxuICAgICAgICBlbjogYm9keVsndGl0bGVbZW5dJ10gfHwgYm9keS50aXRsZT8uZW4sXG4gICAgICAgIGVzOiBib2R5Wyd0aXRsZVtlc10nXSB8fCBib2R5LnRpdGxlPy5lcyxcbiAgICAgIH0sXG4gICAgICBkZXNjcmlwdGlvbjogYm9keS5kZXNjcmlwdGlvblxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHB0OiBib2R5WydkZXNjcmlwdGlvbltwdF0nXSB8fCBib2R5LmRlc2NyaXB0aW9uPy5wdCxcbiAgICAgICAgICAgIGVuOiBib2R5WydkZXNjcmlwdGlvbltlbl0nXSB8fCBib2R5LmRlc2NyaXB0aW9uPy5lbixcbiAgICAgICAgICAgIGVzOiBib2R5WydkZXNjcmlwdGlvbltlc10nXSB8fCBib2R5LmRlc2NyaXB0aW9uPy5lcyxcbiAgICAgICAgICB9XG4gICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgdGFnczogQXJyYXkuaXNBcnJheShib2R5LnRhZ3MpID8gYm9keS50YWdzIDogYm9keS50YWdzPy5zcGxpdCgnLCcpLFxuICAgICAgc3RhdHVzOiBib2R5LnN0YXR1cyxcbiAgICAgIGFjY2Vzc0xldmVsOiBib2R5LmFjY2Vzc0xldmVsLFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UuY3JlYXRlKGR0bywgZmlsZSwgdXNlci5zdWIpO1xuICB9XG5cbiAgQEdldCgpXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxuICBAUm9sZXMoVXNlclJvbGUuU1VQRVJfQURNSU4sIFVzZXJSb2xlLlBST0RVQ0VSKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCBhbGwgcHJlc3MgbWF0ZXJpYWxzIHdpdGggcGFnaW5hdGlvbicgfSlcbiAgQEFwaUJlYXJlckF1dGgoKVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IEh0dHBTdGF0dXMuT0ssIGRlc2NyaXB0aW9uOiAnTGlzdCBvZiBwcmVzcyBtYXRlcmlhbHMnIH0pXG4gIGFzeW5jIGZpbmRBbGwoQFF1ZXJ5KCkgcXVlcnk6IFF1ZXJ5UHJlc3NNYXRlcmlhbER0bykge1xuICAgIHJldHVybiB0aGlzLnByZXNzTWF0ZXJpYWxzU2VydmljZS5maW5kQWxsKHF1ZXJ5KTtcbiAgfVxuXG4gIEBHZXQoJ3B1YmxpYycpXG4gIEBQdWJsaWMoKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCBwdWJsaWMgcHJlc3MgbWF0ZXJpYWxzJyB9KVxuICBAQXBpUmVzcG9uc2UoeyBzdGF0dXM6IEh0dHBTdGF0dXMuT0ssIGRlc2NyaXB0aW9uOiAnTGlzdCBvZiBwdWJsaWMgcHJlc3MgbWF0ZXJpYWxzJyB9KVxuICBhc3luYyBmaW5kUHVibGljKCkge1xuICAgIHJldHVybiB0aGlzLnByZXNzTWF0ZXJpYWxzU2VydmljZS5maW5kUHVibGljKCk7XG4gIH1cblxuICBAR2V0KCd0b3AtZG93bmxvYWRlZCcpXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxuICBAUm9sZXMoVXNlclJvbGUuU1VQRVJfQURNSU4sIFVzZXJSb2xlLlBST0RVQ0VSKVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ0dldCB0b3AgZG93bmxvYWRlZCBtYXRlcmlhbHMnIH0pXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ1RvcCBkb3dubG9hZGVkIG1hdGVyaWFscycgfSlcbiAgYXN5bmMgZ2V0VG9wRG93bmxvYWRlZChAUXVlcnkoJ2xpbWl0JykgbGltaXQ/OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UuZ2V0VG9wRG93bmxvYWRlZChsaW1pdCk7XG4gIH1cblxuICBAR2V0KCc6aWQnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFVzZXJSb2xlLlNVUEVSX0FETUlOLCBVc2VyUm9sZS5QUk9EVUNFUilcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgc3BlY2lmaWMgcHJlc3MgbWF0ZXJpYWwnIH0pXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ1ByZXNzIG1hdGVyaWFsIGRldGFpbHMnIH0pXG4gIGFzeW5jIGZpbmRPbmUoQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UuZmluZE9uZShpZCk7XG4gIH1cblxuICBAR2V0KCc6aWQvZG93bmxvYWQnKVxuICBAUHVibGljKClcbiAgQFRocm90dGxlKHsgZGVmYXVsdDogeyBsaW1pdDogMTAsIHR0bDogNjAwMDAgfSB9KSAvLyAxMCBkb3dubG9hZHMgcGVyIG1pbnV0ZSBwZXIgSVBcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgZG93bmxvYWQgVVJMIGZvciBwcmVzcyBtYXRlcmlhbCcgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ0Rvd25sb2FkIFVSTCcgfSlcbiAgYXN5bmMgZG93bmxvYWQoXG4gICAgQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcsXG4gICAgQFJlcSgpIHJlcTogUmVxdWVzdCxcbiAgICBAUmVzKCkgcmVzOiBSZXNwb25zZSxcbiAgICBAQ3VycmVudFVzZXIoKSB1c2VyPzogYW55LFxuICApIHtcbiAgICBjb25zdCBpcEFkZHJlc3MgPSByZXEuaXAgfHwgcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzIHx8ICcnO1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IHJlcS5nZXQoJ3VzZXItYWdlbnQnKSB8fCAnJztcblxuICAgIGNvbnN0IHVybCA9IGF3YWl0IHRoaXMucHJlc3NNYXRlcmlhbHNTZXJ2aWNlLmdldERvd25sb2FkVXJsKGlkLCBpcEFkZHJlc3MsIHVzZXJBZ2VudCwgdXNlcj8uc3ViKTtcblxuICAgIC8vIFJldHVybiBVUkwgYXMgSlNPTiBmb3IgZnJvbnRlbmQgdG8gb3BlbiBkaXJlY3RseVxuICAgIHJlcy5qc29uKHsgdXJsIH0pO1xuICB9XG5cbiAgQEdldCgnOmlkL3N0YXRpc3RpY3MnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFVzZXJSb2xlLlNVUEVSX0FETUlOLCBVc2VyUm9sZS5QUk9EVUNFUilcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdHZXQgZG93bmxvYWQgc3RhdGlzdGljcyBmb3IgbWF0ZXJpYWwnIH0pXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ0Rvd25sb2FkIHN0YXRpc3RpY3MnIH0pXG4gIGFzeW5jIGdldFN0YXRpc3RpY3MoQFBhcmFtKCdpZCcpIGlkOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UuZ2V0U3RhdGlzdGljcyhpZCk7XG4gIH1cblxuICBAUHV0KCc6aWQnKVxuICBAVXNlR3VhcmRzKEp3dEF1dGhHdWFyZCwgUm9sZXNHdWFyZClcbiAgQFJvbGVzKFVzZXJSb2xlLlNVUEVSX0FETUlOLCBVc2VyUm9sZS5QUk9EVUNFUilcbiAgQEFwaU9wZXJhdGlvbih7IHN1bW1hcnk6ICdVcGRhdGUgcHJlc3MgbWF0ZXJpYWwnIH0pXG4gIEBBcGlCZWFyZXJBdXRoKClcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ1ByZXNzIG1hdGVyaWFsIHVwZGF0ZWQnIH0pXG4gIGFzeW5jIHVwZGF0ZShcbiAgICBAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZyxcbiAgICBAQm9keSgpIGR0bzogVXBkYXRlUHJlc3NNYXRlcmlhbER0byxcbiAgICBAQ3VycmVudFVzZXIoKSB1c2VyOiBhbnksXG4gICkge1xuICAgIC8vIFJlbW92ZSBNb25nb0RCIF9pZCBmaWVsZHMgZnJvbSBuZXN0ZWQgb2JqZWN0cyBpZiBwcmVzZW50XG4gICAgY29uc3QgY2xlYW5EdG8gPSB7IC4uLmR0byB9O1xuICAgIGlmIChjbGVhbkR0by50aXRsZSAmJiAnX2lkJyBpbiBjbGVhbkR0by50aXRsZSkge1xuICAgICAgY29uc3QgeyBfaWQsIC4uLnRpdGxlV2l0aG91dElkIH0gPSBjbGVhbkR0by50aXRsZSBhcyBhbnk7XG4gICAgICBjbGVhbkR0by50aXRsZSA9IHRpdGxlV2l0aG91dElkO1xuICAgIH1cbiAgICBpZiAoY2xlYW5EdG8uZGVzY3JpcHRpb24gJiYgJ19pZCcgaW4gY2xlYW5EdG8uZGVzY3JpcHRpb24pIHtcbiAgICAgIGNvbnN0IHsgX2lkLCAuLi5kZXNjcmlwdGlvbldpdGhvdXRJZCB9ID0gY2xlYW5EdG8uZGVzY3JpcHRpb24gYXMgYW55O1xuICAgICAgY2xlYW5EdG8uZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbldpdGhvdXRJZDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UudXBkYXRlKGlkLCBjbGVhbkR0bywgdXNlci5zdWIpO1xuICB9XG5cbiAgQERlbGV0ZSgnOmlkJylcbiAgQFVzZUd1YXJkcyhKd3RBdXRoR3VhcmQsIFJvbGVzR3VhcmQpXG4gIEBSb2xlcyhVc2VyUm9sZS5TVVBFUl9BRE1JTiwgVXNlclJvbGUuUFJPRFVDRVIpXG4gIEBBcGlPcGVyYXRpb24oeyBzdW1tYXJ5OiAnRGVsZXRlIHByZXNzIG1hdGVyaWFsJyB9KVxuICBAQXBpQmVhcmVyQXV0aCgpXG4gIEBBcGlSZXNwb25zZSh7IHN0YXR1czogSHR0cFN0YXR1cy5OT19DT05URU5ULCBkZXNjcmlwdGlvbjogJ1ByZXNzIG1hdGVyaWFsIGRlbGV0ZWQnIH0pXG4gIGFzeW5jIHJlbW92ZShAUGFyYW0oJ2lkJykgaWQ6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMucHJlc3NNYXRlcmlhbHNTZXJ2aWNlLnJlbW92ZShpZCk7XG4gICAgcmV0dXJuIHsgbWVzc2FnZTogJ1ByZXNzIG1hdGVyaWFsIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9O1xuICB9XG5cbiAgQFBvc3QoJ3VwbG9hZCcpXG4gIEBVc2VHdWFyZHMoSnd0QXV0aEd1YXJkLCBSb2xlc0d1YXJkKVxuICBAUm9sZXMoVXNlclJvbGUuU1VQRVJfQURNSU4sIFVzZXJSb2xlLlBST0RVQ0VSKVxuICBAVXNlSW50ZXJjZXB0b3JzKEZpbGVJbnRlcmNlcHRvcignZmlsZScsIG11bHRlckNvbmZpZykpXG4gIEBUaHJvdHRsZSh7IGRlZmF1bHQ6IHsgbGltaXQ6IDUsIHR0bDogNjAwMDAgfSB9KSAvLyA1IHVwbG9hZHMgcGVyIG1pbnV0ZVxuICBAQXBpT3BlcmF0aW9uKHsgc3VtbWFyeTogJ1VwbG9hZCBmaWxlIHRvIFMzJyB9KVxuICBAQXBpQmVhcmVyQXV0aCgpXG4gIEBBcGlDb25zdW1lcygnbXVsdGlwYXJ0L2Zvcm0tZGF0YScpXG4gIEBBcGlCb2R5KHtcbiAgICBzY2hlbWE6IHtcbiAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgcmVxdWlyZWQ6IFsnZmlsZScsICdtYXRlcmlhbFR5cGUnXSxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgZmlsZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGZvcm1hdDogJ2JpbmFyeScsXG4gICAgICAgIH0sXG4gICAgICAgIG1hdGVyaWFsVHlwZToge1xuICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgIGVudW06IFsncHJlc3Nfa2l0JywgJ2xvZ29fcGFja2FnZScsICdwaG90bycsICd2aWRlbycsICdwcmVzZW50YXRpb24nXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSlcbiAgQEFwaVJlc3BvbnNlKHsgc3RhdHVzOiBIdHRwU3RhdHVzLk9LLCBkZXNjcmlwdGlvbjogJ0ZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5JyB9KVxuICBhc3luYyB1cGxvYWRGaWxlKFxuICAgIEBVcGxvYWRlZEZpbGUoKSBmaWxlOiBFeHByZXNzLk11bHRlci5GaWxlLFxuICAgIEBCb2R5KCdtYXRlcmlhbFR5cGUnKSBtYXRlcmlhbFR5cGU6IHN0cmluZyxcbiAgICBAQ3VycmVudFVzZXIoKSB1c2VyOiBhbnksXG4gICkge1xuICAgIGlmICghZmlsZSkge1xuICAgICAgdGhyb3cgbmV3IEJhZFJlcXVlc3RFeGNlcHRpb24oJ0ZpbGUgaXMgcmVxdWlyZWQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wcmVzc01hdGVyaWFsc1NlcnZpY2UudXBsb2FkRmlsZShmaWxlLCBtYXRlcmlhbFR5cGUsIHVzZXIuc3ViKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9